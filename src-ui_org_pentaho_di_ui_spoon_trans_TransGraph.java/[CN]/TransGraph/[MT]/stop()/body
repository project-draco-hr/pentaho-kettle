{
  if (running && !halting) {
    halting=true;
    trans.stopAll();
    try {
      trans.endProcessing("stop");
      log.logMinimal(BaseMessages.getString(PKG,"TransLog.Log.ProcessingOfTransformationStopped"));
    }
 catch (    KettleException e) {
      new ErrorDialog(shell,BaseMessages.getString(PKG,"TransLog.Dialog.ErrorWritingLogRecord.Title"),BaseMessages.getString(PKG,"TransLog.Dialog.ErrorWritingLogRecord.Message"),e);
    }
    running=false;
    initialized=false;
    halted=false;
    halting=false;
    setControlStates();
    transMeta.setInternalKettleVariables();
  }
}
