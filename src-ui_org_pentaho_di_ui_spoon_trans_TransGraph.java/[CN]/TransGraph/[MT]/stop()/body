{
  if (running && !halting) {
    halting=true;
    trans.stopAll();
    try {
      trans.endProcessing("stop");
      log.logMinimal(Spoon.APP_NAME,Messages.getString("TransLog.Log.ProcessingOfTransformationStopped"));
    }
 catch (    KettleException e) {
      new ErrorDialog(shell,Messages.getString("TransLog.Dialog.ErrorWritingLogRecord.Title"),Messages.getString("TransLog.Dialog.ErrorWritingLogRecord.Message"),e);
    }
    running=false;
    initialized=false;
    halted=false;
    halting=false;
    setControlStates();
    transMeta.setInternalKettleVariables();
  }
}
