{
  meta=(ExcelInputMeta)smi;
  data=(ExcelInputData)sdi;
  if (first) {
    first=false;
    if (meta.isAcceptingFilenames()) {
      data.files.getFiles().clear();
      int idx=-1;
      Row fileRow=getRowFrom(meta.getAcceptingStepName());
      while (fileRow != null) {
        if (idx < 0) {
          idx=fileRow.searchValueIndex(meta.getAcceptingField());
          if (idx < 0) {
            logError("The filename field [" + meta.getAcceptingField() + "] could not be found in the input rows.");
            setErrors(1);
            stopAll();
            return false;
          }
        }
        Value fileValue=fileRow.getValue(idx);
        data.files.addFile(new File(fileValue.getString()));
        fileRow=getRowFrom(meta.getAcceptingStepName());
      }
    }
    handleMissingFiles();
  }
  if (data.filenr >= data.files.nrOfFiles()) {
    if (log.isDetailed())     logDetailed("No more files to be processes! (" + data.filenr + " files done)");
    setOutputDone();
    return false;
  }
  if (meta.getRowLimit() > 0 && data.rownr > meta.getRowLimit()) {
    if (log.isDetailed())     logDetailed("Row limit of [" + meta.getRowLimit() + "] reached: stop processing.");
    setOutputDone();
    return false;
  }
  Row r=getRowFromWorkbooks();
  if (r != null) {
    if (!r.isIgnored()) {
      if (data.previousRow != null) {
        for (int i=0; i < meta.getField().length; i++) {
          Value field=r.getValue(i);
          if (field.isNull() && meta.getField()[i].isRepeated()) {
            Value repeat=data.previousRow.getValue(i);
            field.setValue(repeat);
          }
        }
      }
      data.previousRow=r;
      putRow(r);
    }
    return true;
  }
 else {
    return false;
  }
}
