{
  final String virtualFile=createVirtualFile("pdi-14172.txt","1,1,1\n","2,,2\n");
  TextFileInputMeta meta=new TextFileInputMeta();
  BaseFileInputField field2=field("col2");
  field2.setRepeated(true);
  meta.inputFiles.inputFields=new BaseFileInputField[]{field("col1"),field2,field("col3")};
  meta.content.fileCompression="None";
  meta.content.fileType="CSV";
  meta.content.header=false;
  meta.content.nrHeaderLines=-1;
  meta.content.footer=false;
  meta.content.nrFooterLines=-1;
  TextFileInputData data=new TextFileInputData();
  data.files=new FileInputList();
  data.files.addFile(KettleVFS.getFileObject(virtualFile));
  data.outputRowMeta=new RowMeta();
  data.outputRowMeta.addValueMeta(new ValueMetaString("col1"));
  data.outputRowMeta.addValueMeta(new ValueMetaString("col2"));
  data.outputRowMeta.addValueMeta(new ValueMetaString("col3"));
  data.dataErrorLineHandler=Mockito.mock(FileErrorHandler.class);
  data.fileFormatType=TextFileInputMeta.FILE_FORMAT_UNIX;
  data.separator=",";
  data.filterProcessor=new TextFileFilterProcessor(new TextFileFilter[0],new Variables());
  data.filePlayList=new FilePlayListAll();
  RowSet output=new BlockingRowSet(5);
  executeStep(meta,data,output,2);
  Object[] row1=output.getRowImmediate();
  assertRow(row1,"1","1","1");
  Object[] row2=output.getRowImmediate();
  assertRow(row2,"2","1","2");
  deleteVfsFile(virtualFile);
}
