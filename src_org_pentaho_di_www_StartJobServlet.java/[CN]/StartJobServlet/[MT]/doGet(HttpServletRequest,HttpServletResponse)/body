{
  if (!request.getContextPath().equals(CONTEXT_PATH))   return;
  if (log.isDebug())   log.logDebug(toString(),BaseMessages.getString(PKG,"StartJobServlet.Log.StartJobRequested"));
  String jobName=request.getParameter("name");
  boolean useXML="Y".equalsIgnoreCase(request.getParameter("xml"));
  response.setStatus(HttpServletResponse.SC_OK);
  PrintWriter out=response.getWriter();
  if (useXML) {
    response.setContentType("text/xml");
    response.setCharacterEncoding(Const.XML_ENCODING);
    out.print(XMLHandler.getXMLHeader(Const.XML_ENCODING));
  }
 else {
    response.setContentType("text/html");
    out.println("<HTML>");
    out.println("<HEAD>");
    out.println("<TITLE>Start job</TITLE>");
    out.println("<META http-equiv=\"Refresh\" content=\"2;url=/kettle/jobStatus?name=" + URLEncoder.encode(jobName,"UTF-8") + "\">");
    out.println("</HEAD>");
    out.println("<BODY>");
  }
  try {
    Job job=jobMap.getJob(jobName);
    if (job != null) {
      if (job.isInitialized() && !job.isActive()) {
        if (job.getRep() != null && !job.getRep().isConnected()) {
          job.getRep().connect();
        }
synchronized (jobMap) {
          JobConfiguration jobConfiguration=jobMap.getConfiguration(jobName);
          Job newJob=new Job(LogWriter.getInstance(),job.getRep(),job.getJobMeta());
          Appender appender=jobMap.getAppender(jobName);
          if (appender != null) {
            log.removeAppender(appender);
          }
          jobMap.removeAppender(jobName);
          jobMap.removeJob(jobName);
          jobMap.addJob(jobName,newJob,jobConfiguration);
          job=newJob;
        }
      }
      Log4jStringAppender appender=LogWriter.createStringAppender();
      log.addAppender(appender);
      jobMap.addAppender(jobName,appender);
      job.start();
      String message=BaseMessages.getString(PKG,"StartJobServlet.Log.JobStarted",jobName);
      if (useXML) {
        out.println(new WebResult(WebResult.STRING_OK,message).getXML());
      }
 else {
        out.println("<H1>" + message + "</H1>");
        out.println("<a href=\"/kettle/jobStatus?name=" + URLEncoder.encode(jobName,"UTF-8") + "\">"+ BaseMessages.getString(PKG,"JobStatusServlet.BackToJobStatusPage")+ "</a><p>");
      }
    }
 else {
      String message=BaseMessages.getString(PKG,"StartJobServlet.Log.SpecifiedJobNotFound",jobName);
      if (useXML) {
        out.println(new WebResult(WebResult.STRING_ERROR,message));
      }
 else {
        out.println("<H1>" + message + "</H1>");
        out.println("<a href=\"/kettle/status\">" + BaseMessages.getString(PKG,"TransStatusServlet.BackToStatusPage") + "</a><p>");
      }
    }
  }
 catch (  Exception ex) {
    if (useXML) {
      out.println(new WebResult(WebResult.STRING_ERROR,BaseMessages.getString(PKG,"StartJobServlet.Error.UnexpectedError",Const.CR + Const.getStackTracker(ex))));
    }
 else {
      out.println("<p>");
      out.println("<pre>");
      ex.printStackTrace(out);
      out.println("</pre>");
    }
  }
  if (!useXML) {
    out.println("<p>");
    out.println("</BODY>");
    out.println("</HTML>");
  }
}
