{
  NodeList list=doc.getElementsByTagName("popupset");
  Map<String,Menu> map=new HashMap<String,Menu>();
  if (list != null && list.getLength() > 0) {
    Node popupSetNode=list.item(0);
    Node menuNode=XMLHandler.getSubNode(popupSetNode,"menupopup");
    while (menuNode != null) {
      if ("menupopup".equals(menuNode.getNodeName())) {
        String id=XMLHandler.getTagAttribute(menuNode,"id");
        if (menuIds.contains(id)) {
          Menu menu=new PopupMenu(shell,id);
          map.put(id,menu);
          createMenuFromXul(menu,menuNode,xulMessages);
        }
      }
      menuNode=menuNode.getNextSibling();
    }
  }
  return map;
}
