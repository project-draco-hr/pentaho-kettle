{
  int i;
  int nrkeys, nrvalues;
  nrkeys=wKey.nrNonEmpty();
  nrvalues=wReturn.nrNonEmpty();
  input.allocate(nrkeys,nrvalues);
  input.setInputSorted(wSortedInput.getSelection());
  log.logDebug(toString(),Messages.getString("StreamLookupDialog.Log.FoundKeys",nrkeys + ""));
  for (i=0; i < nrkeys; i++) {
    TableItem item=wKey.getNonEmpty(i);
    input.getKeystream()[i]=item.getText(1);
    input.getKeylookup()[i]=item.getText(2);
  }
  log.logDebug(toString(),Messages.getString("StreamLookupDialog.Log.FoundFields",nrvalues + ""));
  for (i=0; i < nrvalues; i++) {
    TableItem item=wReturn.getNonEmpty(i);
    input.getValue()[i]=item.getText(1);
    input.getValueName()[i]=item.getText(2);
    if (input.getValueName()[i] == null || input.getValueName()[i].length() == 0)     input.getValueName()[i]=input.getValue()[i];
    input.getValueDefault()[i]=item.getText(3);
    input.getValueDefaultType()[i]=Value.getType(item.getText(4));
  }
  input.setLookupFromStep(transMeta.findStep(wStep.getText()));
  if (input.getLookupFromStep() == null) {
    MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
    mb.setMessage(Messages.getString("StreamLookupDialog.StepCanNotFound.DialogMessage",wStep.getText()));
    mb.setText(Messages.getString("StreamLookupDialog.StepCanNotFound.DialogTitle"));
    mb.open();
  }
  stepname=wStepname.getText();
  dispose();
}
