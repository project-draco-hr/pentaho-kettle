{
  String key=r.getValue(data.keyFieldNr).getString();
  Integer keyNr=(Integer)data.keyValue.get(key);
  if (keyNr != null) {
    int idx=keyNr.intValue();
    UnpivotTargetField field=meta.getPivotTargetField()[idx];
    Value targetValue=r.getValue(data.fieldNameIndex[idx]);
    int targetType=field.getTargetType();
    if (targetValue.getType() != targetType) {
switch (field.getTargetType()) {
case Value.VALUE_TYPE_STRING:
switch (targetType) {
case Value.VALUE_TYPE_DATE:
          targetValue.str2dat(field.getTargetFormat());
        break;
case Value.VALUE_TYPE_INTEGER:
      targetValue.setType(targetType);
    break;
case Value.VALUE_TYPE_NUMBER:
  targetValue.str2num(field.getTargetFormat(),field.getTargetDecimalSymbol(),field.getTargetGroupingSymbol(),field.getTargetCurrencySymbol());
break;
case Value.VALUE_TYPE_BIGNUMBER:
targetValue.setType(targetType);
break;
case Value.VALUE_TYPE_BOOLEAN:
targetValue.setType(targetType);
break;
default :
break;
}
default :
targetValue.setType(targetType);
break;
}
}
data.targetResult.getValue(idx).setValue(targetValue);
}
}
