{
  String lookup=table + "." + val_key.getName();
  Counter counter=(Counter)transMeta.getCounters().get(lookup);
  if (counter == null) {
    Row r=getOneRow("SELECT MAX(" + val_key.getName() + ") FROM "+ table);
    if (r != null) {
      counter=new Counter(r.getValue(0).getInteger() + 1,1);
      val_key.setValue(counter.next());
      transMeta.getCounters().put(lookup,counter);
    }
 else {
      throw new KettleDatabaseException("Couldn't find maximum key value from table " + table);
    }
  }
 else {
    val_key.setValue(counter.next());
  }
}
