{
  String schemaTable=databaseMeta.getQuotedSchemaTableCombination(schemaName,tableName);
  String lookup=schemaTable + "." + databaseMeta.quoteField(val_key.getName());
  Counter counter=null;
  if (counters != null)   counter=(Counter)counters.get(lookup);
  if (counter == null) {
    Row r=getOneRow("SELECT MAX(" + databaseMeta.quoteField(val_key.getName()) + ") FROM "+ schemaTable);
    if (r != null) {
      counter=new Counter(r.getValue(0).getInteger() + 1,1);
      val_key.setValue(counter.next());
      if (counters != null)       counters.put(lookup,counter);
    }
 else {
      throw new KettleDatabaseException("Couldn't find maximum key value from table " + schemaTable);
    }
  }
 else {
    val_key.setValue(counter.next());
  }
}
