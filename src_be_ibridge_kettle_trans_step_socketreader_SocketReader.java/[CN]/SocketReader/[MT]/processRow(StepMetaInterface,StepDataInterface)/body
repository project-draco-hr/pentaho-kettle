{
  meta=(SocketReaderMeta)smi;
  data=(SocketReaderData)sdi;
  try {
    Row r;
    if (first) {
      try {
        int port=Integer.parseInt(StringUtil.environmentSubstitute(meta.getPort()));
        int bufferSize=Integer.parseInt(StringUtil.environmentSubstitute(meta.getBufferSize()));
        data.socket=new Socket(StringUtil.environmentSubstitute(meta.getHostname()),port);
        if (meta.isCompressed()) {
          data.outputStream=new DataOutputStream(new BufferedOutputStream(new GZIPOutputStream(data.socket.getOutputStream()),bufferSize));
          data.inputStream=new DataInputStream(new BufferedInputStream(new GZIPInputStream(data.socket.getInputStream()),bufferSize));
        }
 else {
          data.outputStream=new DataOutputStream(new BufferedOutputStream(data.socket.getOutputStream(),bufferSize));
          data.inputStream=new DataInputStream(new BufferedInputStream(data.socket.getInputStream(),bufferSize));
        }
      }
 catch (      Exception e) {
        logError("Error initialising step: " + e.toString());
        logError(Const.getStackTracker(e));
        throw new KettleException("Unable to open socket to server " + StringUtil.environmentSubstitute(meta.getHostname()) + " port "+ StringUtil.environmentSubstitute(meta.getPort()),e);
      }
      data.row=new Row(data.inputStream);
      first=false;
    }
    r=new Row(data.inputStream,data.row.size(),data.row);
    linesInput++;
    if (checkFeedback(linesInput))     logBasic(Messages.getString("SocketReader.Log.LineNumber") + linesInput);
    putRow(r);
  }
 catch (  KettleEOFException e) {
    setOutputDone();
    return false;
  }
catch (  Exception e) {
    throw new KettleException(e);
  }
  return true;
}
