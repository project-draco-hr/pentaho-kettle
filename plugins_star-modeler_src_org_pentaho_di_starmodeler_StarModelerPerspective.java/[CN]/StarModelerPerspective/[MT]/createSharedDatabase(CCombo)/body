{
  Shell shell=Spoon.getInstance().getShell();
  boolean retry=true;
  while (retry) {
    try {
      DatabaseMeta dbMeta=new DatabaseMeta();
      DatabaseDialog databaseDialog=new DatabaseDialog(shell,dbMeta);
      if (databaseDialog.open() != null) {
        SharedDatabaseUtil.addSharedDatabase(dbMeta);
        final List<DatabaseMeta> sharedDatabases=SharedDatabaseUtil.loadSharedDatabases();
        String[] databaseNames=SharedDatabaseUtil.getSortedDatabaseNames(sharedDatabases);
        targetDatabase.setItems(databaseNames);
      }
      retry=false;
    }
 catch (    KettleObjectExistsException e) {
      new ErrorDialog(shell,BaseMessages.getString(PKG,"StarModelerPerspective.Exception.UnableToCreateSharedDB.Title"),BaseMessages.getString(PKG,"StarModelerPerspective.Exception.UnableToCreateSharedDB.Message"),e);
    }
catch (    KettleException e) {
      new ErrorDialog(shell,BaseMessages.getString(PKG,"StarModelerPerspective.Exception.UnableToCreateSharedDB.Title"),BaseMessages.getString(PKG,"StarModelerPerspective.Exception.UnableToCreateSharedDB.Message"),e);
      retry=false;
    }
  }
}
