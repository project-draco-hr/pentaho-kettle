{
  try {
    TransMeta transMeta=info.getTransMeta();
    if (Const.isEmpty(transMeta.getName()))     throw new KettleException("The transformation needs a name to uniquely identify it by on the remote server.");
    TransSplitter transSplitter=new TransSplitter(transMeta);
    transSplitter.splitOriginalTransformation();
    TransMeta master=transSplitter.getMaster();
    SlaveServer masterServer=null;
    List<StepMeta> masterSteps=master.getTransHopSteps(false);
    if (masterSteps.size() > 0) {
      masterServer=transSplitter.getMasterServer();
      if (info.show())       info.addTransGraph(master);
      if (info.post()) {
        String masterReply=masterServer.sendXML(new TransConfiguration(master,info.getExecutionConfiguration()).getXML(),AddTransServlet.CONTEXT_PATH + "/?xml=Y");
        WebResult webResult=WebResult.fromXMLString(masterReply);
        if (!webResult.getResult().equalsIgnoreCase(WebResult.STRING_OK)) {
          throw new KettleException("An error occurred sending the master transformation: " + webResult.getMessage());
        }
      }
    }
    SlaveServer slaves[]=transSplitter.getSlaveTargets();
    for (int i=0; i < slaves.length; i++) {
      TransMeta slaveTrans=(TransMeta)transSplitter.getSlaveTransMap().get(slaves[i]);
      if (info.show())       info.addTransGraph(slaveTrans);
      if (info.post()) {
        TransConfiguration transConfiguration=new TransConfiguration(slaveTrans,info.getExecutionConfiguration());
        Map<String,String> variables=transConfiguration.getTransExecutionConfiguration().getVariables();
        variables.put(Const.INTERNAL_VARIABLE_SLAVE_TRANS_NUMBER,Integer.toString(i));
        variables.put(Const.INTERNAL_VARIABLE_SLAVE_TRANS_NAME,slaves[i].getName());
        variables.put(Const.INTERNAL_VARIABLE_CLUSTER_SIZE,Integer.toString(slaves.length));
        String slaveReply=slaves[i].sendXML(transConfiguration.getXML(),AddTransServlet.CONTEXT_PATH + "/?xml=Y");
        WebResult webResult=WebResult.fromXMLString(slaveReply);
        if (!webResult.getResult().equalsIgnoreCase(WebResult.STRING_OK)) {
          throw new KettleException("An error occurred sending a slave transformation: " + webResult.getMessage());
        }
      }
    }
    if (info.post()) {
      if (info.prepare()) {
        if (masterSteps.size() > 0) {
          String masterReply=masterServer.getContentFromServer(PrepareExecutionTransServlet.CONTEXT_PATH + "/?name=" + master.getName()+ "&xml=Y");
          WebResult webResult=WebResult.fromXMLString(masterReply);
          if (!webResult.getResult().equalsIgnoreCase(WebResult.STRING_OK)) {
            throw new KettleException("An error occurred while preparing the execution of the master transformation: " + webResult.getMessage());
          }
        }
        for (int i=0; i < slaves.length; i++) {
          TransMeta slaveTrans=(TransMeta)transSplitter.getSlaveTransMap().get(slaves[i]);
          String slaveReply=slaves[i].getContentFromServer(PrepareExecutionTransServlet.CONTEXT_PATH + "/?name=" + slaveTrans.getName()+ "&xml=Y");
          WebResult webResult=WebResult.fromXMLString(slaveReply);
          if (!webResult.getResult().equalsIgnoreCase(WebResult.STRING_OK)) {
            throw new KettleException("An error occurred while preparing the execution of a slave transformation: " + webResult.getMessage());
          }
        }
      }
      if (info.start()) {
        if (masterSteps.size() > 0) {
          String masterReply=masterServer.getContentFromServer(StartExecutionTransServlet.CONTEXT_PATH + "/?name=" + master.getName()+ "&xml=Y");
          WebResult webResult=WebResult.fromXMLString(masterReply);
          if (!webResult.getResult().equalsIgnoreCase(WebResult.STRING_OK)) {
            throw new KettleException("An error occurred while starting the execution of the master transformation: " + webResult.getMessage());
          }
        }
        for (int i=0; i < slaves.length; i++) {
          TransMeta slaveTrans=(TransMeta)transSplitter.getSlaveTransMap().get(slaves[i]);
          String slaveReply=slaves[i].getContentFromServer(StartExecutionTransServlet.CONTEXT_PATH + "/?name=" + slaveTrans.getName()+ "&xml=Y");
          WebResult webResult=WebResult.fromXMLString(slaveReply);
          if (!webResult.getResult().equalsIgnoreCase(WebResult.STRING_OK)) {
            throw new KettleException("An error occurred while starting the execution of a slave transformation: " + webResult.getMessage());
          }
        }
      }
      info.addMonitors(masterServer,slaves);
    }
  }
 catch (  Exception e) {
    throw new KettleException(e);
  }
}
