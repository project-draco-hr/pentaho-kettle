{
  try {
    if (job != null && running && job.isInitialized()) {
      job.stopAll();
      job.endProcessing("stop",new Result());
      job.waitUntilFinished(5000);
      job=null;
      running=false;
      log.logMinimal(Spoon.APP_NAME,BaseMessages.getString(PKG,"JobLog.Log.JobWasStopped"));
    }
  }
 catch (  KettleJobException je) {
    MessageBox m=new MessageBox(shell,SWT.OK | SWT.ICON_WARNING);
    m.setText(BaseMessages.getString(PKG,"JobLog.Dialog.UnableToSaveStopLineInLoggingTable.Title"));
    m.setMessage(BaseMessages.getString(PKG,"JobLog.Dialog.UnableToSaveStopLineInLoggingTable.Message") + Const.CR + je.toString());
    m.open();
  }
 finally {
    setControlStates();
  }
}
