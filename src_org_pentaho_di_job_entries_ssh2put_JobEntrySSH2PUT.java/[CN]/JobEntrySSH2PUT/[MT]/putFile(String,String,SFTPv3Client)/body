{
  LogWriter log=LogWriter.getInstance();
  long filesize=-1;
  FileInputStream in=null;
  BufferedInputStream inBuf=null;
  SFTPv3FileHandle sftpFileHandle=null;
  boolean retval=false;
  try {
    sftpFileHandle=sftpClient.createFileTruncate(remotefilename);
    in=new FileInputStream(localfilename);
    inBuf=new BufferedInputStream(in);
    long bytesWritten=0;
    byte[] buf=new byte[2048];
    long length=new File(localfilename).length();
    while (bytesWritten != length) {
      int len=inBuf.read(buf,0,buf.length);
      sftpClient.write(sftpFileHandle,bytesWritten,buf,0,len);
      bytesWritten+=len;
    }
    filesize=getFileSize(sftpClient,remotefilename);
    if (log.isDetailed())     log.logDetailed(toString(),Messages.getString("JobSSH2PUT.Log.FileOnRemoteHost",remotefilename,"" + filesize));
    retval=true;
  }
 catch (  Exception e) {
    log.logError(toString(),Messages.getString("JobSSH2PUT.Log.ErrorCopyingFile",localfilename));
  }
 finally {
    if (in != null)     try {
      in.close();
      in=null;
    }
 catch (    Exception ex) {
    }
    if (inBuf != null)     try {
      inBuf.close();
      inBuf=null;
    }
 catch (    Exception ex) {
    }
    if (sftpFileHandle != null)     try {
      sftpClient.closeFile(sftpFileHandle);
      sftpFileHandle=null;
    }
 catch (    Exception ex) {
    }
  }
  return retval;
}
