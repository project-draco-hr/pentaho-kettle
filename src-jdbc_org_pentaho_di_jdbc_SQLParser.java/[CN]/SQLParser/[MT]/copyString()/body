{
  char saveTc=terminator;
  char tc=in[s];
  if (tc == '[') {
    tc=']';
  }
  terminator=tc;
  out[d++]=in[s++];
  while (in[s] != tc) {
    out[d++]=in[s++];
  }
  out[d++]=in[s++];
  terminator=saveTc;
}
