{
  before_edit=getItemText(row);
  field_changed=false;
  if (columns[colnr - 1].isReadOnly()) {
    return;
  }
  if (text != null && !text.isDisposed())   text.dispose();
  if (columns[colnr - 1].getSelectionAdapter() != null) {
    Event e=new Event();
    e.widget=this;
    e.x=colnr;
    e.y=rownr;
    columns[colnr - 1].getSelectionAdapter().widgetSelected(new SelectionEvent(e));
    return;
  }
  String content=row.getText(colnr) + (extra != 0 ? "" + extra : "");
  String tooltip=columns[colnr - 1].getToolTip();
  ModifyListener modifyListener=new ModifyListener(){
    public void modifyText(    ModifyEvent me){
      String str=getTextWidgetValue(colnr);
      int strmax=dummy_gc.textExtent(str,SWT.DRAW_TAB | SWT.DRAW_DELIMITER).x + 5;
      int colmax=tablecolumn[colnr].getWidth();
      if (strmax > colmax) {
        tablecolumn[colnr].setWidth(strmax + 40);
      }
    }
  }
;
  boolean useVariables=columns[colnr - 1].isUsingVariables();
  if (useVariables) {
    TextVar textWidget=new TextVar(table,SWT.NONE);
    text=textWidget;
    textWidget.setText(content);
    if (lsMod != null)     textWidget.addModifyListener(lsMod);
    textWidget.addModifyListener(lsUndo);
    textWidget.setSelection(content.length());
    textWidget.addKeyListener(lsKeyText);
    textWidget.addModifyListener(modifyListener);
    if (select_text)     textWidget.selectAll();
    if (tooltip != null)     textWidget.setToolTipText(tooltip);
 else     textWidget.setToolTipText("");
  }
 else {
    Text textWidget=new Text(table,SWT.NONE);
    text=textWidget;
    textWidget.setText(content);
    if (lsMod != null)     textWidget.addModifyListener(lsMod);
    textWidget.addModifyListener(lsUndo);
    textWidget.setSelection(content.length());
    textWidget.addKeyListener(lsKeyText);
    textWidget.addModifyListener(modifyListener);
    if (select_text)     textWidget.selectAll();
    if (tooltip != null)     textWidget.setToolTipText(tooltip);
 else     textWidget.setToolTipText("");
  }
  props.setLook(text,Props.WIDGET_STYLE_TABLE);
  text.addTraverseListener(lsTraverse);
  text.addFocusListener(lsFocusText);
  int width=tablecolumn[colnr].getWidth();
  int height=30;
  editor.horizontalAlignment=SWT.LEFT;
  editor.grabHorizontal=true;
  editor.setEditor(text,row,colnr);
  text.setFocus();
  text.setSize(width,height);
  editor.layout();
}
