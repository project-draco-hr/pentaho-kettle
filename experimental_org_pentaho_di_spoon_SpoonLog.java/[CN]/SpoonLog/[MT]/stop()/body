{
  if (running && !halting) {
    halting=true;
    trans.stopAll();
    try {
      trans.endProcessing("stop");
      log.logMinimal(Spoon.APP_NAME,Messages.getString("SpoonLog.Log.ProcessingOfTransformationStopped"));
    }
 catch (    KettleException e) {
      new ErrorDialog(shell,Messages.getString("SpoonLog.Dialog.ErrorWritingLogRecord.Title"),Messages.getString("SpoonLog.Dialog.ErrorWritingLogRecord.Message"),e);
    }
    wStart.setEnabled(true);
    wStop.setEnabled(false);
    running=false;
    initialized=false;
    halted=false;
    halting=false;
    if (preview) {
      preview=false;
      showPreview();
    }
    transMeta.setInternalKettleVariables();
  }
}
