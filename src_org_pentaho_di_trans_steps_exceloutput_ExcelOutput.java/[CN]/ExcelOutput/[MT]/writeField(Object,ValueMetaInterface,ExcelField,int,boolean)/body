{
  try {
    String hashName=vMeta.getName();
    if (isHeader)     hashName="____header_field____";
    WritableCellFormat cellFormat=(WritableCellFormat)data.formats.get(hashName);
    if (cellFormat == null && meta.isTemplateEnabled() && !isHeader) {
      try {
        if (column < data.templateColumns) {
          cellFormat=new WritableCellFormat(data.sheet.getColumnView(column).getFormat());
          data.formats.put(hashName,cellFormat);
        }
      }
 catch (      RuntimeException e) {
      }
    }
switch (vMeta.getType()) {
case ValueMetaInterface.TYPE_DATE:
{
        if (v != null && vMeta.getDate(v) != null) {
          if (cellFormat == null) {
            if (excelField != null && excelField.getFormat() != null) {
              DateFormat dateFormat=new DateFormat(excelField.getFormat());
              cellFormat=new WritableCellFormat(dateFormat);
            }
 else {
              cellFormat=new WritableCellFormat(DateFormats.FORMAT9);
            }
            data.formats.put(hashName,cellFormat);
          }
          DateTime dateTime=new DateTime(data.positionX,data.positionY,vMeta.getDate(v),cellFormat);
          data.sheet.addCell(dateTime);
        }
 else {
          data.sheet.addCell(new Label(data.positionX,data.positionY,""));
        }
      }
    break;
case ValueMetaInterface.TYPE_STRING:
case ValueMetaInterface.TYPE_BOOLEAN:
case ValueMetaInterface.TYPE_BINARY:
{
    if (v != null) {
      if (cellFormat == null) {
        cellFormat=new WritableCellFormat(data.writableFont);
        data.formats.put(hashName,cellFormat);
      }
      Label label=new Label(data.positionX,data.positionY,vMeta.getString(v),cellFormat);
      data.sheet.addCell(label);
    }
 else {
      data.sheet.addCell(new Label(data.positionX,data.positionY,""));
    }
  }
break;
case ValueMetaInterface.TYPE_NUMBER:
case ValueMetaInterface.TYPE_BIGNUMBER:
case ValueMetaInterface.TYPE_INTEGER:
{
if (v != null) {
  if (cellFormat == null) {
    String format;
    if (excelField != null && excelField.getFormat() != null) {
      format=excelField.getFormat();
    }
 else {
      format="###,###.00";
    }
    NumberFormat numberFormat=new NumberFormat(format);
    cellFormat=new WritableCellFormat(numberFormat);
    data.formats.put(vMeta.getName(),cellFormat);
  }
  jxl.write.Number number=new jxl.write.Number(data.positionX,data.positionY,vMeta.getNumber(v),cellFormat);
  data.sheet.addCell(number);
}
 else {
  data.sheet.addCell(new Label(data.positionX,data.positionY,""));
}
}
break;
default :
break;
}
}
 catch (Exception e) {
logError("Error writing field (" + data.positionX + ","+ data.positionY+ ") : "+ e.toString());
logError(Const.getStackTracker(e));
return false;
}
 finally {
data.positionX++;
}
return true;
}
