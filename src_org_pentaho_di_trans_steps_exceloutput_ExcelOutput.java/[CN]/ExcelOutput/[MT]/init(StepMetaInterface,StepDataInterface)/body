{
  meta=(ExcelOutputMeta)smi;
  data=(ExcelOutputData)sdi;
  if (super.init(smi,sdi)) {
    data.splitnr=0;
    data.realSheetname=environmentSubstitute(meta.getSheetname());
    data.ws=new WorkbookSettings();
    data.ws.setLocale(Locale.getDefault());
    data.Headerrowheight=Const.toInt(environmentSubstitute(meta.getHeaderRowHeight()),-1);
    data.realHeaderImage=environmentSubstitute(meta.getHeaderImage());
    if (!Const.isEmpty(meta.getEncoding()))     data.ws.setEncoding(meta.getEncoding());
    try {
      setFonts();
    }
 catch (    Exception we) {
      logError("Erreur preparing fonts, colors for header and rows: " + we.toString());
      return false;
    }
    if (!meta.isDoNotOpenNewFileInit()) {
      data.oneFileOpened=true;
      addFilenameToResult();
      if (openNewFile()) {
        return true;
      }
 else {
        logError("Couldn't open file " + meta.getFileName());
        setErrors(1L);
        stopAll();
      }
    }
 else {
      return true;
    }
  }
  return false;
}
