{
  FileOutputStream fos=null;
  BufferedOutputStream bos=null;
  File file=null;
  BufferedInputStream bis=null;
  try {
    if (filename == null) {
      filename=File.createTempFile("xx",".out").getName();
    }
    file=new File(foldername,filename);
    for (int i=0; file.exists(); i++) {
      file=new File(foldername,filename + i);
    }
    fos=new FileOutputStream(file);
    bos=new BufferedOutputStream(fos);
    bis=new BufferedInputStream(input);
    int aByte;
    while ((aByte=bis.read()) != -1) {
      bos.write(aByte);
    }
  }
 catch (  Exception e) {
    throw new KettleException(e);
  }
 finally {
    try {
      if (bos != null) {
        bos.flush();
        bos.close();
      }
      ;
      if (bis != null) {
        bis.close();
        bis=null;
      }
      ;
      file=null;
    }
 catch (    Exception e) {
    }
    ;
  }
}
