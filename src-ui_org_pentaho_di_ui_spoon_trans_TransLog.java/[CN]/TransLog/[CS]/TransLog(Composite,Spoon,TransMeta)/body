{
  super(parent,SWT.NONE);
  shell=parent.getShell();
  this.spoon=spoon;
  this.transMeta=transMeta;
  trans=null;
  display=shell.getDisplay();
  running=false;
  debug=false;
  lastUpdateView=0L;
  FormLayout formLayout=new FormLayout();
  formLayout.marginWidth=Const.FORM_MARGIN;
  formLayout.marginHeight=Const.FORM_MARGIN;
  setLayout(formLayout);
  setVisible(true);
  spoon.props.setLook(this);
  SashForm sash=new SashForm(this,SWT.VERTICAL);
  spoon.props.setLook(sash);
  sash.setLayout(new FillLayout());
  colinf=new ColumnInfo[]{new ColumnInfo(Messages.getString("TransLog.Column.Stepname"),ColumnInfo.COLUMN_TYPE_TEXT,false,true),new ColumnInfo(Messages.getString("TransLog.Column.Copynr"),ColumnInfo.COLUMN_TYPE_TEXT,false,true),new ColumnInfo(Messages.getString("TransLog.Column.Read"),ColumnInfo.COLUMN_TYPE_TEXT,false,true),new ColumnInfo(Messages.getString("TransLog.Column.Written"),ColumnInfo.COLUMN_TYPE_TEXT,false,true),new ColumnInfo(Messages.getString("TransLog.Column.Input"),ColumnInfo.COLUMN_TYPE_TEXT,false,true),new ColumnInfo(Messages.getString("TransLog.Column.Output"),ColumnInfo.COLUMN_TYPE_TEXT,false,true),new ColumnInfo(Messages.getString("TransLog.Column.Updated"),ColumnInfo.COLUMN_TYPE_TEXT,false,true),new ColumnInfo(Messages.getString("TransLog.Column.Rejected"),ColumnInfo.COLUMN_TYPE_TEXT,false,true),new ColumnInfo(Messages.getString("TransLog.Column.Errors"),ColumnInfo.COLUMN_TYPE_TEXT,false,true),new ColumnInfo(Messages.getString("TransLog.Column.Active"),ColumnInfo.COLUMN_TYPE_TEXT,false,true),new ColumnInfo(Messages.getString("TransLog.Column.Time"),ColumnInfo.COLUMN_TYPE_TEXT,false,true),new ColumnInfo(Messages.getString("TransLog.Column.Speed"),ColumnInfo.COLUMN_TYPE_TEXT,false,true),new ColumnInfo(Messages.getString("TransLog.Column.PriorityBufferSizes"),ColumnInfo.COLUMN_TYPE_TEXT,false,true)};
  colinf[1].setAllignement(SWT.RIGHT);
  colinf[2].setAllignement(SWT.RIGHT);
  colinf[3].setAllignement(SWT.RIGHT);
  colinf[4].setAllignement(SWT.RIGHT);
  colinf[5].setAllignement(SWT.RIGHT);
  colinf[6].setAllignement(SWT.RIGHT);
  colinf[7].setAllignement(SWT.RIGHT);
  colinf[8].setAllignement(SWT.RIGHT);
  colinf[9].setAllignement(SWT.RIGHT);
  colinf[10].setAllignement(SWT.RIGHT);
  colinf[11].setAllignement(SWT.RIGHT);
  colinf[12].setAllignement(SWT.RIGHT);
  wFields=new TableView(transMeta,sash,SWT.BORDER | SWT.FULL_SELECTION | SWT.MULTI,colinf,1,true,null,spoon.props);
  wText=new Text(sash,SWT.MULTI | SWT.V_SCROLL | SWT.H_SCROLL| SWT.READ_ONLY);
  spoon.props.setLook(wText);
  wText.setVisible(true);
  wStart=new Button(this,SWT.PUSH);
  wStart.setText(START_TEXT);
  wStart.setEnabled(true);
  wPause=new Button(this,SWT.PUSH);
  wPause.setText(PAUSE_TEXT);
  wPause.setEnabled(false);
  wStop=new Button(this,SWT.PUSH);
  wStop.setText(STOP_TEXT);
  wStop.setEnabled(false);
  wPreview=new Button(this,SWT.PUSH);
  wPreview.setText(Messages.getString("TransLog.Button.Preview"));
  wError=new Button(this,SWT.PUSH);
  wError.setText(Messages.getString("TransLog.Button.ShowErrorLines"));
  wClear=new Button(this,SWT.PUSH);
  wClear.setText(Messages.getString("TransLog.Button.ClearLog"));
  wLog=new Button(this,SWT.PUSH);
  wLog.setText(Messages.getString("TransLog.Button.LogSettings"));
  wOnlyActive=new Button(this,SWT.CHECK);
  wOnlyActive.setText(Messages.getString("TransLog.Button.ShowOnlyActiveSteps"));
  spoon.props.setLook(wOnlyActive);
  wSafeMode=new Button(this,SWT.CHECK);
  wSafeMode.setText(Messages.getString("TransLog.Button.SafeMode"));
  spoon.props.setLook(wSafeMode);
  fdStart=new FormData();
  fdStart.left=new FormAttachment(0,10);
  fdStart.bottom=new FormAttachment(100,0);
  wStart.setLayoutData(fdStart);
  fdPause=new FormData();
  fdPause.left=new FormAttachment(wStart,10);
  fdPause.bottom=new FormAttachment(100,0);
  wPause.setLayoutData(fdPause);
  fdStop=new FormData();
  fdStop.left=new FormAttachment(wPause,10);
  fdStop.bottom=new FormAttachment(100,0);
  wStop.setLayoutData(fdStop);
  fdPreview=new FormData();
  fdPreview.left=new FormAttachment(wStop,10);
  fdPreview.bottom=new FormAttachment(100,0);
  wPreview.setLayoutData(fdPreview);
  fdError=new FormData();
  fdError.left=new FormAttachment(wPreview,10);
  fdError.bottom=new FormAttachment(100,0);
  wError.setLayoutData(fdError);
  fdClear=new FormData();
  fdClear.left=new FormAttachment(wError,10);
  fdClear.bottom=new FormAttachment(100,0);
  wClear.setLayoutData(fdClear);
  fdLog=new FormData();
  fdLog.left=new FormAttachment(wClear,10);
  fdLog.bottom=new FormAttachment(100,0);
  wLog.setLayoutData(fdLog);
  fdOnlyActive=new FormData();
  fdOnlyActive.left=new FormAttachment(wLog,Const.MARGIN);
  fdOnlyActive.bottom=new FormAttachment(100,0);
  wOnlyActive.setLayoutData(fdOnlyActive);
  wOnlyActive.addSelectionListener(new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent arg0){
      spoon.props.setOnlyActiveSteps(wOnlyActive.getSelection());
    }
  }
);
  wOnlyActive.setSelection(spoon.props.getOnlyActiveSteps());
  fdSafeMode=new FormData();
  fdSafeMode.left=new FormAttachment(wOnlyActive,Const.MARGIN);
  fdSafeMode.bottom=new FormAttachment(100,0);
  wSafeMode.setLayoutData(fdSafeMode);
  fdText=new FormData();
  fdText.left=new FormAttachment(0,0);
  fdText.top=new FormAttachment(0,0);
  fdText.right=new FormAttachment(100,0);
  fdText.bottom=new FormAttachment(100,0);
  wText.setLayoutData(fdText);
  fdSash=new FormData();
  fdSash.left=new FormAttachment(0,0);
  fdSash.top=new FormAttachment(0,0);
  fdSash.right=new FormAttachment(100,0);
  fdSash.bottom=new FormAttachment(wStart,-5);
  sash.setLayoutData(fdSash);
  pack();
  stringAppender=LogWriter.createStringAppender();
  stringAppender.setMaxNrLines(Props.getInstance().getMaxNrLinesInLog());
  stringAppender.addBufferChangedListener(new BufferChangedListener(){
    public void contentWasAdded(    final StringBuffer content,    final String extra,    final int nrLines){
      display.asyncExec(new Runnable(){
        public void run(){
          if (!wText.isDisposed()) {
            textSize++;
            if (textSize >= nrLines + 200) {
              wText.setText(content.toString());
              wText.setSelection(content.length());
              wText.showSelection();
              wText.clearSelection();
              textSize=nrLines;
            }
 else {
              wText.append(extra);
            }
          }
        }
      }
);
    }
  }
);
  log.addAppender(stringAppender);
  addDisposeListener(new DisposeListener(){
    public void widgetDisposed(    DisposeEvent e){
      log.removeAppender(stringAppender);
    }
  }
);
  lsError=new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      showErrors();
    }
  }
;
  final Timer tim=new Timer("TransLog: " + getMeta().getName());
  final StringBuffer busy=new StringBuffer("N");
  TimerTask timtask=new TimerTask(){
    public void run(){
      if (display != null && !display.isDisposed()) {
        display.asyncExec(new Runnable(){
          public void run(){
            if (busy.toString().equals("N")) {
              busy.setCharAt(0,'Y');
              checkStartThreads();
              checkTransEnded();
              checkErrors();
              refreshView();
              busy.setCharAt(0,'N');
            }
          }
        }
);
      }
    }
  }
;
  tim.schedule(timtask,0L,REFRESH_TIME);
  lsStart=new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      spoon.executeTransformation(transMeta,true,false,false,false,false,null);
    }
  }
;
  lsPause=new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      pauseResume();
    }
  }
;
  lsStop=new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      stop();
    }
  }
;
  lsPreview=new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      spoon.executeTransformation(transMeta,true,false,false,true,false,null);
    }
  }
;
  lsClear=new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      clearLog();
    }
  }
;
  lsLog=new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      setLog();
    }
  }
;
  wError.addSelectionListener(lsError);
  wStart.addSelectionListener(lsStart);
  wPause.addSelectionListener(lsPause);
  wStop.addSelectionListener(lsStop);
  wPreview.addSelectionListener(lsPreview);
  wClear.addSelectionListener(lsClear);
  wLog.addSelectionListener(lsLog);
  addDisposeListener(new DisposeListener(){
    public void widgetDisposed(    DisposeEvent e){
      tim.cancel();
    }
  }
);
}
