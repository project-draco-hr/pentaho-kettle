{
  before_edit=getItemText(row);
  field_changed=false;
  if (columns[colnr - 1].isReadOnly()) {
    return;
  }
  if (text != null && !text.isDisposed())   text.dispose();
  if (columns[colnr - 1].getSelectionAdapter() != null) {
    Event e=new Event();
    e.widget=this;
    e.x=colnr;
    e.y=rownr;
    columns[colnr - 1].getSelectionAdapter().widgetSelected(new SelectionEvent(e));
    return;
  }
  String content=row.getText(colnr) + (extra != 0 ? "" + extra : "");
  String tooltip=columns[colnr - 1].getToolTip();
  final boolean useVariables=columns[colnr - 1].isUsingVariables();
  final boolean passwordField=columns[colnr - 1].isPasswordField();
  final ModifyListener modifyListener=new ModifyListener(){
    public void modifyText(    ModifyEvent me){
      setColumnWidthBasedOnTextField(colnr,useVariables);
    }
  }
;
  if (useVariables) {
    GetCaretPositionInterface getCaretPositionInterface=new GetCaretPositionInterface(){
      public int getCaretPosition(){
        return ((TextVar)text).getTextWidget().getCaretPosition();
      }
    }
;
    InsertTextInterface insertTextInterface=new InsertTextInterface(){
      public void insertText(      String string,      int position){
        StringBuffer buffer=new StringBuffer(table.getItem(rownr).getText(colnr));
        buffer.insert(position,string);
        table.getItem(rownr).setText(colnr,buffer.toString());
        int newPosition=position + string.length();
        edit(rownr,colnr);
        ((TextVar)text).setSelection(newPosition);
        ((TextVar)text).showSelection();
        setColumnWidthBasedOnTextField(colnr,useVariables);
      }
    }
;
    final TextVar textWidget=new TextVar(table,SWT.NONE,getCaretPositionInterface,insertTextInterface);
    text=textWidget;
    textWidget.setText(content);
    if (lsMod != null)     textWidget.addModifyListener(lsMod);
    textWidget.addModifyListener(lsUndo);
    textWidget.setSelection(content.length());
    textWidget.addKeyListener(lsKeyText);
    textWidget.addModifyListener(modifyListener);
    if (select_text)     textWidget.selectAll();
    if (tooltip != null)     textWidget.setToolTipText(tooltip);
 else     textWidget.setToolTipText("");
    textWidget.addTraverseListener(lsTraverse);
    textWidget.addFocusListener(lsFocusText);
    if (passwordField) {
      textWidget.setEchoChar('*');
      textWidget.addModifyListener(new ModifyListener(){
        public void modifyText(        ModifyEvent arg0){
          DatabaseDialog.checkPasswordVisible(textWidget.getTextWidget());
        }
      }
);
    }
  }
 else {
    Text textWidget=new Text(table,SWT.NONE);
    text=textWidget;
    textWidget.setText(content);
    if (lsMod != null)     textWidget.addModifyListener(lsMod);
    textWidget.addModifyListener(lsUndo);
    textWidget.setSelection(content.length());
    textWidget.addKeyListener(lsKeyText);
    textWidget.addModifyListener(modifyListener);
    if (select_text)     textWidget.selectAll();
    if (tooltip != null)     textWidget.setToolTipText(tooltip);
 else     textWidget.setToolTipText("");
    textWidget.addTraverseListener(lsTraverse);
    textWidget.addFocusListener(lsFocusText);
    if (passwordField) {
      textWidget.setEchoChar('*');
    }
  }
  props.setLook(text,Props.WIDGET_STYLE_TABLE);
  int width=tablecolumn[colnr].getWidth();
  int height=30;
  editor.horizontalAlignment=SWT.LEFT;
  editor.grabHorizontal=true;
  editor.setEditor(text,row,colnr);
  text.setFocus();
  text.setSize(width,height);
  editor.layout();
}
