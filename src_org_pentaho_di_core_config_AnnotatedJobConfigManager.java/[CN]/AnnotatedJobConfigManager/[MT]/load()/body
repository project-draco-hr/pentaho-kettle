{
  int oldLogLevel=LogWriter.getInstance().getLogLevel();
  ResolverUtil<JobPluginMeta> resolver=new ResolverUtil<JobPluginMeta>();
  String allPackages=packages;
  String extraPackages=System.getProperty(Const.KETTLE_PLUGIN_PACKAGES);
  if (!Const.isEmpty(extraPackages)) {
    allPackages+="," + extraPackages;
  }
  resolver.find(new ResolverUtil.AnnotatedWith(Job.class),allPackages != null ? allPackages.split(",") : new String[]{});
  Collection<JobPluginMeta> jobs=new LinkedHashSet<JobPluginMeta>(resolver.size());
  for (  Class<?> clazz : resolver.getClasses()) {
    Job job=clazz.getAnnotation(Job.class);
    String jobId=job.id();
    if (jobId.equals(""))     jobId=clazz.getName();
    String packageName=job.i18nPackageName();
    if (Const.isEmpty(packageName))     packageName=org.pentaho.di.job.entry.Messages.class.getPackage().getName();
    String altPackageName=clazz.getPackage().getName();
    LogWriter.getInstance().setLogLevel(LogWriter.LOG_LEVEL_BASIC);
    String name=BaseMessages.getString(packageName,job.name());
    if (name.startsWith("!") && name.endsWith("!"))     name=Messages.getString(job.name());
    LogWriter.getInstance().setLogLevel(oldLogLevel);
    if (!Const.isEmpty(job.name()) && name.startsWith("!") && name.endsWith("!"))     name=BaseMessages.getString(altPackageName,job.name());
    if (name.startsWith("!") && name.endsWith("!"))     name=job.name();
    LogWriter.getInstance().setLogLevel(LogWriter.LOG_LEVEL_BASIC);
    String tooltip=BaseMessages.getString(packageName,job.tooltip());
    if (tooltip.startsWith("!") && tooltip.endsWith("!"))     tooltip=Messages.getString(job.tooltip());
    LogWriter.getInstance().setLogLevel(oldLogLevel);
    if (tooltip.startsWith("!") && tooltip.endsWith("!"))     tooltip=BaseMessages.getString(altPackageName,job.tooltip());
    if (tooltip.startsWith("!") && tooltip.endsWith("!"))     tooltip=job.tooltip();
    if (Const.isEmpty(name))     name=tooltip;
    String category;
    if (job.category() != JobEntryCategory.CATEGORY_USER_DEFINED) {
      category=JobEntryCategory.STANDARD_CATEGORIES[job.category()].getName();
    }
 else {
      LogWriter.getInstance().setLogLevel(LogWriter.LOG_LEVEL_BASIC);
      category=BaseMessages.getString(packageName,job.categoryDescription());
      if (category.startsWith("!") && category.endsWith("!"))       category=Messages.getString(job.categoryDescription());
      LogWriter.getInstance().setLogLevel(oldLogLevel);
      if (category.startsWith("!") && category.endsWith("!"))       category=BaseMessages.getString(altPackageName,job.categoryDescription());
    }
    jobs.add(new JobPluginMeta(clazz,jobId,job.type(),name,tooltip,job.image(),category));
  }
  return (Collection<T>)jobs;
}
