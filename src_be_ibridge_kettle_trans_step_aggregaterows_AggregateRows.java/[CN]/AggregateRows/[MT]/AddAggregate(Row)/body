{
  int i;
  Value val=null;
  for (i=0; i < data.fieldnrs.length; i++) {
    val=r.getValue(data.fieldnrs[i]);
    if (!val.isNull()) {
      data.counts[i]++;
switch (meta.getAggregateType()[i]) {
case AggregateRowsMeta.TYPE_AGGREGATE_SUM:
case AggregateRowsMeta.TYPE_AGGREGATE_AVERAGE:
        if (data.values[i] == null) {
          data.values[i]=new Value(val);
        }
 else {
          data.values[i].setValue(data.values[i].getNumber() + val.getNumber());
        }
      break;
case AggregateRowsMeta.TYPE_AGGREGATE_MIN:
    if (data.values[i] == null) {
      data.values[i]=new Value(val);
    }
 else {
      if (val.compare(data.values[i]) < 0)       data.values[i]=val;
    }
  break;
case AggregateRowsMeta.TYPE_AGGREGATE_MAX:
if (data.values[i] == null) {
  data.values[i]=new Value(val);
}
 else {
  if (val.compare(data.values[i]) > 0)   data.values[i]=val;
}
break;
case AggregateRowsMeta.TYPE_AGGREGATE_NONE:
case AggregateRowsMeta.TYPE_AGGREGATE_FIRST:
if (data.values[i] == null) {
data.values[i]=new Value(val);
}
break;
case AggregateRowsMeta.TYPE_AGGREGATE_LAST:
data.values[i]=new Value(val);
break;
}
}
 else {
if (data.values[i] == null) {
data.values[i]=new Value(meta.getFieldName()[i],val.getType());
data.values[i].setNull();
}
}
switch (meta.getAggregateType()[i]) {
case AggregateRowsMeta.TYPE_AGGREGATE_FIRST_NULL:
if (data.values[i] == null) {
data.values[i]=new Value(val);
}
break;
case AggregateRowsMeta.TYPE_AGGREGATE_LAST_NULL:
data.values[i]=new Value(val);
break;
default :
break;
}
}
}
