{
  int pos=hasDatabasesInterface.indexOfDatabase(db);
  boolean worked=false;
  Repository rep=spoon.getRepository();
  if (rep != null) {
    if (!rep.getUserInfo().isReadonly()) {
      try {
        long id_database=rep.getDatabaseID(db.getName());
        rep.delDatabase(id_database);
        worked=true;
      }
 catch (      KettleException dbe) {
        new ErrorDialog(spoon.getShell(),Messages.getString("Spoon.Dialog.ErrorDeletingConnection.Title"),Messages.getString("Spoon.Dialog.ErrorDeletingConnection.Message",db.getName()),dbe);
      }
    }
 else {
      new ErrorDialog(spoon.getShell(),Messages.getString("Spoon.Dialog.ErrorDeletingConnection.Title"),Messages.getString("Spoon.Dialog.ErrorDeletingConnection.Message",db.getName()),new KettleException(Messages.getString("Spoon.Dialog.Exception.ReadOnlyUser")));
    }
  }
  if (spoon.getRepository() == null || worked) {
    spoon.addUndoDelete((UndoInterface)hasDatabasesInterface,new DatabaseMeta[]{(DatabaseMeta)db.clone()},new int[]{pos});
    hasDatabasesInterface.removeDatabase(pos);
    DBCache.getInstance().clear(db.getName());
  }
  spoon.refreshTree();
  spoon.setShellText();
}
