{
  if (isJettyMode() && !request.getContextPath().startsWith(CONTEXT_PATH)) {
    return;
  }
  if (log.isDebug())   logDebug(BaseMessages.getString(PKG,"LisDataServicesServlet.ListRequested"));
  response.setStatus(HttpServletResponse.SC_OK);
  Map<String,String> parameters=TransDataServlet.getParametersFromRequestHeader(request);
  response.setContentType("text/xml");
  response.getWriter().println(XMLHandler.getXMLHeader());
  response.getWriter().println(XMLHandler.openTag(XML_TAG_SERVICES));
  List<TransDataService> services=new ArrayList<TransDataService>(transformationMap.getSlaveServerConfig().getServices());
  IMetaStore metaStore=transformationMap.getSlaveServerConfig().getMetaStore();
  Repository repository=transformationMap.getSlaveServerConfig().getRepository();
  if (repository != null) {
    try {
      List<DataServiceMeta> dataServices=DataServiceMetaStoreUtil.getDataServices(metaStore);
      for (      DataServiceMeta dataService : dataServices) {
        if (!Const.isEmpty(dataService.getName()) && !Const.isEmpty(dataService.getStepname())) {
          services.add(new TransDataService(dataService.getName(),null,dataService.getObjectId(),dataService.getStepname()));
        }
      }
    }
 catch (    Exception e) {
      log.logError("Unable to list extra repository services",e);
    }
  }
  for (  TransDataService service : services) {
    response.getWriter().println(XMLHandler.openTag(XML_TAG_SERVICE));
    response.getWriter().println(XMLHandler.addTagValue("name",service.getName()));
    try {
      TransMeta transMeta=null;
      if (service.getObjectId() != null) {
        transMeta=repository.loadTransformation(service.getObjectId(),null);
      }
 else {
        transMeta=new TransMeta(service.getFileName());
      }
      for (      String name : parameters.keySet()) {
        transMeta.setParameterValue(name,parameters.get(name));
      }
      transMeta.activateParameters();
      RowMetaInterface serviceFields=transMeta.getStepFields(service.getServiceStepName());
      response.getWriter().println(serviceFields.getMetaXML());
    }
 catch (    Exception e) {
      log.logError("Unable to get fields for service " + service.getName() + ", transformation: "+ service.getFileName());
    }
    response.getWriter().println(XMLHandler.closeTag(XML_TAG_SERVICE));
  }
  response.getWriter().println(XMLHandler.closeTag(XML_TAG_SERVICES));
}
