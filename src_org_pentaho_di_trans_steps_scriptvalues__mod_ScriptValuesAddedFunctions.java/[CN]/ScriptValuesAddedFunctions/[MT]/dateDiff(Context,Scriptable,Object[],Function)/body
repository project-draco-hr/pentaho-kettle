{
  if (ArgList.length == 3) {
    try {
      if (isNull(ArgList,new int[]{0,1,2}))       return new Double(Double.NaN);
 else       if (isUndefined(ArgList,new int[]{0,1,2}))       return Context.getUndefinedValue();
 else {
        java.util.Date dIn1=(java.util.Date)Context.jsToJava(ArgList[0],java.util.Date.class);
        java.util.Date dIn2=(java.util.Date)Context.jsToJava(ArgList[1],java.util.Date.class);
        String strType=Context.toString(ArgList[2]);
        int iRC=0;
        Calendar startDate=Calendar.getInstance();
        Calendar endDate=Calendar.getInstance();
        startDate.setTime(dIn1);
        endDate.setTime(dIn2);
        long endL=endDate.getTimeInMillis() + endDate.getTimeZone().getOffset(endDate.getTimeInMillis());
        long startL=startDate.getTimeInMillis() + startDate.getTimeZone().getOffset(startDate.getTimeInMillis());
        if (strType.toLowerCase().equals("y")) {
          return new Double(endDate.get(Calendar.YEAR) - startDate.get(Calendar.YEAR));
        }
 else         if (strType.toLowerCase().equals("m")) {
          int iMonthsToAdd=(int)(endDate.get(Calendar.YEAR) - startDate.get(Calendar.YEAR)) * 12;
          return new Double((endDate.get(Calendar.MONTH) - startDate.get(Calendar.MONTH)) + iMonthsToAdd);
        }
 else         if (strType.toLowerCase().equals("d")) {
          return new Double(((endL - startL) / 86400000));
        }
 else         if (strType.toLowerCase().equals("wd")) {
          int iOffset=-1;
          if (endDate.before(startDate))           iOffset=1;
          while (endL < startL || endL > startL) {
            int day=endDate.get(Calendar.DAY_OF_WEEK);
            if ((day != Calendar.SATURDAY) && (day != Calendar.SUNDAY))             iRC++;
            endDate.add(Calendar.DATE,iOffset);
            endL=endDate.getTimeInMillis() + endDate.getTimeZone().getOffset(endDate.getTimeInMillis());
          }
          return new Double(iRC);
        }
 else         if (strType.toLowerCase().equals("w")) {
          int iDays=(int)((endL - startL) / 86400000);
          return new Double(iDays / 7);
        }
 else         if (strType.toLowerCase().equals("ss")) {
          return new Double(((endL - startL) / 1000));
        }
 else         if (strType.toLowerCase().equals("mi")) {
          return new Double(((endL - startL) / 60000));
        }
 else         if (strType.toLowerCase().equals("hh")) {
          return new Double(((endL - startL) / 3600000));
        }
 else {
          return new Double(((endL - startL) / 86400000));
        }
      }
    }
 catch (    Exception e) {
      throw Context.reportRuntimeError(e.toString());
    }
  }
 else {
    throw Context.reportRuntimeError("The function call dateDiff requires 3 arguments.");
  }
}
