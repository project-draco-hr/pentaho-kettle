{
  TreeItem ti[]=tCSH.getSelection();
  if (ti.length == 1) {
    String name=ti[0].getText();
    TreeItem parent=ti[0].getParentItem();
    if (parent != null) {
      String type=parent.getText();
      if (type.equalsIgnoreCase(STRING_CONNECTIONS)) {
        DatabaseMeta dbinfo=schema.findConnection(name);
        DatabaseExplorerDialog std=new DatabaseExplorerDialog(shell,schema.props,SWT.NONE,dbinfo,schema.databases,false);
        String tablename=(String)std.open();
        if (tablename != null) {
          ArrayList fields=new ArrayList();
          String shortname=tablename;
          int idx_last_dot=tablename.lastIndexOf(".");
          if (idx_last_dot >= 0) {
            shortname=tablename.substring(idx_last_dot + 1);
          }
          if (schema.findTable(shortname) != null) {
            int copy=2;
            String newname=shortname + " " + copy;
            while (schema.findTable(newname) != null) {
              copy++;
              newname=shortname + " " + copy;
            }
            shortname=newname;
          }
          TableMeta tableinfo=new TableMeta(shortname,tablename,dbinfo,fields,new ArrayList());
          Database db=new Database(dbinfo);
          try {
            db.connect();
            Row row=db.getTableFields(tablename);
            if (row != null && row.size() > 0) {
              for (int i=0; i < row.size(); i++) {
                Value v=row.getValue(i);
                String dbname=v.getName();
                TableField f=new TableField(v.getName(),dbname,TableField.TYPE_FIELD_DIMENSION,TableField.TYPE_AGGREGATION_NONE,tableinfo);
                fields.add(f);
              }
            }
          }
 catch (          KettleDatabaseException dbe) {
            MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
            mb.setMessage("Error reading fields of table : " + tablename + Const.CR+ dbe.getMessage());
            mb.setText("Error!");
            mb.open();
          }
 finally {
            db.disconnect();
          }
          if (shortname.startsWith("D_"))           tableinfo.setType(TableMeta.TYPE_TABLE_DIMENSION);
          if (shortname.startsWith("F_"))           tableinfo.setType(TableMeta.TYPE_TABLE_FACT);
          schema.addTable(tableinfo);
          refreshTree();
        }
      }
    }
 else {
      if (name.equalsIgnoreCase(STRING_CONNECTIONS))       schema.dbcache.clear(null);
    }
  }
}
