{
  pmenugraph.forceFocus();
  TransAction ta=schema.previousUndo();
  if (ta == null)   return;
  setUndoMenu();
switch (ta.getType()) {
case TransAction.TYPE_ACTION_NEW_TABLE:
{
      int idx=ta.getCurrentIndex()[0];
      schema.removeTable(idx);
      refreshTree();
      refreshGraph();
    }
  break;
case TransAction.TYPE_ACTION_NEW_CONNECTION:
{
  int idx=ta.getCurrentIndex()[0];
  schema.removeConnection(idx);
  refreshTree();
  refreshGraph();
}
break;
case TransAction.TYPE_ACTION_NEW_NOTE:
{
int idx=ta.getCurrentIndex()[0];
schema.removeNote(idx);
refreshTree();
refreshGraph();
}
break;
case TransAction.TYPE_ACTION_NEW_RELATIONSHIP:
{
int idx=ta.getCurrentIndex()[0];
schema.removeRelationship(idx);
refreshTree();
refreshGraph();
}
break;
case TransAction.TYPE_ACTION_DELETE_TABLE:
{
TableMeta ti=(TableMeta)ta.getCurrent()[0];
int idx=ta.getCurrentIndex()[0];
schema.addTable(idx,ti);
refreshTree();
refreshGraph();
}
break;
case TransAction.TYPE_ACTION_DELETE_CONNECTION:
{
DatabaseMeta ci=(DatabaseMeta)ta.getCurrent()[0];
int idx=ta.getCurrentIndex()[0];
schema.addConnection(idx,ci);
refreshTree();
refreshGraph();
}
break;
case TransAction.TYPE_ACTION_DELETE_NOTE:
{
NotePadMeta ni=(NotePadMeta)ta.getCurrent()[0];
int idx=ta.getCurrentIndex()[0];
schema.addNote(idx,ni);
refreshTree();
refreshGraph();
}
break;
case TransAction.TYPE_ACTION_DELETE_RELATIONSHIP:
{
RelationshipMeta ri=(RelationshipMeta)ta.getCurrent()[0];
int idx=ta.getCurrentIndex()[0];
schema.addRelationship(idx,ri);
refreshTree();
refreshGraph();
}
break;
case TransAction.TYPE_ACTION_CHANGE_TABLE:
{
TableMeta prev=(TableMeta)ta.getPrevious()[0];
int idx=ta.getCurrentIndex()[0];
schema.removeTable(idx);
schema.addTable(idx,prev);
refreshTree();
refreshGraph();
}
break;
case TransAction.TYPE_ACTION_CHANGE_CONNECTION:
{
DatabaseMeta prev=(DatabaseMeta)ta.getPrevious()[0];
int idx=ta.getCurrentIndex()[0];
schema.removeConnection(idx);
schema.addConnection(idx,prev);
refreshTree();
refreshGraph();
}
break;
case TransAction.TYPE_ACTION_CHANGE_NOTE:
{
int idx=ta.getCurrentIndex()[0];
schema.removeNote(idx);
NotePadMeta prev=(NotePadMeta)ta.getPrevious()[0];
schema.addNote(idx,prev);
refreshTree();
refreshGraph();
}
break;
case TransAction.TYPE_ACTION_CHANGE_RELATIONSHIP:
{
RelationshipMeta prev=(RelationshipMeta)ta.getPrevious()[0];
int idx=ta.getCurrentIndex()[0];
schema.removeRelationship(idx);
schema.addRelationship(idx,prev);
refreshTree();
refreshGraph();
}
break;
case TransAction.TYPE_ACTION_POSITION_TABLE:
{
int idx[]=ta.getCurrentIndex();
Point p[]=ta.getPreviousLocation();
for (int i=0; i < p.length; i++) {
TableMeta tableinfo=schema.getTable(idx[i]);
tableinfo.setLocation(p[i]);
}
refreshGraph();
}
break;
case TransAction.TYPE_ACTION_POSITION_NOTE:
int idx=ta.getCurrentIndex()[0];
NotePadMeta npi=schema.getNote(idx);
Point prev=ta.getPreviousLocation()[0];
npi.setLocation(prev);
refreshGraph();
break;
default :
break;
}
}
