{
  try {
    if (plugin.isNativePlugin()) {
      return (T)Class.forName(className);
    }
 else {
      Map<PluginInterface,URLClassLoader> map=classLoaderMap.get(plugin.getPluginType());
      if (map == null) {
        throw new KettlePluginException("Unable to find class loader map for plugin type: " + plugin.getPluginType());
      }
      ClassLoader classLoader=map.get(plugin);
      if (classLoader == null) {
        throw new KettlePluginException("Unable to find class loader for plugin: " + plugin);
      }
      return (T)classLoader.loadClass(className);
    }
  }
 catch (  Exception e) {
    throw new KettlePluginException("Unexpected error loading class with name: " + className,e);
  }
}
