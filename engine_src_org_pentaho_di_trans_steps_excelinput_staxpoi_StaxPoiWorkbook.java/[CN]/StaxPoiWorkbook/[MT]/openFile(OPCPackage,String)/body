{
  InputStream workbookData=null;
  XMLStreamReader workbookReader=null;
  try {
    reader=new XSSFReader(pkg);
    sheetNameIDMap=new LinkedHashMap<String,String>();
    workbookData=reader.getWorkbookData();
    XMLInputFactory factory=XMLInputFactory.newInstance();
    workbookReader=factory.createXMLStreamReader(workbookData);
    while (workbookReader.hasNext()) {
      if (workbookReader.next() == XMLStreamConstants.START_ELEMENT && workbookReader.getLocalName().equals("sheet")) {
        String sheetName=workbookReader.getAttributeValue(null,"name");
        String sheetID=workbookReader.getAttributeValue(RELATION_NS_URI,"id");
        sheetNameIDMap.put(sheetName,sheetID);
      }
    }
    sheetNames=new String[sheetNameIDMap.size()];
    int i=0;
    for (    String sheetName : sheetNameIDMap.keySet()) {
      sheetNames[i++]=sheetName;
    }
  }
 catch (  Exception e) {
    throw new KettleException(e);
  }
 finally {
    if (workbookReader != null) {
      try {
        workbookReader.close();
      }
 catch (      XMLStreamException e) {
        throw new KettleException(e);
      }
    }
    if (workbookData != null) {
      try {
        workbookData.close();
      }
 catch (      IOException e) {
        throw new KettleException(e);
      }
    }
  }
}
