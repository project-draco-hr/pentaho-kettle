{
  if (menuPopupNode == null) {
    return;
  }
  Node menuItemNode=menuPopupNode.getFirstChild();
  while (menuItemNode != null) {
    if ("menuitem".equals(menuItemNode.getNodeName())) {
      String id=XMLHandler.getTagAttribute(menuItemNode,"value");
      String name=XMLHandler.getTagAttribute(menuItemNode,"label");
      if (name == null) {
        name=getMenuLabel(menuItemNode);
      }
      name=localizeXulText(name,xulMessages);
      String accessKey=XMLHandler.getTagAttribute(menuItemNode,"accesskey");
      String accelText=XMLHandler.getTagAttribute(menuItemNode,"acceltext");
      String typeName=XMLHandler.getTagAttribute(menuItemNode,"type");
      int type=MenuChoice.TYPE_PLAIN;
      if ("checkbox".equals(typeName)) {
        type=MenuChoice.TYPE_CHECKBOX;
      }
      if (accelText != null && accelText.startsWith("%")) {
        StringTokenizer tokenizer=new StringTokenizer(accelText," ");
        StringBuffer buffer=new StringBuffer();
        while (tokenizer.hasMoreTokens()) {
          String token=tokenizer.nextToken();
          if (token.startsWith("%")) {
            buffer.append(xulMessages.getString(token.substring(1)));
          }
 else {
            buffer.append(token);
          }
        }
        accelText=buffer.toString();
      }
      new MenuChoice(menu,name,id,accelText,accessKey,type,xulMessages);
    }
 else     if ("menuseparator".equals(menuItemNode.getNodeName())) {
      String id=XMLHandler.getTagAttribute(menuItemNode,"value");
      new MenuItemSeparator(menu,id);
    }
 else     if ("menu".equals(menuItemNode.getNodeName())) {
      String id=XMLHandler.getTagAttribute(menuItemNode,"value");
      String name=XMLHandler.getTagAttribute(menuItemNode,"label");
      if (name == null) {
        name=getMenuLabel(menuItemNode);
      }
      name=localizeXulText(name,xulMessages);
      String accessKey=XMLHandler.getTagAttribute(menuItemNode,"accesskey");
      Menu subMenu=new Menu(menu,name,id,accessKey);
      createMenuFromXul(subMenu,XMLHandler.getSubNode(menuItemNode,"menupopup"),xulMessages);
    }
    menuItemNode=menuItemNode.getNextSibling();
  }
}
