{
  if (data.xbi != null) {
    logBasic(Messages.getString("XBaseInput.Log.FinishedReadingRecords"));
    data.xbi.close();
  }
  data.file_dbf=data.files.getFile(data.fileNr);
  data.fileNr++;
  try {
    data.xbi=new XBase(data.file_dbf.getContent().getInputStream());
    data.xbi.setDbfFile(data.file_dbf.getName().getURI());
    if (!Const.isEmpty(meta.getCharactersetName())) {
      data.xbi.getReader().setCharactersetName(meta.getCharactersetName());
    }
    data.xbi.open();
    logBasic(Messages.getString("XBaseInput.Log.OpenedXBaseFile") + " : [" + data.xbi+ "]");
    data.fields=data.xbi.getFields();
    ResultFile resultFile=new ResultFile(ResultFile.FILE_TYPE_GENERAL,data.file_dbf,getTransMeta().getName(),getStepname());
    resultFile.setComment(Messages.getString("XBaseInput.ResultFile.Comment"));
    addResultFile(resultFile);
  }
 catch (  Exception e) {
    logError(Messages.getString("XBaseInput.Log.Error.CouldNotOpenXBaseFile1") + data.file_dbf + Messages.getString("XBaseInput.Log.Error.CouldNotOpenXBaseFile2")+ e.getMessage());
    throw new KettleException(e);
  }
}
