{
  PluginRegistry registry=PluginRegistry.getInstance();
  assertNotNull("Registry singleton was not found!",registry);
  Class<? extends PluginTypeInterface> pluginType=StepPluginType.class;
  registry.registerPluginType(pluginType);
  List<Class<? extends PluginTypeInterface>> pluginTypes=registry.getPluginTypes();
  assertEquals("One plugin type expected in the registry",1,pluginTypes.size());
  Map<Class<?>,String> classMap=new HashMap<Class<?>,String>();
  classMap.put(TableInputMeta.class,"org.pentaho.di.trans.steps.tableinput.TableInputMeta");
  PluginInterface tableInputPlugin=new Plugin(new String[]{TABLE_INPUT_PLUGIN_ID},pluginType,StepMetaInterface.class,PLUGIN_INPUT_CATEGORY,TABLE_INPUT_PLUGIN_NAME,TABLE_INPUT_PLUGIN_DESCRIPTION,TABLE_INPUT_PLUGIN_IMAGE_FILE_NAME,false,true,classMap,new ArrayList<String>(),null,null);
  registry.registerPlugin(pluginType,tableInputPlugin);
  List<PluginInterface> stepPlugins=registry.getPlugins(pluginType);
  assertEquals("Size of plugins list expected to be 1",1,stepPlugins.size());
  PluginInterface verify=registry.getPlugin(pluginType,TABLE_INPUT_PLUGIN_ID);
  assertNotNull("A plugin was not found in the plugin registry",verify);
  assertEquals("A different plugin then expected was retrieved from the plugin registry",verify,tableInputPlugin);
  classMap=new HashMap<Class<?>,String>();
  classMap.put(TableOutputMeta.class,"org.pentaho.di.trans.steps.tableoutput.TableOutputMeta");
  PluginInterface tableOutputPlugin=new Plugin(new String[]{TABLE_OUTPUT_PLUGIN_ID},pluginType,StepMetaInterface.class,PLUGIN_OUTPUT_CATEGORY,TABLE_OUTPUT_PLUGIN_NAME,TABLE_OUTPUT_PLUGIN_DESCRIPTION,TABLE_OUTPUT_PLUGIN_IMAGE_FILE_NAME,false,true,classMap,new ArrayList<String>(),null,null);
  registry.registerPlugin(pluginType,tableOutputPlugin);
  stepPlugins=registry.getPlugins(pluginType);
  assertEquals("Size of plugins list expected to be 2",2,stepPlugins.size());
  verify=registry.getPlugin(pluginType,TABLE_OUTPUT_PLUGIN_ID);
  assertNotNull("A plugin was not found in the plugin registry",verify);
  assertEquals("A different plugin then expected was retrieved from the plugin registry",verify,tableOutputPlugin);
  List<PluginInterface> inputPlugins=registry.getPluginsByCategory(pluginType,PLUGIN_INPUT_CATEGORY);
  assertEquals("Exactly one plugin expected in the step plugin input category",1,inputPlugins.size());
  assertEquals("The table input step was expected in the input category",inputPlugins.get(0),tableInputPlugin);
  assertTrue("Input plugins list should contain the table input step",inputPlugins.contains(tableInputPlugin));
  assertFalse("Input plugins list should not contain the table output step",inputPlugins.contains(tableOutputPlugin));
  List<PluginInterface> outputPlugins=registry.getPluginsByCategory(pluginType,PLUGIN_OUTPUT_CATEGORY);
  assertEquals("Exactly one plugin expected in the step plugin output category",1,outputPlugins.size());
  assertEquals("The table output step was expected in the otuput category",outputPlugins.get(0),tableOutputPlugin);
  assertTrue("Output plugins list should contain the table output step",outputPlugins.contains(tableOutputPlugin));
  assertFalse("Output plugins list should not contain the table input step",outputPlugins.contains(tableInputPlugin));
  List<String> categories=registry.getCategories(pluginType);
  assertEquals("Two categories expected in the step plugin registry",2,categories.size());
  assertTrue("The input category was expected in the categories list",categories.contains(PLUGIN_INPUT_CATEGORY));
  assertTrue("The output category was expected in the categories list",categories.contains(PLUGIN_OUTPUT_CATEGORY));
  Object object=registry.loadClass(tableInputPlugin,TableInputMeta.class);
  assertNotNull(object);
  assertTrue(object instanceof TableInputMeta);
  Object object2=registry.loadClass(tableOutputPlugin,TableOutputMeta.class);
  assertNotNull(object2);
  assertTrue(object2 instanceof TableOutputMeta);
  try {
    registry.loadClass(tableInputPlugin,String.class);
    fail("A String class type can't be used when loading a step class");
  }
 catch (  Exception e) {
  }
}
