{
  Map<String,CommandLineOption> optionMap=new HashMap<String,CommandLineOption>();
  for (int i=0; i < options.length; i++) {
    optionMap.put(options[i].option,options[i]);
  }
  int idx=0;
  while (args.size() > 0 && idx < args.size()) {
    String arg=args.get(idx).trim();
    if (arg != null && arg.length() > 0 && (arg.charAt(0) == '-' || arg.charAt(0) == '/')) {
      String optionName=arg.substring(1);
      CommandLineOption option=optionMap.get(optionName);
      String value=null;
      if (option == null) {
        int pos=optionName.indexOf('=');
        if (pos != -1) {
          String tmp=optionName.substring(0,pos);
          option=optionMap.get(tmp);
          if (option != null) {
            value=optionName.substring(pos + 1);
          }
        }
        if (option == null) {
          pos=optionName.indexOf(':');
          if (pos != -1) {
            String tmp=optionName.substring(0,pos);
            option=optionMap.get(tmp);
            if (option != null) {
              value=optionName.substring(pos + 1);
            }
          }
        }
      }
      if (option != null) {
        args.remove(idx);
        if (!option.yesNo) {
          if (idx < args.size()) {
            if (value == null) {
              value=args.get(idx);
              args.remove(idx);
            }
            option.argument.append(value);
          }
 else           if (value != null) {
            option.argument.append(value);
          }
 else {
            if (log != null) {
              log.logError("Command Line Options","Option " + optionName + " expects an argument",new Object[]{optionName});
            }
            return false;
          }
        }
 else {
          if (value != null) {
            option.argument.append(value);
          }
 else {
            option.argument.append("Y");
          }
        }
      }
 else {
        idx++;
      }
    }
 else     if ("".equals(arg)) {
      args.remove(0);
    }
 else {
      idx++;
    }
  }
  return true;
}
