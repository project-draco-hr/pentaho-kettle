{
  if (metaA.isDate() && metaB.isDate()) {
    if (dataA != null && dataB != null) {
      Date startDate=metaB.getDate(dataB);
      Date endDate=metaA.getDate(dataA);
      Calendar stDateCal=new GregorianCalendar(startDate.getYear() + 1900,startDate.getMonth(),startDate.getDate(),0,0,0);
      Calendar endDateCal=new GregorianCalendar(endDate.getYear() + 1900,endDate.getMonth(),endDate.getDate(),0,0,0);
      int startJulian=(stDateCal.get(Calendar.YEAR) * 1000) + stDateCal.get(Calendar.DAY_OF_YEAR);
      int endJulian=(endDateCal.get(Calendar.YEAR) * 1000) + endDateCal.get(Calendar.DAY_OF_YEAR);
      return new Long(endJulian - startJulian);
    }
 else {
      return null;
    }
  }
  throw new KettleValueException("The 'DateDiff' function only works with dates");
}
