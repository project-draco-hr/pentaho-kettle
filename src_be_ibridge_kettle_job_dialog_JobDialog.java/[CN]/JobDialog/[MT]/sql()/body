{
  DatabaseMeta ci=jobMeta.findDatabase(wLogconnection.getText());
  if (ci != null) {
    Row r=Database.getJobLogrecordFields(wBatch.getSelection(),wLogfield.getSelection());
    if (r != null && r.size() > 0) {
      String tablename=wLogtable.getText();
      if (tablename != null && tablename.length() > 0) {
        Database db=new Database(ci);
        try {
          db.connect();
          String createTable=db.getDDL(tablename,r);
          log.logBasic(toString(),createTable);
          SQLEditor sqledit=new SQLEditor(shell,SWT.NONE,ci,null,createTable);
          sqledit.open();
        }
 catch (        KettleDatabaseException dbe) {
          MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
          mb.setMessage("An error occured creating the SQL:" + Const.CR + dbe.getMessage());
          mb.setText("ERROR");
          mb.open();
        }
 finally {
          db.disconnect();
        }
      }
 else {
        MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
        mb.setMessage("Please enter a logtable-name!");
        mb.setText("ERROR");
        mb.open();
      }
    }
 else {
      MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
      mb.setMessage("I couldn't find any fields to create the logtable!");
      mb.setText("ERROR");
      mb.open();
    }
  }
 else {
    MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
    mb.setMessage("Please select/create a valid logtable connection!");
    mb.setText("ERROR");
    mb.open();
  }
}
