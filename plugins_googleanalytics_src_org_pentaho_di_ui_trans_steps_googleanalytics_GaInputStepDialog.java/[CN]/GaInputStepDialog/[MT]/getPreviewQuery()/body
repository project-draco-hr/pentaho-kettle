{
  try {
    String ids=wCustomProfileEnabled.getSelection() ? transMeta.environmentSubstitute(wGaCustomProfile.getText()) : profileTableIds.get(wGaProfile.getText());
    Analytics.Data.Ga.Get query=getAnalytics().data().ga().get(ids,transMeta.environmentSubstitute(wQuStartDate.getText()),transMeta.environmentSubstitute(wQuEndDate.getText()),transMeta.environmentSubstitute(wQuMetrics.getText()));
    query.setDimensions(transMeta.environmentSubstitute(wQuDimensions.getText()));
    if (wUseSegmentEnabled.getSelection()) {
      if (wCustomSegmentEnabled.getSelection()) {
        query.setSegment(transMeta.environmentSubstitute(wQuCustomSegment.getText()));
      }
 else {
        query.setSegment(segmentIds.get(wQuSegment.getText()));
      }
    }
    if (!Const.isEmpty(wQuFilters.getText())) {
      query.setFilters(transMeta.environmentSubstitute(wQuFilters.getText()));
    }
    if (!Const.isEmpty(wQuSort.getText())) {
      query.setSort(transMeta.environmentSubstitute(wQuSort.getText()));
    }
    return query;
  }
 catch (  Exception e) {
    logError(BaseMessages.getString(PKG,"GoogleAnalyticsDialog.AuthenticationFailure.DialogMessage"),e);
    MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
    mb.setText(BaseMessages.getString(PKG,"GoogleAnalyticsDialog.AuthenticationFailure.DialogTitle"));
    mb.setMessage(BaseMessages.getString(PKG,"GoogleAnalyticsDialog.AuthenticationFailure.DialogMessage"));
    mb.open();
  }
  return null;
}
