{
  final List<String> commands=new ArrayList<String>();
  final String executableFilePath=environmentSubstitute(configuration.getExecutableFilename());
  final File executableFile=new File(executableFilePath);
  final String outputFilename=environmentSubstitute(configuration.getOutputFilename());
  commands.add(executableFilePath);
  commands.add("-job");
  commands.add(environmentSubstitute(configuration.getJobFilename()));
  commands.add("-ot");
  commands.add(configuration.getOutputType().toString());
  commands.add("-of");
  commands.add(outputFilename);
  final String additionalArguments=configuration.getAdditionalArguments();
  if (additionalArguments != null && additionalArguments.length() != 0) {
    final String[] args=additionalArguments.split(" ");
    for (    String arg : args) {
      commands.add(arg);
    }
  }
  final ProcessBuilder processBuilder=new ProcessBuilder(commands);
  final File dataCleanerDirectory=executableFile.getParentFile();
  processBuilder.directory(dataCleanerDirectory);
  processBuilder.redirectErrorStream(true);
  try {
    final Process process=processBuilder.start();
    if (log.isBasic()) {
      InputStream inputStream=process.getInputStream();
      try {
        BufferedReader reader=new BufferedReader(new InputStreamReader(inputStream));
        for (String line=reader.readLine(); line != null; line=reader.readLine()) {
          logBasic("DataCleaner: " + line);
        }
      }
  finally {
        inputStream.close();
      }
    }
    int exitCode=process.waitFor();
    result.setExitStatus(exitCode);
    result.setResult(true);
    if (configuration.isOutputFileInResult()) {
      File outputFile=new File(outputFilename);
      if (!outputFile.exists()) {
        outputFile=new File(dataCleanerDirectory,outputFilename);
      }
      if (outputFile.exists()) {
        final Map<String,ResultFile> files=new ConcurrentHashMap<String,ResultFile>();
        final FileObject fileObject=KettleVFS.getFileObject(outputFile.getCanonicalPath(),this);
        final ResultFile resultFile=new ResultFile(ResultFile.FILE_TYPE_GENERAL,fileObject,parentJob.getJobname(),toString());
        files.put(outputFilename,resultFile);
        result.setResultFiles(files);
      }
    }
  }
 catch (  Exception e) {
    logError("Error occurred while executing DataCleaner job",e);
    result.setResult(false);
    throw new KettleException(e);
  }
  return result;
}
