{
  DatabaseMeta ci=transMeta.findDatabase(wLogconnection.getText());
  if (ci != null) {
    Row r=Database.getTransLogrecordFields(wBatch.getSelection(),wLogfield.getSelection());
    if (r != null && r.size() > 0) {
      String tablename=wLogtable.getText();
      if (tablename != null && tablename.length() > 0) {
        Database db=new Database(ci);
        try {
          db.connect();
          String createTable=db.getDDL(tablename,r);
          if (createTable != null && createTable.length() > 0) {
            log.logBasic(toString(),createTable);
            SQLEditor sqledit=new SQLEditor(shell,SWT.NONE,ci,transMeta.getDbCache(),createTable);
            sqledit.open();
          }
 else {
            MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_INFORMATION);
            mb.setText("OK!");
            mb.setMessage("No sql needs to be executed.  The log table looks great!");
            mb.open();
          }
        }
 catch (        KettleException e) {
          MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
          mb.setText("ERROR!");
          mb.setMessage("An error occurred: " + Const.CR + e.getMessage());
          mb.open();
        }
 finally {
          db.disconnect();
        }
      }
 else {
        MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
        mb.setText("ERROR");
        mb.setMessage("Please enter a logtable-name!");
        mb.open();
      }
    }
 else {
      MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
      mb.setText("ERROR");
      mb.setMessage("I couldn't find any fields to create the logtable!");
      mb.open();
    }
  }
 else {
    MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
    mb.setText("ERROR");
    mb.setMessage("Please select a valid logtable connection!");
    mb.open();
  }
}
