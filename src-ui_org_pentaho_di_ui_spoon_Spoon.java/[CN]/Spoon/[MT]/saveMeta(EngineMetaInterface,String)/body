{
  meta.setFilename(fname);
  if (Const.isEmpty(meta.getName()) || delegates.jobs.isDefaultJobName(meta.getName())) {
    meta.nameFromFilename();
  }
  boolean saved=false;
  String xml=XMLHandler.getXMLHeader() + meta.getXML();
  try {
    DataOutputStream dos=new DataOutputStream(KettleVFS.getOutputStream(fname,false));
    dos.write(xml.getBytes(Const.XML_ENCODING));
    dos.close();
    saved=true;
    props.addLastFile(meta.getFileType(),fname,null,false,null);
    saveSettings();
    addMenuLast();
    if (log.isDebug())     log.logDebug(toString(),Messages.getString("Spoon.Log.FileWritten") + " [" + fname+ "]");
    meta.setFilename(fname);
    meta.clearChanged();
    setShellText();
  }
 catch (  Exception e) {
    if (log.isDebug())     log.logDebug(toString(),Messages.getString("Spoon.Log.ErrorOpeningFileForWriting") + e.toString());
    new ErrorDialog(shell,Messages.getString("Spoon.Dialog.ErrorSavingFile.Title"),Messages.getString("Spoon.Dialog.ErrorSavingFile.Message") + Const.CR + e.toString(),e);
  }
  return saved;
}
