{
  try {
    boolean loaded=false;
    FileListener listener=null;
    int idx=fname.lastIndexOf('.');
    if (idx != -1) {
      String extension=fname.substring(idx + 1);
      listener=fileExtensionMap.get(extension);
    }
    Document document=XMLHandler.loadXMLFile(fname);
    Node root=document.getDocumentElement();
    if (listener == null) {
      listener=fileNodeMap.get(root.getNodeName());
    }
    if (!Const.isEmpty(fname)) {
      if (listener != null) {
        loaded=listener.open(root,fname,importfile);
      }
      if (!loaded) {
        MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
        mb.setMessage(BaseMessages.getString(PKG,"Spoon.UnknownFileType.Message",fname));
        mb.setText(BaseMessages.getString(PKG,"Spoon.UnknownFileType.Title"));
        mb.open();
      }
 else {
        applyVariables();
      }
    }
  }
 catch (  KettleException e) {
    new ErrorDialog(shell,BaseMessages.getString(PKG,"Spoon.Dialog.ErrorOpening.Title"),BaseMessages.getString(PKG,"Spoon.Dialog.ErrorOpening.Message") + fname,e);
  }
}
