{
  boolean disableTransMenu=getActiveTransformation() == null;
  boolean disableJobMenu=getActiveJob() == null;
  boolean disableMetaMenu=getActiveMeta() == null;
  boolean isRepositoryRunning=rep != null;
  boolean disablePreviewButton=true;
  TransGraph transGraph=getActiveTransGraph();
  if (transGraph != null) {
    disablePreviewButton=!(transGraph.isRunning() && !transGraph.isHalting());
  }
  boolean disableSave=true;
  TabItemInterface currentTab=getActiveTabitem();
  if (currentTab != null && currentTab.canHandleSave()) {
    disableSave=!currentTab.hasContentChanged();
  }
  org.pentaho.ui.xul.dom.Document doc=mainSpoonContainer.getDocumentRoot();
  ((XulMenuitem)doc.getElementById("file-new-database")).setDisabled((disableTransMenu && disableJobMenu) || !isRepositoryRunning);
  ((XulMenuitem)doc.getElementById("file-save")).setDisabled((disableTransMenu && disableJobMenu && disableMetaMenu) || disableSave);
  ((XulMenuitem)doc.getElementById("file-save-as")).setDisabled(disableTransMenu && disableJobMenu && disableMetaMenu);
  ((XulMenuitem)doc.getElementById("file-save-as-vfs")).setDisabled(disableTransMenu && disableJobMenu && disableMetaMenu);
  ((XulMenuitem)doc.getElementById("file-close")).setDisabled(disableTransMenu && disableJobMenu && disableMetaMenu);
  ((XulMenuitem)doc.getElementById("file-print")).setDisabled(disableTransMenu && disableJobMenu);
  ((XulMenuitem)doc.getElementById("file-export-to-xml")).setDisabled(disableTransMenu && disableJobMenu);
  ((XulMenuitem)doc.getElementById("file-export-to-xml")).setDisabled(disableTransMenu && disableJobMenu);
  ((XulMenuitem)doc.getElementById("file-export-all-to-xml")).setDisabled(disableTransMenu && disableJobMenu);
  if (disableTransMenu && disableJobMenu) {
    ((XulMenuitem)doc.getElementById(UNDO_MENUITEM)).setDisabled(true);
    ((XulMenuitem)doc.getElementById(REDO_MENUITEM)).setDisabled(true);
  }
  ((XulMenuitem)doc.getElementById("edit-clear-selection")).setDisabled(disableTransMenu);
  ((XulMenuitem)doc.getElementById("edit-select-all")).setDisabled(disableTransMenu);
  ((XulMenuitem)doc.getElementById("view-results")).setSelected(isExecutionResultsPaneVisible());
  ((XulMenuitem)doc.getElementById("view-results")).setDisabled(transGraph == null);
  ((XulMenuitem)doc.getElementById("view-zoom-in")).setDisabled(disableTransMenu && disableJobMenu);
  ((XulMenuitem)doc.getElementById("view-zoom-out")).setDisabled(disableTransMenu && disableJobMenu);
  ((XulMenuitem)doc.getElementById("view-zoom-100pct")).setDisabled(disableTransMenu && disableJobMenu);
  ((XulMenuitem)doc.getElementById("process-run")).setDisabled(disableTransMenu && disablePreviewButton && disableJobMenu);
  ((XulMenuitem)doc.getElementById("trans-replay")).setDisabled(disableTransMenu && disablePreviewButton);
  ((XulMenuitem)doc.getElementById("trans-preview")).setDisabled(disableTransMenu && disablePreviewButton);
  ((XulMenuitem)doc.getElementById("trans-debug")).setDisabled(disableTransMenu && disablePreviewButton);
  ((XulMenuitem)doc.getElementById("trans-verify")).setDisabled(disableTransMenu);
  ((XulMenuitem)doc.getElementById("trans-impact")).setDisabled(disableTransMenu);
  ((XulMenuitem)doc.getElementById("trans-get-sql")).setDisabled(disableTransMenu);
  ((XulMenuitem)doc.getElementById("trans-last-impact")).setDisabled(disableTransMenu);
  ((XulMenuitem)doc.getElementById("repository-connect")).setSelected(isRepositoryRunning);
  ((XulMenuitem)doc.getElementById("repository-disconnect")).setDisabled(!isRepositoryRunning);
  ((XulMenuitem)doc.getElementById("repository-explore")).setDisabled(!isRepositoryRunning);
  ((XulMenuitem)doc.getElementById("trans-last-preview")).setDisabled(!isRepositoryRunning || disableTransMenu);
  ((XulMenuitem)doc.getElementById("wizard-connection")).setDisabled(disableTransMenu && disableJobMenu);
  ((XulMenuitem)doc.getElementById("wizard-copy-table")).setDisabled(disableTransMenu && disableJobMenu);
  ((XulMenuitem)doc.getElementById("wizard-copy-tables")).setDisabled(isRepositoryRunning && disableTransMenu && disableJobMenu);
  SpoonPluginManager.getInstance().notifyLifecycleListeners(SpoonLifeCycleEvent.MENUS_REFRESHED);
  refreshCoreObjects();
}
