{
  boolean enableTransMenu=getActiveTransformation() != null;
  boolean enableJobMenu=getActiveJob() != null;
  boolean enableMetaMenu=getActiveMeta() != null;
  boolean enableRepositoryMenu=rep != null;
  boolean disablePreviewButton=false;
  TabItemInterface currentTab=getActiveTabitem();
  boolean saveEnabled=true;
  if (currentTab != null && currentTab.canHandleSave()) {
    saveEnabled=currentTab.hasContentChanged();
  }
  TransGraph transGraph=getActiveTransGraph();
  if (transGraph != null) {
    disablePreviewButton=transGraph.isRunning() && !transGraph.isHalting();
  }
  org.pentaho.ui.xul.dom.Document doc=mainSpoonContainer.getDocumentRoot();
  ((XulMenuitem)doc.getElementById("file-save")).setDisabled(!(enableTransMenu || enableJobMenu || enableMetaMenu) && saveEnabled);
  ((XulMenuitem)doc.getElementById("file-save-as")).setDisabled(!(enableTransMenu || enableJobMenu || enableMetaMenu));
  ((XulMenuitem)doc.getElementById("file-close")).setDisabled(!(enableTransMenu || enableJobMenu || enableMetaMenu));
  ((XulMenuitem)doc.getElementById("file-print")).setDisabled(!(enableTransMenu || enableJobMenu));
  if (!enableTransMenu && !enableJobMenu) {
    ((XulMenuitem)doc.getElementById(UNDO_MENUITEM)).setDisabled(true);
    ((XulMenuitem)doc.getElementById(REDO_MENUITEM)).setDisabled(true);
  }
  ((XulMenuitem)doc.getElementById("edit-clear-selection")).setDisabled(!enableTransMenu);
  ((XulMenuitem)doc.getElementById("edit-select-all")).setDisabled(!enableTransMenu);
  ((XulMenuitem)doc.getElementById("process-run")).setDisabled(!(enableTransMenu && !disablePreviewButton) && !enableJobMenu);
  ((XulMenuitem)doc.getElementById("trans-replay")).setDisabled(!(enableTransMenu && !disablePreviewButton));
  ((XulMenuitem)doc.getElementById("trans-preview")).setDisabled(!(enableTransMenu && !disablePreviewButton));
  ((XulMenuitem)doc.getElementById("trans-debug")).setDisabled(!(enableTransMenu && !disablePreviewButton));
  ((XulMenuitem)doc.getElementById("trans-verify")).setDisabled(!enableTransMenu);
  ((XulMenuitem)doc.getElementById("trans-impact")).setDisabled(!enableTransMenu);
  ((XulMenuitem)doc.getElementById("trans-get-sql")).setDisabled(!enableTransMenu);
  ((XulMenuitem)doc.getElementById("trans-last-impact")).setDisabled(!enableTransMenu);
  ((XulMenuitem)doc.getElementById("trans-last-preview")).setDisabled(!enableTransMenu);
  ((XulMenuitem)doc.getElementById("trans-copy")).setDisabled(!enableTransMenu);
  ((XulMenuitem)doc.getElementById("trans-copy-image")).setDisabled(!enableTransMenu);
  ((XulMenuitem)doc.getElementById("job-copy")).setDisabled(!enableJobMenu);
  ((XulMenuitem)doc.getElementById("repository-connect")).setSelected(!enableRepositoryMenu);
  ((XulMenuitem)doc.getElementById("wizard-connection")).setDisabled(!(enableTransMenu || enableJobMenu));
  ((XulMenuitem)doc.getElementById("wizard-copy-table")).setDisabled(!(enableTransMenu || enableJobMenu));
  ((XulMenuitem)doc.getElementById("wizard-copy-tables")).setDisabled(!(enableRepositoryMenu || enableTransMenu || enableJobMenu));
  ((XulMenuitem)doc.getElementById("repository-explore")).setDisabled(!enableRepositoryMenu);
  if (doc.getElementById("repository-explore-experimental") != null) {
    ((XulMenuitem)doc.getElementById("repository-explore-experimental")).setDisabled(!enableRepositoryMenu);
  }
  ((XulMenuitem)doc.getElementById("trans-last-preview")).setDisabled(!enableRepositoryMenu);
  SpoonPluginManager.getInstance().notifyLifecycleListeners(SpoonLifeCycleEvent.MENUS_REFRESHED);
  refreshCoreObjects();
}
