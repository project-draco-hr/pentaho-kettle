{
  log.logDetailed(toString(),Messages.getString("Spoon.Log.SaveToRepository"));
  if (rep != null) {
    boolean answer=true;
    boolean ask=ask_name;
    while (answer && (ask || Const.isEmpty(meta.getName()))) {
      if (!ask) {
        MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_WARNING);
        mb.setMessage(Messages.getString("Spoon.Dialog.PromptTransformationName.Message"));
        mb.setText(Messages.getString("Spoon.Dialog.PromptTransformationName.Title"));
        mb.open();
      }
      ask=false;
      if (meta instanceof TransMeta) {
        answer=TransGraph.editProperties((TransMeta)meta,this,rep);
      }
      if (meta instanceof JobMeta) {
        answer=JobGraph.editProperties((JobMeta)meta,this,rep);
      }
    }
    if (answer && !Const.isEmpty(meta.getName())) {
      if (!rep.getUserInfo().isReadonly()) {
        int response=SWT.YES;
        if (meta.showReplaceWarning(rep)) {
          MessageBox mb=new MessageBox(shell,SWT.YES | SWT.NO | SWT.ICON_QUESTION);
          mb.setMessage(Messages.getString("Spoon.Dialog.PromptOverwriteTransformation.Message",meta.getName(),Const.CR));
          mb.setText(Messages.getString("Spoon.Dialog.PromptOverwriteTransformation.Title"));
          response=mb.open();
        }
        boolean saved=false;
        if (response == SWT.YES) {
          shell.setCursor(cursor_hourglass);
          if (meta.getCreatedUser() == null || meta.getCreatedUser().equals("-")) {
            meta.setCreatedDate(new Date());
            meta.setCreatedUser(rep.getUserInfo().getLogin());
          }
 else {
            meta.setCreatedDate(meta.getCreatedDate());
            meta.setCreatedUser(meta.getCreatedUser());
          }
          meta.setModifiedDate(new Date());
          meta.setModifiedUser(rep.getUserInfo().getLogin());
          SaveProgressDialog tspd=new SaveProgressDialog(shell,rep,meta);
          if (tspd.open()) {
            saved=true;
            if (!props.getSaveConfirmation()) {
              MessageDialogWithToggle md=new MessageDialogWithToggle(shell,Messages.getString("Spoon.Message.Warning.SaveOK"),null,Messages.getString("Spoon.Message.Warning.TransformationWasStored"),MessageDialog.QUESTION,new String[]{Messages.getString("Spoon.Message.Warning.OK")},0,Messages.getString("Spoon.Message.Warning.NotShowThisMessage"),props.getSaveConfirmation());
              md.open();
              props.setSaveConfirmation(md.getToggleState());
            }
            props.addLastFile(meta.getFileType(),meta.getName(),meta.getDirectory().getPath(),true,getRepositoryName());
            saveSettings();
            addMenuLast();
            setShellText();
          }
          shell.setCursor(null);
        }
        return saved;
      }
 else {
        MessageBox mb=new MessageBox(shell,SWT.CLOSE | SWT.ICON_ERROR);
        mb.setMessage(Messages.getString("Spoon.Dialog.OnlyreadRepository.Message"));
        mb.setText(Messages.getString("Spoon.Dialog.OnlyreadRepository.Title"));
        mb.open();
      }
    }
  }
 else {
    MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
    mb.setMessage(Messages.getString("Spoon.Dialog.NoRepositoryConnection.Message"));
    mb.setText(Messages.getString("Spoon.Dialog.NoRepositoryConnection.Title"));
    mb.open();
  }
  return false;
}
