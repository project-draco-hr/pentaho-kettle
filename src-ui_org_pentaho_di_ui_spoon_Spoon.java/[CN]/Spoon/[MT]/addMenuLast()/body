{
  org.pentaho.ui.xul.dom.Document doc=(org.pentaho.ui.xul.dom.Document)mainSpoonContainer.getDocumentRoot();
  XulMenuseparator sep=(XulMenuseparator)doc.getElementById("file-last-separator");
  XulMenupopup msFile=(XulMenupopup)sep.getParent();
  if (msFile == null || sep == null) {
    return;
  }
  int idx=msFile.getChildNodes().indexOf(sep);
  int max=msFile.getChildNodes().size();
  for (int i=max - 1; i > idx; i--) {
    XulComponent mi=msFile.getChildNodes().get(i);
    mi.getParent().removeChild(mi);
  }
  List<LastUsedFile> lastUsedFiles=props.getLastUsedFiles();
  for (int i=0; i < lastUsedFiles.size(); i++) {
    final LastUsedFile lastUsedFile=lastUsedFiles.get(i);
    char chr=(char)('1' + i);
    String accessKey="ctrl-" + chr;
    String accessText="CTRL-" + chr;
    String text=lastUsedFile.toString();
    String id="last-file-" + i;
    if (i > 9) {
      accessKey=null;
      accessText=null;
    }
    XulMenuitem miFileLast=((SwtMenupopup)msFile).createNewMenuitem();
    int targetLength=40;
    if (text.length() > targetLength) {
      int lastSep=text.replace('\\','/').lastIndexOf('/');
      if (lastSep != -1) {
        String fileName="..." + text.substring(lastSep);
        if (fileName.length() < targetLength) {
          int leadSize=targetLength - fileName.length();
          text=text.substring(0,leadSize) + fileName;
        }
 else {
          text=fileName;
        }
      }
    }
    miFileLast.setLabel(text);
    miFileLast.setId(id);
    miFileLast.setAcceltext(accessText);
    miFileLast.setAccesskey(accessKey);
    if (lastUsedFile.isTransformation()) {
      MenuItem item=(MenuItem)miFileLast.getManagedObject();
      item.setImage(GUIResource.getInstance().getImageTransGraph());
    }
 else     if (lastUsedFile.isJob()) {
      MenuItem item=(MenuItem)miFileLast.getManagedObject();
      item.setImage(GUIResource.getInstance().getImageJobGraph());
    }
    miFileLast.setCommand("spoon.lastFileSelect('" + i + "')");
  }
}
