{
  Locale.setDefault(Const.DEFAULT_LOCALE);
  LogWriter log=LogWriter.getInstance(Const.MENU_LOG_FILE,false,LogWriter.LOG_LEVEL_BASIC);
  StepLoader stloader=StepLoader.getInstance();
  if (!stloader.read()) {
    log.logError("Menu","Error loading steps... halting Menu!");
    return;
  }
  final PMenu win=new PMenu(log,stloader);
  Licenses licenses=Licenses.getInstance();
  win.licence_nr=licenses.checkLicense(Licenses.PRODUCT_MENU);
  if (win.licence_nr < 0) {
    win.demo_mode=true;
  }
 else {
    win.demo_mode=false;
  }
  int retval=SWT.YES;
  if (win.demo_mode) {
    ShowLicenseDialog ld=new ShowLicenseDialog(log,win.schema.props,win.disp,"Menu");
    ld.shell.setImage(win.menu_image);
    retval=ld.open();
    if (retval == SWT.YES) {
      win.demo_mode=false;
      win.licence_nr=licenses.getNrLicenses();
    }
  }
  if (retval == SWT.CANCEL) {
    win.dispose();
    return;
  }
  if (args.length == 1) {
    if (win.schema.loadXML(args[0],false)) {
      win.setFilename(args[0]);
      win.schema.clearChanged();
    }
  }
 else {
    if (win.schema.props.openLastFile()) {
      String lastfiles[]=win.schema.props.getLastFiles();
      if (lastfiles.length > 0) {
        if (win.schema.loadXML(lastfiles[0],false)) {
          win.setFilename(lastfiles[0]);
          win.schema.clearChanged();
        }
      }
    }
  }
  win.open();
  while (!win.isDisposed()) {
    if (!win.readAndDispatch())     win.sleep();
  }
  win.dispose();
  log.close();
}
