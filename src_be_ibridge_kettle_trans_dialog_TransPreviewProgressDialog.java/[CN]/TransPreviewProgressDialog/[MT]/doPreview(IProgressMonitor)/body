{
  LogWriter log=LogWriter.getInstance();
  int nrRows=0;
  for (int i=0; i < previewSize.length; i++)   nrRows+=previewSize[i];
  progressMonitor.beginTask("Starting transformation in preview...",100);
  trans=new Trans(log,transMeta,previewStepNames,previewSize);
  trans.execute(null);
  int previousPct=0;
  while (!trans.previewComplete() && !trans.isFinished() && !progressMonitor.isCanceled()) {
    int nrDone=0;
    for (int i=0; i < previewSize.length; i++) {
      List buffer=trans.getPreviewRows(previewStepNames[i],0);
      nrDone+=buffer.size();
    }
    int pct=100 * nrDone / nrRows;
    int worked=pct - previousPct;
    if (worked > 0)     progressMonitor.worked(worked);
    previousPct=pct;
    try {
      Thread.sleep(100);
    }
 catch (    InterruptedException e) {
    }
    if (progressMonitor.isCanceled()) {
      cancelled=true;
      trans.stopAll();
    }
  }
  trans.stopAll();
  progressMonitor.done();
}
