{
  Object[] rowData;
  if (data.readsRows) {
    rowData=getRow();
    if (rowData == null) {
      setOutputDone();
      return false;
    }
  }
 else {
    rowData=RowDataUtil.allocateRowData(0);
    linesRead++;
  }
  if (first && rowData != null) {
    first=false;
    if (data.readsRows) {
      data.inputRowMeta=getInputRowMeta();
    }
 else {
      data.inputRowMeta=new RowMeta();
    }
    data.outputRowMeta=data.inputRowMeta.clone();
    meta.getFields(data.outputRowMeta,getStepname(),null,null,this);
  }
  Object extraData[]=new Object[meta.getFieldName().length];
  for (int i=0; i < meta.getFieldName().length; i++) {
    String newValue=environmentSubstitute(meta.getVariableString()[i]);
    if (log.isDetailed())     logDetailed("field [" + meta.getFieldName()[i] + "] has value ["+ newValue+ "]");
    extraData[i]=newValue;
  }
  rowData=RowDataUtil.addRowData(rowData,data.inputRowMeta.size(),extraData);
  putRow(data.outputRowMeta,rowData);
  if (!data.readsRows) {
    setOutputDone();
    return false;
  }
  return true;
}
