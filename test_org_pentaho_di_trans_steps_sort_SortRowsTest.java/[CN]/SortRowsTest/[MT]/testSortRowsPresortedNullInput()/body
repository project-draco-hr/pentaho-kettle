{
  KettleEnvironment.init();
  TransMeta transMeta=new TransMeta();
  transMeta.setName("sortrowstest");
  PluginRegistry registry=PluginRegistry.getInstance();
  String injectorStepname="injector step";
  InjectorMeta im=new InjectorMeta();
  String injectorPid=registry.getPluginId(StepPluginType.class,im);
  StepMeta injectorStep=new StepMeta(injectorPid,injectorStepname,im);
  transMeta.addStep(injectorStep);
  String sortRowsStepname="sort rows step";
  SortRowsMeta srm=new SortRowsMeta();
  srm.setSortSize(Integer.toString(MAX_COUNT / 100));
  String[] sortFields={"KEY1","KEY2"};
  boolean[] ascendingFields={true,true};
  boolean[] caseSensitive={true,true};
  boolean[] presortedFields={true,false};
  srm.setFieldName(sortFields);
  srm.setAscending(ascendingFields);
  srm.setCaseSensitive(caseSensitive);
  srm.setPreSortedField(presortedFields);
  srm.setPrefix("SortRowsTest");
  srm.setDirectory(".");
  String sortRowsStepPid=registry.getPluginId(StepPluginType.class,srm);
  StepMeta sortRowsStep=new StepMeta(sortRowsStepPid,sortRowsStepname,srm);
  transMeta.addStep(sortRowsStep);
  TransHopMeta hi=new TransHopMeta(injectorStep,sortRowsStep);
  transMeta.addTransHop(hi);
  Trans trans=new Trans(transMeta);
  trans.prepareExecution(null);
  RowProducer rp=trans.addRowProducer(injectorStepname,0);
  trans.startThreads();
  rp.finished();
  trans.waitUntilFinished();
}
