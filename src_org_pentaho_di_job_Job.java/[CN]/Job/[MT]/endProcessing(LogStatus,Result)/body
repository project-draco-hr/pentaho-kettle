{
  try {
    if (errors == 0 && !res.getResult())     errors=1;
    logDate=new Date();
    DatabaseMeta logcon=jobMeta.getJobLogTable().getDatabaseMeta();
    String tableName=jobMeta.getJobLogTable().getTableName();
    if (logcon != null) {
      Database ldb=new Database(this,logcon);
      ldb.shareVariablesWith(this);
      try {
        ldb.connect();
        ldb.writeLogRecord(jobMeta.getJobLogTable(),status,this);
      }
 catch (      KettleDatabaseException dbe) {
        addErrors(1);
        throw new KettleJobException("Unable to end processing by writing log record to table " + tableName,dbe);
      }
 finally {
        ldb.disconnect();
      }
    }
    return true;
  }
 catch (  Exception e) {
    throw new KettleJobException(e);
  }
}
