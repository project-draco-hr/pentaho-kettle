{
  meta=(ExecSQLMeta)smi;
  data=(ExecSQLData)sdi;
  if (!meta.isExecutedEachInputRow()) {
    RowMetaAndData resultRow=getResultRow(data.result,meta.getUpdateField(),meta.getInsertField(),meta.getDeleteField(),meta.getReadField());
    putRow(resultRow.getRowMeta(),resultRow.getData());
    setOutputDone();
    return false;
  }
  Object[] row=getRow();
  if (row == null) {
    setOutputDone();
    return false;
  }
  if (first) {
    first=false;
    data.outputRowMeta=getInputRowMeta().clone();
    meta.getFields(data.outputRowMeta,getStepname(),null,null,this);
    data.argumentIndexes=new int[meta.getArguments().length];
    for (int i=0; i < meta.getArguments().length; i++) {
      data.argumentIndexes[i]=this.getInputRowMeta().indexOfValue(meta.getArguments()[i]);
      if (data.argumentIndexes[i] < 0) {
        logError(Messages.getString("ExecSQL.Log.ErrorFindingField") + meta.getArguments()[i] + "]");
        throw new KettleStepException(Messages.getString("ExecSQL.Exception.CouldNotFindField",meta.getArguments()[i]));
      }
    }
    data.markerPositions=new ArrayList<Integer>();
    int len=data.sql.length();
    int pos=len - 1;
    while (pos >= 0) {
      if (data.sql.charAt(pos) == '?')       data.markerPositions.add(new Integer(pos));
      pos--;
    }
  }
  String sql;
  int numMarkers=data.markerPositions.size();
  if (numMarkers > 0) {
    StringBuffer buf=new StringBuffer(data.sql);
    for (int i=0; i < numMarkers; i++) {
      ValueMetaAndData value=(ValueMetaAndData)row[data.argumentIndexes[data.markerPositions.size() - i - 1]];
      int pos=((Integer)data.markerPositions.get(i)).intValue();
      buf.replace(pos,pos + 1,value.getValueData().toString());
    }
    sql=buf.toString();
  }
 else {
    sql=data.sql;
  }
  if (log.isRowLevel())   logRowlevel(Messages.getString("ExecSQL.Log.ExecutingSQLScript") + Const.CR + data.sql);
  data.result=data.db.execStatements(sql.toString());
  RowMetaAndData add=getResultRow(data.result,meta.getUpdateField(),meta.getInsertField(),meta.getDeleteField(),meta.getReadField());
  row=RowDataUtil.addRowData(row,getInputRowMeta().size(),add.getData());
  if (!data.db.isAutoCommit()) {
    data.db.commit();
  }
  putRow(data.outputRowMeta,row);
  if (checkFeedback(linesWritten))   logBasic(Messages.getString("ExecSQL.Log.LineNumber") + linesWritten);
  return true;
}
