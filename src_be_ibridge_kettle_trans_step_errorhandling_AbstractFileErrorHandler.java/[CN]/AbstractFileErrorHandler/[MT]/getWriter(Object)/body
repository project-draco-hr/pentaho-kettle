{
  Writer outputStreamWriter=(Writer)writers.get(source);
  if (outputStreamWriter != null)   return outputStreamWriter;
  File file=getReplayFilename(destinationDirectory,processingFilename,dateString,fileExtension,source);
  ResultFile resultFile=new ResultFile(ResultFile.FILE_TYPE_GENERAL,file,baseStep.getTransMeta().getName(),baseStep.getStepname());
  baseStep.addResultFile(resultFile);
  try {
    if (encoding == null)     outputStreamWriter=new OutputStreamWriter(new FileOutputStream(file));
 else     outputStreamWriter=new OutputStreamWriter(new FileOutputStream(file),encoding);
  }
 catch (  Exception e) {
    throw new KettleException(Messages.getString("AbstractFileErrorHandler.Exception.CouldNotCreateFileErrorHandlerForFile") + file.getPath(),e);
  }
  writers.put(source,outputStreamWriter);
  return outputStreamWriter;
}
