{
  Row row;
  if (r == null)   row=new Row();
 else   row=r;
  if (databaseMeta == null)   return row;
  Database db=new Database(databaseMeta);
  databases=new Database[]{db};
  Row param=getParameterRow(info);
  Row add=null;
  try {
    add=db.getQueryFields(sql,true,param);
  }
 catch (  KettleDatabaseException dbe) {
    throw new KettleStepException("Unable to determine the fields of query:" + Const.CR + sql,dbe);
  }
  if (add != null) {
    for (int i=0; i < add.size(); i++) {
      Value v=add.getValue(i);
      v.setOrigin(name);
    }
    row.addRow(add);
  }
 else   try {
    db.connect();
    add=db.getQueryFields(sql,true,param);
    if (add == null)     return row;
    for (int i=0; i < add.size(); i++) {
      Value v=add.getValue(i);
      v.setOrigin(name);
    }
    row.addRow(add);
    db.disconnect();
  }
 catch (  KettleDatabaseException dbe) {
    throw new KettleStepException("Error obtaining fields for this step",dbe);
  }
  return row;
}
