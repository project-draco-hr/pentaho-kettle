{
  wLabel.setText(Messages.getString("RepositoryImportDialog.ImportXML.Label"));
  try {
    for (int ii=0; ii < filenames.length; ++ii) {
      final String filename=((fileDirectory != null) && (fileDirectory.length() > 0)) ? fileDirectory + Const.FILE_SEPARATOR + filenames[ii] : filenames[ii];
      log.logBasic("Repository","Import objects from XML file [" + filename + "]");
      addLog(Messages.getString("RepositoryImportDialog.WhichFile.Log",filename));
      wLabel.setText(Messages.getString("RepositoryImportDialog.WhichDir.Label"));
      Document doc=XMLHandler.loadXMLFile(filename);
      if (doc != null) {
        Node repnode=XMLHandler.getSubNode(doc,"repository");
        if (null == repnode) {
          Node firstnode=doc.getFirstChild();
          if ((null != firstnode) && firstnode.getNodeName().equals("transformation")) {
            nrtrans=filenames.length;
            wBar.setMinimum(0);
            wBar.setMaximum(nrtrans);
            wBar.setSelection(ii);
            askDirectory=false;
            if (!importTransformation(ii + 1,firstnode)) {
              return;
            }
            wBar.setSelection(ii + 1);
            continue;
          }
          if ((null != firstnode) && firstnode.getNodeName().equals("job")) {
            nrjobs=filenames.length;
            wBar.setMinimum(0);
            wBar.setMaximum(nrjobs);
            wBar.setSelection(ii);
            askDirectory=false;
            if (!importJob(ii + 1,firstnode)) {
              return;
            }
            wBar.setSelection(ii + 1);
            continue;
          }
        }
        Node transsnode=XMLHandler.getSubNode(repnode,"transformations");
        if (transsnode != null) {
          nrtrans=XMLHandler.countNodes(transsnode,"transformation");
          wBar.setMinimum(0);
          wBar.setMaximum(filenames.length - 1 + nrtrans);
          for (int i=0; i < nrtrans; i++) {
            wBar.setSelection(ii + i);
            wBar.getDisplay().update();
            Node transnode=XMLHandler.getSubNodeByNr(transsnode,"transformation",i);
            if (!importTransformation(i + 1,transnode)) {
              return;
            }
            wBar.setSelection(ii + i + 1);
            wBar.getDisplay().update();
          }
        }
        overwrite=false;
        askOverwrite=true;
        Node jobsnode=XMLHandler.getSubNode(repnode,"jobs");
        if (jobsnode != null) {
          nrjobs=XMLHandler.countNodes(jobsnode,"job");
          wBar.setMinimum(0);
          wBar.setMaximum(filenames.length - 1 + nrjobs);
          for (int i=0; i < nrjobs; i++) {
            wBar.setSelection(ii + i);
            wBar.getDisplay().update();
            Node jobnode=XMLHandler.getSubNodeByNr(jobsnode,"job",i);
            if (!importJob(i + 1,jobnode)) {
              return;
            }
            wBar.setSelection(ii + i + 1);
            wBar.getDisplay().update();
          }
        }
      }
 else {
        MessageBox mb=new MessageBox(shell,SWT.ICON_ERROR | SWT.OK);
        mb.setMessage(Messages.getString("RepositoryImportDialog.ErrorInvalidXML.Message"));
        mb.setText(Messages.getString("RepositoryImportDialog.ErrorInvalidXML.Title"));
        mb.open();
      }
    }
    addLog(Messages.getString("RepositoryImportDialog.ImportFinished.Log"));
  }
 catch (  KettleException e) {
    new ErrorDialog(shell,Messages.getString("RepositoryImportDialog.ErrorGeneral.Title"),Messages.getString("RepositoryImportDialog.ErrorGeneral.Message"),e);
  }
  wLabel.setText(Messages.getString("RepositoryImportDialog.ImportFinished.Log"));
}
