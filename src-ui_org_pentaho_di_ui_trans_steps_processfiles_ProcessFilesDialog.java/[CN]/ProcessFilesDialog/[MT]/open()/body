{
  Shell parent=getParent();
  Display display=parent.getDisplay();
  shell=new Shell(parent,SWT.DIALOG_TRIM | SWT.RESIZE | SWT.MAX| SWT.MIN);
  props.setLook(shell);
  setShellImage(shell,input);
  ModifyListener lsMod=new ModifyListener(){
    public void modifyText(    ModifyEvent e){
      input.setChanged();
    }
  }
;
  changed=input.hasChanged();
  FormLayout formLayout=new FormLayout();
  formLayout.marginWidth=Const.FORM_MARGIN;
  formLayout.marginHeight=Const.FORM_MARGIN;
  shell.setLayout(formLayout);
  shell.setText(BaseMessages.getString(PKG,"ProcessFilesDialog.Shell.Title"));
  int middle=props.getMiddlePct();
  int margin=Const.MARGIN;
  wlStepname=new Label(shell,SWT.RIGHT);
  wlStepname.setText(BaseMessages.getString(PKG,"ProcessFilesDialog.Stepname.Label"));
  props.setLook(wlStepname);
  fdlStepname=new FormData();
  fdlStepname.left=new FormAttachment(0,0);
  fdlStepname.right=new FormAttachment(middle,-margin);
  fdlStepname.top=new FormAttachment(0,margin);
  wlStepname.setLayoutData(fdlStepname);
  wStepname=new Text(shell,SWT.SINGLE | SWT.LEFT | SWT.BORDER);
  wStepname.setText(stepname);
  props.setLook(wStepname);
  wStepname.addModifyListener(lsMod);
  fdStepname=new FormData();
  fdStepname.left=new FormAttachment(middle,0);
  fdStepname.top=new FormAttachment(0,margin);
  fdStepname.right=new FormAttachment(100,0);
  wStepname.setLayoutData(fdStepname);
  wSettingsGroup=new Group(shell,SWT.SHADOW_NONE);
  props.setLook(wSettingsGroup);
  wSettingsGroup.setText(BaseMessages.getString(PKG,"ProcessFilesDialog.wSettingsGroup.Label"));
  FormLayout settingGroupLayout=new FormLayout();
  settingGroupLayout.marginWidth=10;
  settingGroupLayout.marginHeight=10;
  wSettingsGroup.setLayout(settingGroupLayout);
  wlOperation=new Label(wSettingsGroup,SWT.RIGHT);
  wlOperation.setText(BaseMessages.getString(PKG,"ProcessFilesDialog.Operation.Label"));
  props.setLook(wlOperation);
  fdlOperation=new FormData();
  fdlOperation.left=new FormAttachment(0,0);
  fdlOperation.right=new FormAttachment(middle,-margin);
  fdlOperation.top=new FormAttachment(wStepname,margin);
  wlOperation.setLayoutData(fdlOperation);
  wOperation=new CCombo(wSettingsGroup,SWT.BORDER | SWT.READ_ONLY);
  props.setLook(wOperation);
  wOperation.addModifyListener(lsMod);
  fdOperation=new FormData();
  fdOperation.left=new FormAttachment(middle,0);
  fdOperation.top=new FormAttachment(wStepname,margin);
  fdOperation.right=new FormAttachment(100,-margin);
  wOperation.setLayoutData(fdOperation);
  wOperation.setItems(ProcessFilesMeta.operationTypeDesc);
  wOperation.addSelectionListener(new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      updateOperation();
    }
  }
);
  wlCreateParentFolder=new Label(wSettingsGroup,SWT.RIGHT);
  wlCreateParentFolder.setText(BaseMessages.getString(PKG,"ProcessFilesDialog.CreateParentFolder.Label"));
  props.setLook(wlCreateParentFolder);
  fdlCreateParentFolder=new FormData();
  fdlCreateParentFolder.left=new FormAttachment(0,0);
  fdlCreateParentFolder.top=new FormAttachment(wOperation,margin);
  fdlCreateParentFolder.right=new FormAttachment(middle,-margin);
  wlCreateParentFolder.setLayoutData(fdlCreateParentFolder);
  wCreateParentFolder=new Button(wSettingsGroup,SWT.CHECK);
  props.setLook(wCreateParentFolder);
  wCreateParentFolder.setToolTipText(BaseMessages.getString(PKG,"ProcessFilesDialog.CreateParentFolder.Tooltip"));
  fdCreateParentFolder=new FormData();
  fdCreateParentFolder.left=new FormAttachment(middle,0);
  fdCreateParentFolder.top=new FormAttachment(wOperation,margin);
  wCreateParentFolder.setLayoutData(fdCreateParentFolder);
  wlOverwriteTarget=new Label(wSettingsGroup,SWT.RIGHT);
  wlOverwriteTarget.setText(BaseMessages.getString(PKG,"ProcessFilesDialog.OverwriteTarget.Label"));
  props.setLook(wlOverwriteTarget);
  fdlOverwriteTarget=new FormData();
  fdlOverwriteTarget.left=new FormAttachment(0,0);
  fdlOverwriteTarget.top=new FormAttachment(wCreateParentFolder,margin);
  fdlOverwriteTarget.right=new FormAttachment(middle,-margin);
  wlOverwriteTarget.setLayoutData(fdlOverwriteTarget);
  wOverwriteTarget=new Button(wSettingsGroup,SWT.CHECK);
  props.setLook(wOverwriteTarget);
  wOverwriteTarget.setToolTipText(BaseMessages.getString(PKG,"ProcessFilesDialog.OverwriteTarget.Tooltip"));
  fdOverwriteTarget=new FormData();
  fdOverwriteTarget.left=new FormAttachment(middle,0);
  fdOverwriteTarget.top=new FormAttachment(wCreateParentFolder,margin);
  wOverwriteTarget.setLayoutData(fdOverwriteTarget);
  wlAddResult=new Label(wSettingsGroup,SWT.RIGHT);
  wlAddResult.setText(BaseMessages.getString(PKG,"ProcessFilesDialog.AddResult.Label"));
  props.setLook(wlAddResult);
  fdlAddResult=new FormData();
  fdlAddResult.left=new FormAttachment(0,0);
  fdlAddResult.top=new FormAttachment(wOverwriteTarget,margin);
  fdlAddResult.right=new FormAttachment(middle,-margin);
  wlAddResult.setLayoutData(fdlAddResult);
  wAddResult=new Button(wSettingsGroup,SWT.CHECK);
  props.setLook(wAddResult);
  wAddResult.setToolTipText(BaseMessages.getString(PKG,"ProcessFilesDialog.AddResult.Tooltip"));
  fdAddResult=new FormData();
  fdAddResult.left=new FormAttachment(middle,0);
  fdAddResult.top=new FormAttachment(wOverwriteTarget,margin);
  wAddResult.setLayoutData(fdAddResult);
  wlSimulate=new Label(wSettingsGroup,SWT.RIGHT);
  wlSimulate.setText(BaseMessages.getString(PKG,"ProcessFilesDialog.Simulate.Label"));
  props.setLook(wlSimulate);
  fdlSimulate=new FormData();
  fdlSimulate.left=new FormAttachment(0,0);
  fdlSimulate.top=new FormAttachment(wAddResult,margin);
  fdlSimulate.right=new FormAttachment(middle,-margin);
  wlSimulate.setLayoutData(fdlSimulate);
  wSimulate=new Button(wSettingsGroup,SWT.CHECK);
  props.setLook(wSimulate);
  wSimulate.setToolTipText(BaseMessages.getString(PKG,"ProcessFilesDialog.Simulate.Tooltip"));
  fdSimulate=new FormData();
  fdSimulate.left=new FormAttachment(middle,0);
  fdSimulate.top=new FormAttachment(wAddResult,margin);
  wSimulate.setLayoutData(fdSimulate);
  fdSettingsGroup=new FormData();
  fdSettingsGroup.left=new FormAttachment(0,margin);
  fdSettingsGroup.top=new FormAttachment(wStepname,margin);
  fdSettingsGroup.right=new FormAttachment(100,-margin);
  wSettingsGroup.setLayoutData(fdSettingsGroup);
  wlSourceFileNameField=new Label(shell,SWT.RIGHT);
  wlSourceFileNameField.setText(BaseMessages.getString(PKG,"ProcessFilesDialog.SourceFileNameField.Label"));
  props.setLook(wlSourceFileNameField);
  fdlSourceFileNameField=new FormData();
  fdlSourceFileNameField.left=new FormAttachment(0,0);
  fdlSourceFileNameField.right=new FormAttachment(middle,-margin);
  fdlSourceFileNameField.top=new FormAttachment(wSettingsGroup,2 * margin);
  wlSourceFileNameField.setLayoutData(fdlSourceFileNameField);
  wSourceFileNameField=new CCombo(shell,SWT.BORDER | SWT.READ_ONLY);
  props.setLook(wSourceFileNameField);
  wSourceFileNameField.setEditable(true);
  wSourceFileNameField.addModifyListener(lsMod);
  fdSourceFileNameField=new FormData();
  fdSourceFileNameField.left=new FormAttachment(middle,0);
  fdSourceFileNameField.top=new FormAttachment(wSettingsGroup,2 * margin);
  fdSourceFileNameField.right=new FormAttachment(100,-margin);
  wSourceFileNameField.setLayoutData(fdSourceFileNameField);
  wSourceFileNameField.addFocusListener(new FocusListener(){
    public void focusLost(    org.eclipse.swt.events.FocusEvent e){
    }
    public void focusGained(    org.eclipse.swt.events.FocusEvent e){
      Cursor busy=new Cursor(shell.getDisplay(),SWT.CURSOR_WAIT);
      shell.setCursor(busy);
      get();
      shell.setCursor(null);
      busy.dispose();
    }
  }
);
  wlTargetFileNameField=new Label(shell,SWT.RIGHT);
  wlTargetFileNameField.setText(BaseMessages.getString(PKG,"ProcessFilesDialog.TargetFileNameField.Label"));
  props.setLook(wlTargetFileNameField);
  fdlTargetFileNameField=new FormData();
  fdlTargetFileNameField.left=new FormAttachment(0,0);
  fdlTargetFileNameField.right=new FormAttachment(middle,-margin);
  fdlTargetFileNameField.top=new FormAttachment(wSourceFileNameField,margin);
  wlTargetFileNameField.setLayoutData(fdlTargetFileNameField);
  wTargetFileNameField=new CCombo(shell,SWT.BORDER | SWT.READ_ONLY);
  wTargetFileNameField.setEditable(true);
  props.setLook(wTargetFileNameField);
  wTargetFileNameField.addModifyListener(lsMod);
  fdTargetFileNameField=new FormData();
  fdTargetFileNameField.left=new FormAttachment(middle,0);
  fdTargetFileNameField.top=new FormAttachment(wSourceFileNameField,margin);
  fdTargetFileNameField.right=new FormAttachment(100,-margin);
  wTargetFileNameField.setLayoutData(fdTargetFileNameField);
  wTargetFileNameField.addFocusListener(new FocusListener(){
    public void focusLost(    org.eclipse.swt.events.FocusEvent e){
    }
    public void focusGained(    org.eclipse.swt.events.FocusEvent e){
      Cursor busy=new Cursor(shell.getDisplay(),SWT.CURSOR_WAIT);
      shell.setCursor(busy);
      get();
      shell.setCursor(null);
      busy.dispose();
    }
  }
);
  wOK=new Button(shell,SWT.PUSH);
  wOK.setText(BaseMessages.getString(PKG,"System.Button.OK"));
  wCancel=new Button(shell,SWT.PUSH);
  wCancel.setText(BaseMessages.getString(PKG,"System.Button.Cancel"));
  setButtonPositions(new Button[]{wOK,wCancel},margin,wTargetFileNameField);
  lsOK=new Listener(){
    public void handleEvent(    Event e){
      ok();
    }
  }
;
  lsCancel=new Listener(){
    public void handleEvent(    Event e){
      cancel();
    }
  }
;
  wOK.addListener(SWT.Selection,lsOK);
  wCancel.addListener(SWT.Selection,lsCancel);
  lsDef=new SelectionAdapter(){
    public void widgetDefaultSelected(    SelectionEvent e){
      ok();
    }
  }
;
  wStepname.addSelectionListener(lsDef);
  shell.addShellListener(new ShellAdapter(){
    public void shellClosed(    ShellEvent e){
      cancel();
    }
  }
);
  setSize();
  getData();
  updateOperation();
  input.setChanged(changed);
  shell.open();
  while (!shell.isDisposed()) {
    if (!display.readAndDispatch())     display.sleep();
  }
  return stepname;
}
