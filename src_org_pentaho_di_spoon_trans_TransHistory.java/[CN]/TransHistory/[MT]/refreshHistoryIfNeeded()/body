{
  boolean reallyRefresh=false;
synchronized (refreshNeededLock) {
    reallyRefresh=refreshNeeded;
    refreshNeeded=false;
  }
  if (reallyRefresh) {
    refreshHistory();
  }
}
