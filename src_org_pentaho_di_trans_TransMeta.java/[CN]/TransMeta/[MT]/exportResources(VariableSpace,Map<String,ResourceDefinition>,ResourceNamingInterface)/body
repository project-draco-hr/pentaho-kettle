{
  try {
    FileObject fileObject=KettleVFS.getFileObject(space.environmentSubstitute(getFilename()));
    String exportFileName=resourceNamingInterface.nameResource(fileObject.getName().getBaseName(),fileObject.getParent().getName().getPath(),"ktr");
    ResourceDefinition definition=definitions.get(exportFileName);
    if (definition == null) {
      TransMeta transMeta=(TransMeta)this.realClone(false);
      for (      StepMeta stepMeta : transMeta.getSteps()) {
        stepMeta.exportResources(space,definitions,resourceNamingInterface);
      }
      transMeta.setFilename(exportFileName);
      String transMetaContent=transMeta.getXML();
      definition=new ResourceDefinition(exportFileName,transMetaContent);
      definitions.put(fileObject.getName().getPath(),definition);
    }
    return exportFileName;
  }
 catch (  FileSystemException e) {
    throw new KettleException(Messages.getString("TransMeta.Exception.ErrorOpeningOrValidatingTheXMLFile",getFilename()),e);
  }
catch (  IOException e) {
    throw new KettleException(Messages.getString("TransMeta.Exception.ErrorOpeningOrValidatingTheXMLFile",getFilename()),e);
  }
}
