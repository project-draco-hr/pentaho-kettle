{
  DataQuery query=null;
  try {
    query=new DataQuery(new URL(GaInputStepMeta.GA_DATA_URL));
  }
 catch (  MalformedURLException ex) {
    ex.printStackTrace();
    return null;
  }
  query.setIds(meta.isUseCustomTableId() ? environmentSubstitute(meta.getGaCustomTableId()) : meta.getGaProfileTableId());
  query.setStartDate(environmentSubstitute(meta.getStartDate()));
  query.setEndDate(environmentSubstitute(meta.getEndDate()));
  query.setDimensions(environmentSubstitute(meta.getDimensions()));
  query.setMetrics(environmentSubstitute(meta.getMetrics()));
  if (meta.isUseCustomSegment()) {
    query.setSegment(environmentSubstitute(meta.getCustomSegment()));
  }
 else {
    query.setSegment(meta.getSegmentId());
  }
  if (!Const.isEmpty(meta.getFilters())) {
    query.setFilters(environmentSubstitute(meta.getFilters()));
  }
  if (!Const.isEmpty(meta.getSort())) {
    query.setSort(environmentSubstitute(meta.getSort()));
  }
  if (!Const.isEmpty(meta.getGaApiKey())) {
    query.setStringCustomParameter("key",Encr.decryptPasswordOptionallyEncrypted(environmentSubstitute(meta.getGaApiKey())));
  }
  return query;
}
