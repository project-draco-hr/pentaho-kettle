{
  if (data.query == null) {
    data.query=getQuery();
    if (log.isDetailed()) {
      logDetailed("querying google analytics: " + data.query.getUrl());
    }
    String email=environmentSubstitute(meta.getGaEmail());
    String pass=Encr.decryptPasswordOptionallyEncrypted(environmentSubstitute(meta.getGaPassword()));
    AnalyticsService analyticsService=new AnalyticsService(environmentSubstitute(meta.getGaAppName()));
    try {
      analyticsService.setUserCredentials(email,pass);
      data.feed=analyticsService.getFeed(data.query.getUrl(),DataFeed.class);
      data.entryIndex=0;
    }
 catch (    AuthenticationException e1) {
      throw new KettleException(e1);
    }
catch (    IOException e2) {
      throw new KettleException(e2);
    }
catch (    ServiceException e3) {
      throw new KettleException(e3);
    }
  }
 else   if (data.entryIndex >= data.feed.getEntries().size()) {
    if (data.feed.getStartIndex() + data.entryIndex <= data.feed.getTotalResults()) {
      data.query.setStartIndex(data.feed.getStartIndex() + data.entryIndex);
      if (log.isDetailed()) {
        logDetailed("querying google analytics: " + data.query.getUrl());
      }
      String email=environmentSubstitute(meta.getGaEmail());
      String pass=environmentSubstitute(meta.getGaPassword());
      AnalyticsService analyticsService=new AnalyticsService(environmentSubstitute(meta.getGaAppName()));
      try {
        analyticsService.setUserCredentials(email,pass);
        data.feed=analyticsService.getFeed(data.query.getUrl(),DataFeed.class);
        data.entryIndex=0;
      }
 catch (      AuthenticationException e1) {
        throw new KettleException(e1);
      }
catch (      IOException e2) {
        throw new KettleException(e2);
      }
catch (      ServiceException e3) {
        throw new KettleException(e3);
      }
    }
  }
  List<DataEntry> entries=data.feed.getEntries();
  if (data.entryIndex < entries.size()) {
    return entries.get(data.entryIndex++);
  }
 else {
    return null;
  }
}
