{
  jobMeta.setName(wJobname.getText());
  jobMeta.setDescription(wJobdescription.getText());
  jobMeta.setExtendedDescription(wExtendeddescription.getText());
  jobMeta.setJobversion(wJobversion.getText());
  if (wJobstatus.getSelectionIndex() != 2) {
    jobMeta.setJobstatus(wJobstatus.getSelectionIndex() + 1);
  }
 else {
    jobMeta.setJobstatus(-1);
  }
  jobMeta.setLogConnection(jobMeta.findDatabase(wLogconnection.getText()));
  jobMeta.setLogTable(wLogtable.getText());
  jobMeta.eraseParameters();
  int nrNonEmptyFields=wParamFields.nrNonEmpty();
  for (int i=0; i < nrNonEmptyFields; i++) {
    TableItem item=wParamFields.getNonEmpty(i);
    try {
      jobMeta.addParameterDefinition(item.getText(1),item.getText(2),item.getText(3));
    }
 catch (    DuplicateParamException e) {
      if (log.isDetailed())       log.logDetailed(getClass().getName(),"Duplicate parameter '" + item.getText(1) + "' detected.");
    }
  }
  jobMeta.setUseBatchId(wBatch.getSelection());
  jobMeta.setBatchIdPassed(wBatchTrans.getSelection());
  jobMeta.setLogfieldUsed(wLogfield.getSelection());
  jobMeta.setSharedObjectsFile(wSharedObjectsFile.getText());
  if (newDirectory != null) {
    if (directoryChangeAllowed) {
      RepositoryDirectory dirFrom=jobMeta.getDirectory();
      long idDirFrom=dirFrom == null ? -1L : dirFrom.getID();
      try {
        rep.moveJob(jobMeta.getName(),idDirFrom,newDirectory.getID());
        log.logDetailed(getClass().getName(),"Moved directory to [" + newDirectory.getPath() + "]");
        jobMeta.setDirectory(newDirectory);
        wDirectory.setText(jobMeta.getDirectory().getPath());
      }
 catch (      KettleException dbe) {
        jobMeta.setDirectory(dirFrom);
        MessageBox mb=new MessageBox(shell,SWT.ICON_ERROR | SWT.OK);
        mb.setText(Messages.getString("JobDialog.Dialog.ErrorChangingDirectory.Title"));
        mb.setMessage(Messages.getString("JobDialog.Dialog.ErrorChangingDirectory.Message"));
        mb.open();
      }
    }
 else {
      jobMeta.setDirectory(newDirectory);
    }
  }
  dispose();
}
