{
  try {
    PluginInterface plugin=getPluginObject("market");
    if (plugin == null) {
      throw new KettleException("No Plugin!");
    }
    File pluginFolder=new File(plugin.getPluginDirectory().getFile());
    String parentFolderName=pluginFolder.getParent();
    ClassLoader cl=PluginRegistry.getInstance().getClassLoader(plugin);
    if (cl instanceof KettleURLClassLoader) {
      ((KettleURLClassLoader)cl).closeClassLoader();
    }
    deleteDirectory(pluginFolder);
    unzipMarketEntry(parentFolderName,packageUrl);
    Spoon.getInstance().getDisplay().asyncExec(new Runnable(){
      public void run(){
        try {
          refreshSpoon(monitorDialog);
          MessageBox box=new MessageBox(Spoon.getInstance().getShell(),SWT.ICON_WARNING | SWT.OK);
          box.setText(BaseMessages.getString(PKG,"MarketplacesDialog.RestartUpdate.Title"));
          box.setMessage(BaseMessages.getString(PKG,"MarketplacesDialog.RestartUpdate.Message"));
          box.open();
        }
 catch (        KettleException e) {
          e.printStackTrace();
        }
 finally {
          if (Market.class.getClassLoader() instanceof KettleURLClassLoader) {
            ((KettleURLClassLoader)Market.class.getClassLoader()).closeClassLoader();
          }
          path.delete();
        }
      }
    }
);
  }
 catch (  Exception e) {
    e.printStackTrace();
    if (Market.class.getClassLoader() instanceof KettleURLClassLoader) {
      ((KettleURLClassLoader)Market.class.getClassLoader()).closeClassLoader();
    }
    path.delete();
  }
}
