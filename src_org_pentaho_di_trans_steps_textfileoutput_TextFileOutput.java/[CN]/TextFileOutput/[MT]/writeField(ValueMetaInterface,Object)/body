{
  try {
    byte[] str;
    if (meta.isFastDump()) {
      if (valueData instanceof byte[]) {
        str=(byte[])valueData;
      }
 else {
        str=getBinaryString((valueData == null) ? "" : valueData.toString());
      }
    }
 else {
      str=formatField(v,valueData);
    }
    if (str != null) {
      List<Integer> enclosures=null;
      if (v.isString() && meta.isEnclosureForced() && !meta.isPadded()) {
        data.writer.write(data.binaryEnclosure);
        enclosures=getEnclosurePositions(str);
      }
      if (enclosures == null) {
        data.writer.write(str);
      }
 else {
        int from=0;
        for (int i=0; i < enclosures.size(); i++) {
          int position=enclosures.get(i);
          data.writer.write(str,from,position + data.binaryEnclosure.length);
          data.writer.write(data.binaryEnclosure);
          from=position + data.binaryEnclosure.length;
        }
        if (from < str.length) {
          data.writer.write(str,from,str.length - from);
        }
      }
      if (v.isString() && meta.isEnclosureForced() && !meta.isPadded()) {
        data.writer.write(data.binaryEnclosure);
      }
    }
  }
 catch (  Exception e) {
    throw new KettleStepException("Error writing field content to file",e);
  }
}
