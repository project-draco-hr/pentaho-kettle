{
  meta=(TextFileOutputMeta)smi;
  data=(TextFileOutputData)sdi;
  if (super.init(smi,sdi)) {
    data.splitnr=0;
    if (openNewFile()) {
      try {
        data.hasEncoding=!Const.isEmpty(meta.getEncoding());
        data.binarySeparator=new byte[]{};
        data.binaryEnclosure=new byte[]{};
        data.binaryNewline=new byte[]{};
        if (data.hasEncoding) {
          if (!Const.isEmpty(meta.getSeparator()))           data.binarySeparator=meta.getSeparator().getBytes(meta.getEncoding());
          if (!Const.isEmpty(meta.getEnclosure()))           data.binaryEnclosure=meta.getEnclosure().getBytes(meta.getEncoding());
          if (!Const.isEmpty(meta.getNewline()))           data.binaryNewline=meta.getNewline().getBytes(meta.getEncoding());
        }
 else {
          if (!Const.isEmpty(meta.getSeparator()))           data.binarySeparator=meta.getSeparator().getBytes();
          if (!Const.isEmpty(meta.getEnclosure()))           data.binaryEnclosure=meta.getEnclosure().getBytes();
          if (!Const.isEmpty(meta.getNewline()))           data.binaryNewline=meta.getNewline().getBytes();
        }
        data.binaryNullValue=new byte[meta.getOutputFields().length][];
        for (int i=0; i < meta.getOutputFields().length; i++) {
          data.binaryNullValue[i]=null;
          String nullString=meta.getOutputFields()[i].getNullString();
          if (!Const.isEmpty(nullString)) {
            if (data.hasEncoding) {
              data.binaryNullValue[i]=nullString.getBytes(meta.getEncoding());
            }
 else {
              data.binaryNullValue[i]=nullString.getBytes();
            }
          }
        }
      }
 catch (      UnsupportedEncodingException e) {
        logError("Encoding problem: " + e.toString());
        logError(Const.getStackTracker(e));
        return false;
      }
      return true;
    }
 else {
      logError("Couldn't open file " + meta.getFileName());
      setErrors(1L);
      stopAll();
    }
  }
  return false;
}
