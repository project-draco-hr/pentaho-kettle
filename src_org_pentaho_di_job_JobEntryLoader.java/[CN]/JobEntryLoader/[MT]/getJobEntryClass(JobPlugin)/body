{
  if (sp != null) {
    try {
      Class<?> cl=null;
switch (sp.getType()) {
case JobPlugin.TYPE_NATIVE:
{
          cl=Class.forName(sp.getClassname());
        }
      break;
case JobPlugin.TYPE_PLUGIN:
{
      ClassLoader ucl=getClassLoader(sp);
      cl=ucl.loadClass(sp.getClassname());
    }
  break;
default :
throw new KettleStepLoaderException("Unknown plugin type : " + sp.getType());
}
JobEntryInterface res=(JobEntryInterface)cl.newInstance();
if (sp.getType() == JobPlugin.TYPE_PLUGIN) {
res.setTypeId(sp.getID());
}
res.setDescription(sp.getDescription());
res.setName(sp.getID());
res.setConfigId(sp.getID());
return res;
}
 catch (ClassNotFoundException e) {
throw new KettleStepLoaderException("Class not found",e);
}
catch (InstantiationException e) {
throw new KettleStepLoaderException("Unable to instantiate class",e);
}
catch (IllegalAccessException e) {
throw new KettleStepLoaderException("Illegal access to class",e);
}
catch (Throwable e) {
throw new KettleStepLoaderException("Unexpected error loading class",e);
}
}
 else {
throw new KettleStepLoaderException("No valid job-entry/plugin specified (plugin=null).");
}
}
