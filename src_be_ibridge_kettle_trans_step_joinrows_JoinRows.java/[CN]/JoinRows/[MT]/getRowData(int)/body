{
  data.restart[filenr]=false;
  Row r=null;
  if (filenr == 0) {
    debug="Get row from rowset #" + filenr;
    r=getRowFrom(0);
    logRowlevel("Read row from stream #0 : " + (r == null ? "<null>" : r.toString()));
  }
 else {
    if (data.cache[filenr] == null) {
      debug="Get row from file #" + filenr;
      if (data.dataInputStream[filenr] == null) {
        try {
          debug="Open file input stream #" + filenr;
          data.fileInputStream[filenr]=new FileInputStream(data.file[filenr]);
          debug="Open data input stream #" + filenr;
          data.dataInputStream[filenr]=new DataInputStream(data.fileInputStream[filenr]);
        }
 catch (        FileNotFoundException fnfe) {
          logError("Unable to find/open temporary file [" + data.file[filenr] + "] : "+ fnfe.toString());
          setErrors(1);
          stopAll();
          return null;
        }
      }
      debug="Read row from the data input stream #" + filenr;
      if (data.size[filenr] == 0) {
        logBasic("No rows coming from step [" + data.rs[filenr].getOriginStepName() + "]");
        return null;
      }
      try {
        r=new Row(data.dataInputStream[filenr],data.row[filenr].size(),data.row[filenr]);
      }
 catch (      KettleFileException e) {
        logError("Unable to read data from temporary file #" + filenr + " ["+ data.file[filenr]+ "]");
        setErrors(1);
        stopAll();
        return null;
      }
      logRowlevel("Read row from file #" + filenr + " : "+ r);
      data.position[filenr]++;
      if (data.position[filenr] >= data.size[filenr]) {
        debug="Close stream #" + filenr;
        try {
          data.dataInputStream[filenr].close();
          data.fileInputStream[filenr].close();
          data.dataInputStream[filenr]=null;
          data.fileInputStream[filenr]=null;
          data.position[filenr]=0;
          data.restart[filenr]=true;
        }
 catch (        IOException ioe) {
          logError("Unable to close input stream to file [" + data.file[filenr] + "] : "+ ioe.toString());
          setErrors(1);
          stopAll();
          return null;
        }
      }
    }
 else {
      debug="Get row from cache #" + filenr + " size="+ data.cache[filenr].size();
      if (data.size[filenr] == 0) {
        logBasic("No rows coming from step [" + data.rs[filenr].getOriginStepName() + "]");
        return null;
      }
      r=(Row)data.cache[filenr].get(data.position[data.filenr]);
      data.position[filenr]++;
      if (data.position[filenr] >= data.size[filenr]) {
        debug="Position=0, restart=true for filenr=" + filenr;
        data.position[filenr]=0;
        data.restart[filenr]=true;
      }
    }
  }
  return r;
}
