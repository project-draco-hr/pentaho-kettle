{
  InputStream inputStream=null;
  try {
    BufferedImage image=ImageIO.read(new File(fileName));
    if (image == null) {
      image=ImageIO.read(new File("/" + fileName));
    }
    if (image == null) {
      inputStream=getClass().getResourceAsStream(fileName);
      if (inputStream == null) {
        inputStream=getClass().getResourceAsStream("/" + fileName);
      }
      if (inputStream == null) {
        throw new KettleException("Unable to load image from file : '" + fileName + "'");
      }
      image=ImageIO.read(inputStream);
    }
    WaitingImageObserver observer=new WaitingImageObserver(image);
    observer.waitImageLoaded();
    return image;
  }
 catch (  Throwable e) {
    throw new KettleException("Unable to load image from file : '" + fileName + "'",e);
  }
 finally {
    if (inputStream != null) {
      try {
        inputStream.close();
      }
 catch (      IOException e) {
        throw new KettleException("Unable to close image reading stream",e);
      }
    }
  }
}
