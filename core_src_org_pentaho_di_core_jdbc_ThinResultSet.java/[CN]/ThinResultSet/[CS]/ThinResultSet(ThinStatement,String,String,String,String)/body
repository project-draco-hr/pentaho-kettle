{
  this.statement=statement;
  this.connection=(ThinConnection)statement.getConnection();
  rowNumber=0;
  stopped=new AtomicBoolean(false);
  try {
    HttpClient client=null;
    try {
      client=SlaveConnectionManager.getInstance().createHttpClient();
      client.getHttpConnectionManager().getParams().setConnectionTimeout(0);
      client.getHttpConnectionManager().getParams().setSoTimeout(0);
      HttpUtil.addCredentials(client,new Variables(),connection.getHostname(),connection.getPort(),connection.getWebAppName(),connection.getUsername(),connection.getPassword());
      HttpUtil.addProxy(client,new Variables(),connection.getHostname(),connection.getProxyHostname(),connection.getProxyPort(),connection.getNonProxyHosts());
      method=new PostMethod(urlString);
      method.setDoAuthentication(true);
      method.addRequestHeader(new Header("SQL",ThinUtil.stripNewlines(sql)));
      method.addRequestHeader(new Header("MaxRows",Integer.toString(statement.getMaxRows())));
      method.getParams().setParameter("http.socket.timeout",new Integer(0));
      for (      Entry<String,String> arg : connection.getArguments().entrySet()) {
        method.addParameter(arg.getKey(),arg.getValue());
      }
      int result=client.executeMethod(method);
      if (result == 500) {
        String response=getErrorString(method.getResponseBodyAsStream());
        throw new KettleException("Error 500 reading data from slave server, url='" + urlString + "', response: "+ response);
      }
      if (result == 401) {
        String response=getErrorString(method.getResponseBodyAsStream());
        throw new KettleException("Access denied error 401 received while attempting to read data from server, url='" + urlString + "', response: "+ response);
      }
      if (result != 200) {
        String response=getErrorString(method.getResponseBodyAsStream());
        throw new KettleException("Error received while attempting to read data from server, url='" + urlString + "', response: "+ response);
      }
      dataInputStream=new DataInputStream(method.getResponseBodyAsStream());
      serviceName=dataInputStream.readUTF();
      serviceTransName=dataInputStream.readUTF();
      serviceObjectId=dataInputStream.readUTF();
      sqlTransName=dataInputStream.readUTF();
      sqlObjectId=dataInputStream.readUTF();
      rowMeta=new RowMeta(dataInputStream);
    }
 catch (    KettleEOFException eof) {
      close();
    }
  }
 catch (  Exception e) {
    throw new SQLException("Unable to get open query for SQL: " + sql + Const.CR+ Const.getStackTracker(e),e);
  }
}
