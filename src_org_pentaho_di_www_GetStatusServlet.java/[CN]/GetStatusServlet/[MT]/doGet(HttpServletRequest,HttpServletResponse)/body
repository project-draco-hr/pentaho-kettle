{
  if (isJettyMode() && !request.getContextPath().startsWith(CONTEXT_PATH)) {
    return;
  }
  if (log.isDebug())   logDebug(BaseMessages.getString(PKG,"GetStatusServlet.StatusRequested"));
  response.setStatus(HttpServletResponse.SC_OK);
  boolean useXML="Y".equalsIgnoreCase(request.getParameter("xml"));
  if (useXML) {
    response.setContentType("text/xml");
    response.setCharacterEncoding(Const.XML_ENCODING);
  }
 else {
    response.setContentType("text/html");
  }
  PrintStream out=new PrintStream(response.getOutputStream());
  String[] transNames=getTransformationMap().getTransformationNames();
  String[] jobNames=getJobMap().getJobNames();
  if (useXML) {
    out.print(XMLHandler.getXMLHeader(Const.XML_ENCODING));
    SlaveServerStatus serverStatus=new SlaveServerStatus();
    serverStatus.setStatusDescription("Online");
    for (int i=0; i < transNames.length; i++) {
      String name=transNames[i];
      Trans trans=getTransformationMap().getTransformation(name);
      String status=trans.getStatus();
      SlaveServerTransStatus sstatus=new SlaveServerTransStatus(name,status);
      sstatus.setPaused(trans.isPaused());
      serverStatus.getTransStatusList().add(sstatus);
    }
    for (int i=0; i < jobNames.length; i++) {
      String name=jobNames[i];
      Job job=getJobMap().getJob(name);
      String status=job.getStatus();
      serverStatus.getJobStatusList().add(new SlaveServerJobStatus(name,status));
    }
    try {
      out.println(serverStatus.getXML());
    }
 catch (    KettleException e) {
      throw new ServletException("Unable to get the server status in XML format",e);
    }
  }
 else {
    out.println("<HTML>");
    out.println("<HEAD><TITLE>" + BaseMessages.getString(PKG,"GetStatusServlet.KettleSlaveServerStatus") + "</TITLE></HEAD>");
    out.println("<BODY>");
    out.println("<H1>" + BaseMessages.getString(PKG,"GetStatusServlet.TopStatus") + "</H1>");
    try {
      out.println("<table border=\"1\">");
      out.print("<tr> <th>" + BaseMessages.getString(PKG,"GetStatusServlet.TransName") + "</th> <th>"+ BaseMessages.getString(PKG,"GetStatusServlet.Status")+ "</th> </tr>");
      for (int i=0; i < transNames.length; i++) {
        String name=transNames[i];
        Trans trans=getTransformationMap().getTransformation(name);
        String status=trans.getStatus();
        out.print("<tr>");
        out.print("<td><a href=\"" + convertContextPath(GetTransStatusServlet.CONTEXT_PATH) + "?name="+ URLEncoder.encode(name,"UTF-8")+ "\">"+ name+ "</a></td>");
        out.print("<td>" + status + "</td>");
        out.print("</tr>");
      }
      out.print("</table><p>");
      out.println("<table border=\"1\">");
      out.print("<tr> <th>" + BaseMessages.getString(PKG,"GetStatusServlet.JobName") + "</th> <th>"+ BaseMessages.getString(PKG,"GetStatusServlet.Status")+ "</th> </tr>");
      for (int i=0; i < jobNames.length; i++) {
        String name=jobNames[i];
        Job job=getJobMap().getJob(name);
        String status=job.getStatus();
        out.print("<tr>");
        out.print("<td><a href=\"" + convertContextPath(GetJobStatusServlet.CONTEXT_PATH) + "?name="+ URLEncoder.encode(name,"UTF-8")+ "\">"+ name+ "</a></td>");
        out.print("<td>" + status + "</td>");
        out.print("</tr>");
      }
      out.print("</table>");
    }
 catch (    Exception ex) {
      out.println("<p>");
      out.println("<pre>");
      ex.printStackTrace(out);
      out.println("</pre>");
    }
    out.println("<p>");
    out.println("</BODY>");
    out.println("</HTML>");
  }
}
