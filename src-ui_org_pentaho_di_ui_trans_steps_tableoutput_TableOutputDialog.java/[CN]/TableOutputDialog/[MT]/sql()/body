{
  try {
    TableOutputMeta info=new TableOutputMeta();
    getInfo(info);
    RowMetaInterface prev=transMeta.getPrevStepFields(stepname);
    if (info.isTableNameInField() && !info.isTableNameInTable() && info.getTableNameField().length() > 0) {
      int idx=prev.indexOfValue(info.getTableNameField());
      if (idx >= 0)       prev.removeValueMeta(idx);
    }
    StepMeta stepMeta=transMeta.findStep(stepname);
    if (info.specifyFields()) {
      RowMetaInterface prevNew=new RowMeta();
      for (int i=0; i < info.getFieldDatabase().length; i++) {
        ValueMetaInterface insValue=prev.searchValueMeta(info.getFieldStream()[i]);
        if (insValue != null) {
          ValueMetaInterface insertValue=insValue.clone();
          insertValue.setName(info.getFieldDatabase()[i]);
          prevNew.addValueMeta(insertValue);
        }
 else {
          throw new KettleStepException(Messages.getString("TableOutputDialog.FailedToFindField.Message",info.getFieldStream()[i]));
        }
      }
      prev=prevNew;
    }
    SQLStatement sql=info.getSQLStatements(transMeta,stepMeta,prev);
    if (!sql.hasError()) {
      if (sql.hasSQL()) {
        SQLEditor sqledit=new SQLEditor(shell,SWT.NONE,info.getDatabaseMeta(),transMeta.getDbCache(),sql.getSQL());
        sqledit.open();
      }
 else {
        MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_INFORMATION);
        mb.setMessage(Messages.getString("TableOutputDialog.NoSQL.DialogMessage"));
        mb.setText(Messages.getString("TableOutputDialog.NoSQL.DialogTitle"));
        mb.open();
      }
    }
 else {
      MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
      mb.setMessage(sql.getError());
      mb.setText(Messages.getString("System.Dialog.Error.Title"));
      mb.open();
    }
  }
 catch (  KettleException ke) {
    new ErrorDialog(shell,Messages.getString("TableOutputDialog.BuildSQLError.DialogTitle"),Messages.getString("TableOutputDialog.BuildSQLError.DialogMessage"),ke);
  }
}
