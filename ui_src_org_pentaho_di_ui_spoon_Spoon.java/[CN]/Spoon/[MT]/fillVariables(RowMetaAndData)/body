{
  TransMeta[] transMetas=getLoadedTransformations();
  JobMeta[] jobMetas=getLoadedJobs();
  if ((transMetas == null || transMetas.length == 0) && (jobMetas == null || jobMetas.length == 0))   return;
  Properties sp=new Properties();
  sp.putAll(System.getProperties());
  VariableSpace space=Variables.getADefaultVariableSpace();
  String keys[]=space.listVariables();
  for (int i=0; i < keys.length; i++) {
    sp.put(keys[i],space.getVariable(keys[i]));
  }
  for (int t=0; t < transMetas.length; t++) {
    TransMeta transMeta=transMetas[t];
    List<String> list=transMeta.getUsedVariables();
    for (int i=0; i < list.size(); i++) {
      String varName=list.get(i);
      String varValue=sp.getProperty(varName,"");
      if (vars.getRowMeta().indexOfValue(varName) < 0 && !varName.startsWith(Const.INTERNAL_VARIABLE_PREFIX)) {
        vars.addValue(new ValueMeta(varName,ValueMetaInterface.TYPE_STRING),varValue);
      }
    }
  }
  for (int t=0; t < jobMetas.length; t++) {
    JobMeta jobMeta=jobMetas[t];
    List<String> list=jobMeta.getUsedVariables();
    for (int i=0; i < list.size(); i++) {
      String varName=list.get(i);
      String varValue=sp.getProperty(varName,"");
      if (vars.getRowMeta().indexOfValue(varName) < 0 && !varName.startsWith(Const.INTERNAL_VARIABLE_PREFIX)) {
        vars.addValue(new ValueMeta(varName,ValueMetaInterface.TYPE_STRING),varValue);
      }
    }
  }
}
