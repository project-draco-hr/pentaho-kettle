{
  try {
    Enumeration<URL> resources=getClass().getClassLoader().getResources("META-INF/step_plugin.xml");
    while (resources.hasMoreElements()) {
      URL url=resources.nextElement();
      Object content=url.getContent();
      if (content instanceof InputStream) {
        readPluginFromResource((InputStream)content,null,null,StepPlugin.TYPE_NATIVE);
      }
    }
  }
 catch (  Exception e) {
    throw new KettleException("Unable to load plugins specified in 'META-INF/step_plugin.xml' files",e);
  }
  try {
    Enumeration<URL> resources=getClass().getClassLoader().getResources("META-INF/kettle-partition-plugins.xml");
    while (resources.hasMoreElements()) {
      URL url=resources.nextElement();
      Object content=url.getContent();
      if (content instanceof InputStream) {
        readPluginFromResource((InputStream)content,null,null,StepPlugin.TYPE_NATIVE);
      }
    }
    resources=getClass().getClassLoader().getResources("kettle-partition-plugins.xml");
    while (resources.hasMoreElements()) {
      URL url=resources.nextElement();
      Object content=url.getContent();
      if (content instanceof InputStream) {
        readPluginFromResource((InputStream)content,null,null,StepPlugin.TYPE_NATIVE);
      }
    }
  }
 catch (  Exception e) {
    throw new KettleException("Unable to load plugins specified in 'META-INF/kettle-partition-plugins.xml' files",e);
  }
  for (int dirNr=0; dirNr < pluginDirectory.length; dirNr++) {
    try {
      File f=new File(pluginDirectory[dirNr]);
      if (f.isDirectory() && f.exists()) {
        LogWriter log=LogWriter.getInstance();
        log.logDetailed(Messages.getString("StepLoader.Log.StepLoader.Title"),Messages.getString("StepLoader.Log.StepLoader.Description") + pluginDirectory[dirNr]);
        String dirs[]=f.list();
        for (int i=0; i < dirs.length; i++) {
          String piDir=pluginDirectory[dirNr] + Const.FILE_SEPARATOR + dirs[i];
          File pi=new File(piDir);
          if (pi.isDirectory()) {
            String pixml=pi.toString() + Const.FILE_SEPARATOR + "plugin.xml";
            File fpixml=new File(pixml);
            if (fpixml.canRead()) {
              readPluginFromResource(new FileInputStream(fpixml),pi.getPath(),dirs[i],StepPlugin.TYPE_PLUGIN);
            }
          }
        }
      }
    }
 catch (    Exception e) {
      throw new KettleException(Messages.getString("StepLoader.RuntimeError.CouldNotFindDirectory.TRANS0002",pluginDirectory[dirNr]),e);
    }
  }
}
