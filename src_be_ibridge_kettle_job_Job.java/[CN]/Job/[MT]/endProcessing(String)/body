{
  long read=0L, written=0L, updated=0L, errors=0L, input=0L, output=0L;
  logDate=new Date();
  String log_string=null;
  if (jobMeta.isLogfieldUsed()) {
    log_string=log.getString();
    log_string+=Const.CR + "END" + Const.CR;
    log.setString("");
    log.endStringCapture();
  }
  DatabaseMeta logcon=jobMeta.getLogConnection();
  if (logcon != null) {
    Database ldb=new Database(logcon);
    try {
      ldb.connect();
      ldb.writeLogRecord(jobMeta.getLogTable(),jobMeta.isBatchIdUsed(),jobMeta.getBatchId(),true,jobMeta.getName(),status,read,written,updated,input,output,errors,startDate,endDate,logDate,depDate,currentDate,log_string);
    }
 catch (    KettleDatabaseException dbe) {
      addErrors(1);
      throw new KettleJobException("Unable to end processing by writing log record to table " + jobMeta.getLogTable(),dbe);
    }
 finally {
      ldb.disconnect();
    }
  }
  return true;
}
