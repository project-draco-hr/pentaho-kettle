{
  TransMeta transMeta=spoon.getActiveTransformation();
  if (transMeta == null) {
    return;
  }
  if (lastChained != null && transMeta.findStep(lastChained.getName()) == null) {
    lastChained=null;
  }
  List<StepMeta> sel=transMeta.getSelectedSteps();
  if (sel.size() == 1) {
    lastChained=sel.get(0);
  }
  Point p=null;
  if (lastChained == null) {
    p=transMeta.getMaximum();
    p.x-=100;
  }
 else {
    p=new Point(lastChained.getLocation().x,lastChained.getLocation().y);
  }
  p.x+=200;
  try {
    StepMetaInterface stepMetaInterface=(StepMetaInterface)PluginRegistry.getInstance().loadClass(stepPlugin);
    stepMetaInterface.setDefault();
    StepMeta newStep=new StepMeta(stepPlugin.getName(),stepMetaInterface);
    newStep.setLocation(p.x,p.y);
    newStep.setDraw(true);
    transMeta.addStep(newStep);
    transMeta.addTransHop(new TransHopMeta(lastChained,newStep));
    lastChained=newStep;
    spoon.refreshGraph();
    spoon.refreshTree();
    if (shift) {
      editStep(newStep);
    }
    newStep.setSelected(true);
  }
 catch (  KettlePluginException e) {
    LogChannel.GENERAL.logError("Error chaining step...",e);
  }
}
