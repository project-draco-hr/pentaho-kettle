{
  Shell parent=getParent();
  display=parent.getDisplay();
  shell=new Shell(parent,SWT.DIALOG_TRIM | SWT.RESIZE);
  props.setLook(shell);
  ModifyListener lsMod=new ModifyListener(){
    public void modifyText(    ModifyEvent e){
      jobmail.setChanged();
    }
  }
;
  backupChanged=jobmail.hasChanged();
  backupDate=jobmail.getIncludeDate();
  FormLayout formLayout=new FormLayout();
  formLayout.marginWidth=Const.FORM_MARGIN;
  formLayout.marginHeight=Const.FORM_MARGIN;
  shell.setLayout(formLayout);
  shell.setText("Job mail details:");
  int middle=props.getMiddlePct();
  int margin=Const.MARGIN;
  wlName=new Label(shell,SWT.RIGHT);
  wlName.setText("Name of mail job entry: ");
  props.setLook(wlName);
  fdlName=new FormData();
  fdlName.left=new FormAttachment(0,0);
  fdlName.top=new FormAttachment(0,0);
  fdlName.right=new FormAttachment(middle,0);
  wlName.setLayoutData(fdlName);
  wName=new Text(shell,SWT.SINGLE | SWT.LEFT | SWT.BORDER);
  props.setLook(wName);
  wName.addModifyListener(lsMod);
  fdName=new FormData();
  fdName.top=new FormAttachment(0,0);
  fdName.left=new FormAttachment(middle,0);
  fdName.right=new FormAttachment(100,0);
  wName.setLayoutData(fdName);
  wlDestination=new Label(shell,SWT.RIGHT);
  wlDestination.setText("Destination address: ");
  props.setLook(wlDestination);
  fdlDestination=new FormData();
  fdlDestination.left=new FormAttachment(0,0);
  fdlDestination.top=new FormAttachment(wName,margin);
  fdlDestination.right=new FormAttachment(middle,0);
  wlDestination.setLayoutData(fdlDestination);
  wDestination=new Text(shell,SWT.SINGLE | SWT.LEFT | SWT.BORDER);
  props.setLook(wDestination);
  wDestination.addModifyListener(lsMod);
  fdDestination=new FormData();
  fdDestination.left=new FormAttachment(middle,0);
  fdDestination.top=new FormAttachment(wName,margin);
  fdDestination.right=new FormAttachment(100,0);
  wDestination.setLayoutData(fdDestination);
  wlServer=new Label(shell,SWT.RIGHT);
  wlServer.setText("SMTP Server: ");
  props.setLook(wlServer);
  fdlServer=new FormData();
  fdlServer.left=new FormAttachment(0,0);
  fdlServer.top=new FormAttachment(wDestination,margin);
  fdlServer.right=new FormAttachment(middle,0);
  wlServer.setLayoutData(fdlServer);
  wServer=new Text(shell,SWT.SINGLE | SWT.LEFT | SWT.BORDER);
  props.setLook(wServer);
  wServer.addModifyListener(lsMod);
  fdServer=new FormData();
  fdServer.left=new FormAttachment(middle,0);
  fdServer.top=new FormAttachment(wDestination,margin);
  fdServer.right=new FormAttachment(100,0);
  wServer.setLayoutData(fdServer);
  wlReply=new Label(shell,SWT.RIGHT);
  wlReply.setText("Reply address: ");
  props.setLook(wlReply);
  fdlReply=new FormData();
  fdlReply.left=new FormAttachment(0,0);
  fdlReply.top=new FormAttachment(wServer,margin);
  fdlReply.right=new FormAttachment(middle,0);
  wlReply.setLayoutData(fdlReply);
  wReply=new Text(shell,SWT.SINGLE | SWT.LEFT | SWT.BORDER);
  props.setLook(wReply);
  wReply.addModifyListener(lsMod);
  fdReply=new FormData();
  fdReply.left=new FormAttachment(middle,0);
  fdReply.top=new FormAttachment(wServer,margin);
  fdReply.right=new FormAttachment(100,0);
  wReply.setLayoutData(fdReply);
  wlSubject=new Label(shell,SWT.RIGHT);
  wlSubject.setText("Subject: ");
  props.setLook(wlSubject);
  fdlSubject=new FormData();
  fdlSubject.left=new FormAttachment(0,0);
  fdlSubject.top=new FormAttachment(wReply,margin);
  fdlSubject.right=new FormAttachment(middle,0);
  wlSubject.setLayoutData(fdlSubject);
  wSubject=new Text(shell,SWT.SINGLE | SWT.LEFT | SWT.BORDER);
  props.setLook(wSubject);
  wSubject.addModifyListener(lsMod);
  fdSubject=new FormData();
  fdSubject.left=new FormAttachment(middle,0);
  fdSubject.top=new FormAttachment(wReply,margin);
  fdSubject.right=new FormAttachment(100,0);
  wSubject.setLayoutData(fdSubject);
  wlAddDate=new Label(shell,SWT.RIGHT);
  wlAddDate.setText("Include date in message?");
  props.setLook(wlAddDate);
  fdlAddDate=new FormData();
  fdlAddDate.left=new FormAttachment(0,0);
  fdlAddDate.top=new FormAttachment(wSubject,margin);
  fdlAddDate.right=new FormAttachment(middle,-margin);
  wlAddDate.setLayoutData(fdlAddDate);
  wAddDate=new Button(shell,SWT.CHECK);
  props.setLook(wAddDate);
  fdAddDate=new FormData();
  fdAddDate.left=new FormAttachment(middle,0);
  fdAddDate.top=new FormAttachment(wSubject,margin);
  fdAddDate.right=new FormAttachment(100,0);
  wAddDate.setLayoutData(fdAddDate);
  wAddDate.addSelectionListener(new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      jobmail.setIncludeDate(jobmail.getIncludeDate());
      jobmail.setChanged();
    }
  }
);
  wlIncludeFiles=new Label(shell,SWT.RIGHT);
  wlIncludeFiles.setText("Attach files to message?");
  props.setLook(wlIncludeFiles);
  fdlIncludeFiles=new FormData();
  fdlIncludeFiles.left=new FormAttachment(0,0);
  fdlIncludeFiles.top=new FormAttachment(wAddDate,margin);
  fdlIncludeFiles.right=new FormAttachment(middle,-margin);
  wlIncludeFiles.setLayoutData(fdlIncludeFiles);
  wIncludeFiles=new Button(shell,SWT.CHECK);
  props.setLook(wIncludeFiles);
  fdIncludeFiles=new FormData();
  fdIncludeFiles.left=new FormAttachment(middle,0);
  fdIncludeFiles.top=new FormAttachment(wAddDate,margin);
  fdIncludeFiles.right=new FormAttachment(100,0);
  wIncludeFiles.setLayoutData(fdIncludeFiles);
  wIncludeFiles.addSelectionListener(new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      jobmail.setIncludeFiles(jobmail.isIncludeFiles());
      jobmail.setChanged();
    }
  }
);
  wlPerson=new Label(shell,SWT.RIGHT);
  wlPerson.setText("Contact person: ");
  props.setLook(wlPerson);
  fdlPerson=new FormData();
  fdlPerson.left=new FormAttachment(0,0);
  fdlPerson.top=new FormAttachment(wIncludeFiles,margin);
  fdlPerson.right=new FormAttachment(middle,0);
  wlPerson.setLayoutData(fdlPerson);
  wPerson=new Text(shell,SWT.SINGLE | SWT.LEFT | SWT.BORDER);
  props.setLook(wPerson);
  wPerson.addModifyListener(lsMod);
  fdPerson=new FormData();
  fdPerson.left=new FormAttachment(middle,0);
  fdPerson.top=new FormAttachment(wIncludeFiles,margin);
  fdPerson.right=new FormAttachment(100,0);
  wPerson.setLayoutData(fdPerson);
  wlPhone=new Label(shell,SWT.RIGHT);
  wlPhone.setText("Contact Phone: ");
  props.setLook(wlPhone);
  fdlPhone=new FormData();
  fdlPhone.left=new FormAttachment(0,0);
  fdlPhone.top=new FormAttachment(wPerson,margin);
  fdlPhone.right=new FormAttachment(middle,0);
  wlPhone.setLayoutData(fdlPhone);
  wPhone=new Text(shell,SWT.SINGLE | SWT.LEFT | SWT.BORDER);
  props.setLook(wPhone);
  wPhone.addModifyListener(lsMod);
  fdPhone=new FormData();
  fdPhone.left=new FormAttachment(middle,0);
  fdPhone.top=new FormAttachment(wPerson,margin);
  fdPhone.right=new FormAttachment(100,0);
  wPhone.setLayoutData(fdPhone);
  wlComment=new Label(shell,SWT.RIGHT);
  wlComment.setText("Comment: ");
  props.setLook(wlComment);
  fdlComment=new FormData();
  fdlComment.left=new FormAttachment(0,0);
  fdlComment.top=new FormAttachment(wPhone,margin);
  fdlComment.right=new FormAttachment(middle,0);
  wlComment.setLayoutData(fdlComment);
  wComment=new Text(shell,SWT.MULTI | SWT.LEFT | SWT.BORDER| SWT.V_SCROLL| SWT.H_SCROLL);
  props.setLook(wComment);
  wComment.addModifyListener(lsMod);
  fdComment=new FormData();
  fdComment.left=new FormAttachment(middle,0);
  fdComment.top=new FormAttachment(wPhone,margin);
  fdComment.right=new FormAttachment(100,0);
  fdComment.bottom=new FormAttachment(100,-50);
  wComment.setLayoutData(fdComment);
  wOK=new Button(shell,SWT.PUSH);
  wOK.setText("  &OK  ");
  wCancel=new Button(shell,SWT.PUSH);
  wCancel.setText("  &Cancel  ");
  BaseStepDialog.positionBottomButtons(shell,new Button[]{wOK,wCancel},margin,null);
  lsCancel=new Listener(){
    public void handleEvent(    Event e){
      cancel();
    }
  }
;
  lsOK=new Listener(){
    public void handleEvent(    Event e){
      ok();
    }
  }
;
  wOK.addListener(SWT.Selection,lsOK);
  wCancel.addListener(SWT.Selection,lsCancel);
  lsDef=new SelectionAdapter(){
    public void widgetDefaultSelected(    SelectionEvent e){
      ok();
    }
  }
;
  wName.addSelectionListener(lsDef);
  wServer.addSelectionListener(lsDef);
  wSubject.addSelectionListener(lsDef);
  wDestination.addSelectionListener(lsDef);
  wReply.addSelectionListener(lsDef);
  wPerson.addSelectionListener(lsDef);
  wPhone.addSelectionListener(lsDef);
  wComment.addSelectionListener(lsDef);
  shell.addShellListener(new ShellAdapter(){
    public void shellClosed(    ShellEvent e){
      cancel();
    }
  }
);
  getData();
  WindowProperty winprop=props.getScreen(shell.getText());
  if (winprop != null)   winprop.setShell(shell);
 else   shell.pack();
  shell.open();
  while (!shell.isDisposed()) {
    if (!display.readAndDispatch())     display.sleep();
  }
  return jobmail;
}
