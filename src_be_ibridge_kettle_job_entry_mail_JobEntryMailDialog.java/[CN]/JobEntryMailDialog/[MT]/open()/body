{
  Shell parent=getParent();
  display=parent.getDisplay();
  shell=new Shell(parent,SWT.DIALOG_TRIM | SWT.RESIZE);
  props.setLook(shell);
  JobDialog.setShellImage(shell,jobEntry);
  ModifyListener lsMod=new ModifyListener(){
    public void modifyText(    ModifyEvent e){
      jobEntry.setChanged();
    }
  }
;
  backupChanged=jobEntry.hasChanged();
  backupDate=jobEntry.getIncludeDate();
  FormLayout formLayout=new FormLayout();
  formLayout.marginWidth=Const.FORM_MARGIN;
  formLayout.marginHeight=Const.FORM_MARGIN;
  shell.setLayout(formLayout);
  shell.setText("Job mail details");
  int middle=props.getMiddlePct();
  int margin=Const.MARGIN;
  wName=new LabelText(shell,"Name of mail job entry","Name of mail job entry");
  wName.addModifyListener(lsMod);
  fdName=new FormData();
  fdName.top=new FormAttachment(0,0);
  fdName.left=new FormAttachment(0,0);
  fdName.right=new FormAttachment(100,0);
  wName.setLayoutData(fdName);
  wDestination=new LabelTextVar(shell,"Destination addresses","Destination addresses, separated by a space");
  wDestination.addModifyListener(lsMod);
  fdDestination=new FormData();
  fdDestination.left=new FormAttachment(0,0);
  fdDestination.top=new FormAttachment(wName,margin);
  fdDestination.right=new FormAttachment(100,0);
  wDestination.setLayoutData(fdDestination);
  wServer=new LabelTextVar(shell,"SMTP Server","SMTP Server");
  wServer.addModifyListener(lsMod);
  fdServer=new FormData();
  fdServer.left=new FormAttachment(0,0);
  fdServer.top=new FormAttachment(wDestination,margin);
  fdServer.right=new FormAttachment(100,0);
  wServer.setLayoutData(fdServer);
  wPort=new LabelTextVar(shell,"Port","SMTP or SMTPS Port");
  wPort.addModifyListener(lsMod);
  fdPort=new FormData();
  fdPort.left=new FormAttachment(0,0);
  fdPort.top=new FormAttachment(wServer,margin);
  fdPort.right=new FormAttachment(100,0);
  wPort.setLayoutData(fdPort);
  wlUseAuth=new Label(shell,SWT.RIGHT);
  wlUseAuth.setText("Use authentication?");
  props.setLook(wlUseAuth);
  fdlUseAuth=new FormData();
  fdlUseAuth.left=new FormAttachment(0,0);
  fdlUseAuth.top=new FormAttachment(wPort,margin);
  fdlUseAuth.right=new FormAttachment(middle,-margin);
  wlUseAuth.setLayoutData(fdlUseAuth);
  wUseAuth=new Button(shell,SWT.CHECK);
  props.setLook(wUseAuth);
  fdUseAuth=new FormData();
  fdUseAuth.left=new FormAttachment(middle,margin);
  fdUseAuth.top=new FormAttachment(wPort,margin);
  fdUseAuth.right=new FormAttachment(100,0);
  wUseAuth.setLayoutData(fdUseAuth);
  wUseAuth.addSelectionListener(new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      jobEntry.setChanged();
      setFlags();
    }
  }
);
  wAuthUser=new LabelTextVar(shell,"Authentication user","Authentication user");
  wAuthUser.addModifyListener(lsMod);
  fdAuthUser=new FormData();
  fdAuthUser.left=new FormAttachment(0,0);
  fdAuthUser.top=new FormAttachment(wUseAuth,margin);
  fdAuthUser.right=new FormAttachment(100,0);
  wAuthUser.setLayoutData(fdAuthUser);
  wAuthPass=new LabelTextVar(shell,"Authentication password","Authentication password");
  wAuthPass.setEchoChar('*');
  wAuthPass.addModifyListener(lsMod);
  fdAuthPass=new FormData();
  fdAuthPass.left=new FormAttachment(0,0);
  fdAuthPass.top=new FormAttachment(wAuthUser,margin);
  fdAuthPass.right=new FormAttachment(100,0);
  wAuthPass.setLayoutData(fdAuthPass);
  wlUseSecAuth=new Label(shell,SWT.RIGHT);
  wlUseSecAuth.setText("Use secure authentication?");
  props.setLook(wlUseSecAuth);
  fdlUseSecAuth=new FormData();
  fdlUseSecAuth.left=new FormAttachment(0,0);
  fdlUseSecAuth.top=new FormAttachment(wAuthPass,margin);
  fdlUseSecAuth.right=new FormAttachment(middle,-margin);
  wlUseSecAuth.setLayoutData(fdlUseSecAuth);
  wUseSecAuth=new Button(shell,SWT.CHECK);
  props.setLook(wUseSecAuth);
  fdUseSecAuth=new FormData();
  fdUseSecAuth.left=new FormAttachment(middle,margin);
  fdUseSecAuth.top=new FormAttachment(wAuthPass,margin);
  fdUseSecAuth.right=new FormAttachment(100,0);
  wUseSecAuth.setLayoutData(fdUseSecAuth);
  wUseSecAuth.addSelectionListener(new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      jobEntry.setChanged();
      setFlags();
    }
  }
);
  wReply=new LabelTextVar(shell,"Reply address","Reply address");
  wReply.addModifyListener(lsMod);
  fdReply=new FormData();
  fdReply.left=new FormAttachment(0,0);
  fdReply.top=new FormAttachment(wUseSecAuth,margin);
  fdReply.right=new FormAttachment(100,0);
  wReply.setLayoutData(fdReply);
  wSubject=new LabelTextVar(shell,"Subject","Subject");
  wSubject.addModifyListener(lsMod);
  fdSubject=new FormData();
  fdSubject.left=new FormAttachment(0,0);
  fdSubject.top=new FormAttachment(wReply,margin);
  fdSubject.right=new FormAttachment(100,0);
  wSubject.setLayoutData(fdSubject);
  wlAddDate=new Label(shell,SWT.RIGHT);
  wlAddDate.setText("Include date in message?");
  props.setLook(wlAddDate);
  fdlAddDate=new FormData();
  fdlAddDate.left=new FormAttachment(0,0);
  fdlAddDate.top=new FormAttachment(wSubject,margin);
  fdlAddDate.right=new FormAttachment(middle,-margin);
  wlAddDate.setLayoutData(fdlAddDate);
  wAddDate=new Button(shell,SWT.CHECK);
  props.setLook(wAddDate);
  fdAddDate=new FormData();
  fdAddDate.left=new FormAttachment(middle,margin);
  fdAddDate.top=new FormAttachment(wSubject,margin);
  fdAddDate.right=new FormAttachment(100,0);
  wAddDate.setLayoutData(fdAddDate);
  wAddDate.addSelectionListener(new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      jobEntry.setChanged();
    }
  }
);
  wlIncludeFiles=new Label(shell,SWT.RIGHT);
  wlIncludeFiles.setText("Attach files to message?");
  props.setLook(wlIncludeFiles);
  fdlIncludeFiles=new FormData();
  fdlIncludeFiles.left=new FormAttachment(0,0);
  fdlIncludeFiles.top=new FormAttachment(wAddDate,margin);
  fdlIncludeFiles.right=new FormAttachment(middle,-margin);
  wlIncludeFiles.setLayoutData(fdlIncludeFiles);
  wIncludeFiles=new Button(shell,SWT.CHECK);
  props.setLook(wIncludeFiles);
  fdIncludeFiles=new FormData();
  fdIncludeFiles.left=new FormAttachment(middle,margin);
  fdIncludeFiles.top=new FormAttachment(wAddDate,margin);
  fdIncludeFiles.right=new FormAttachment(100,0);
  wIncludeFiles.setLayoutData(fdIncludeFiles);
  wIncludeFiles.addSelectionListener(new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      jobEntry.setChanged();
      setFlags();
    }
  }
);
  wlTypes=new Label(shell,SWT.RIGHT);
  wlTypes.setText("Select the result file types to attach");
  props.setLook(wlTypes);
  fdlTypes=new FormData();
  fdlTypes.left=new FormAttachment(0,0);
  fdlTypes.top=new FormAttachment(wIncludeFiles,margin);
  fdlTypes.right=new FormAttachment(middle,-margin);
  wlTypes.setLayoutData(fdlTypes);
  wTypes=new List(shell,SWT.MULTI | SWT.BORDER | SWT.V_SCROLL| SWT.H_SCROLL);
  props.setLook(wTypes);
  fdTypes=new FormData();
  fdTypes.left=new FormAttachment(middle,margin);
  fdTypes.top=new FormAttachment(wIncludeFiles,margin);
  fdTypes.bottom=new FormAttachment(wIncludeFiles,margin + 150);
  fdTypes.right=new FormAttachment(100,0);
  wTypes.setLayoutData(fdTypes);
  for (int i=0; i < ResultFile.getAllTypeDesc().length; i++) {
    wTypes.add(ResultFile.getAllTypeDesc()[i]);
  }
  wlZipFiles=new Label(shell,SWT.RIGHT);
  wlZipFiles.setText("Zip files into a single archive?");
  props.setLook(wlZipFiles);
  fdlZipFiles=new FormData();
  fdlZipFiles.left=new FormAttachment(0,0);
  fdlZipFiles.top=new FormAttachment(wTypes,margin);
  fdlZipFiles.right=new FormAttachment(middle,-margin);
  wlZipFiles.setLayoutData(fdlZipFiles);
  wZipFiles=new Button(shell,SWT.CHECK);
  props.setLook(wZipFiles);
  fdZipFiles=new FormData();
  fdZipFiles.left=new FormAttachment(middle,margin);
  fdZipFiles.top=new FormAttachment(wTypes,margin);
  fdZipFiles.right=new FormAttachment(100,0);
  wZipFiles.setLayoutData(fdZipFiles);
  wZipFiles.addSelectionListener(new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      jobEntry.setChanged();
      setFlags();
    }
  }
);
  wZipFilename=new LabelTextVar(shell,"The zip filename","The zip filename");
  wZipFilename.addModifyListener(lsMod);
  fdZipFilename=new FormData();
  fdZipFilename.left=new FormAttachment(0,0);
  fdZipFilename.top=new FormAttachment(wZipFiles,margin);
  fdZipFilename.right=new FormAttachment(100,0);
  wZipFilename.setLayoutData(fdZipFilename);
  wPerson=new LabelTextVar(shell,"Contact person","Contact person");
  wPerson.addModifyListener(lsMod);
  fdPerson=new FormData();
  fdPerson.left=new FormAttachment(0,0);
  fdPerson.top=new FormAttachment(wZipFilename,margin);
  fdPerson.right=new FormAttachment(100,0);
  wPerson.setLayoutData(fdPerson);
  wPhone=new LabelTextVar(shell,"Contact Phone","Contact Phone");
  wPhone.addModifyListener(lsMod);
  fdPhone=new FormData();
  fdPhone.left=new FormAttachment(0,0);
  fdPhone.top=new FormAttachment(wPerson,margin);
  fdPhone.right=new FormAttachment(100,0);
  wPhone.setLayoutData(fdPhone);
  wOK=new Button(shell,SWT.PUSH);
  wOK.setText("  &OK  ");
  wCancel=new Button(shell,SWT.PUSH);
  wCancel.setText("  &Cancel  ");
  BaseStepDialog.positionBottomButtons(shell,new Button[]{wOK,wCancel},margin,null);
  wlOnlyComment=new Label(shell,SWT.RIGHT);
  wlOnlyComment.setText("Only send the comment in the mail body?");
  props.setLook(wlOnlyComment);
  fdlOnlyComment=new FormData();
  fdlOnlyComment.left=new FormAttachment(0,0);
  fdlOnlyComment.bottom=new FormAttachment(wOK,-margin * 2);
  fdlOnlyComment.right=new FormAttachment(middle,-margin);
  wlOnlyComment.setLayoutData(fdlOnlyComment);
  wOnlyComment=new Button(shell,SWT.CHECK);
  props.setLook(wOnlyComment);
  fdOnlyComment=new FormData();
  fdOnlyComment.left=new FormAttachment(middle,margin);
  fdOnlyComment.bottom=new FormAttachment(wOK,-margin * 2);
  fdOnlyComment.right=new FormAttachment(100,0);
  wOnlyComment.setLayoutData(fdOnlyComment);
  wOnlyComment.addSelectionListener(new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent e){
      jobEntry.setChanged();
    }
  }
);
  wlComment=new Label(shell,SWT.RIGHT);
  wlComment.setText("Comment: ");
  props.setLook(wlComment);
  fdlComment=new FormData();
  fdlComment.left=new FormAttachment(0,0);
  fdlComment.top=new FormAttachment(wPhone,margin);
  fdlComment.right=new FormAttachment(middle,margin);
  wlComment.setLayoutData(fdlComment);
  wComment=new Text(shell,SWT.MULTI | SWT.LEFT | SWT.BORDER| SWT.V_SCROLL| SWT.H_SCROLL);
  props.setLook(wComment);
  wComment.addModifyListener(lsMod);
  fdComment=new FormData();
  fdComment.left=new FormAttachment(middle,margin);
  fdComment.top=new FormAttachment(wPhone,margin);
  fdComment.right=new FormAttachment(100,0);
  fdComment.bottom=new FormAttachment(wOnlyComment,-margin);
  wComment.setLayoutData(fdComment);
  SelectionAdapter lsVar=VariableButtonListenerFactory.getSelectionAdapter(shell,wComment);
  wComment.addKeyListener(TextVar.getControlSpaceKeyListener(wComment,lsVar));
  lsCancel=new Listener(){
    public void handleEvent(    Event e){
      cancel();
    }
  }
;
  lsOK=new Listener(){
    public void handleEvent(    Event e){
      ok();
    }
  }
;
  wOK.addListener(SWT.Selection,lsOK);
  wCancel.addListener(SWT.Selection,lsCancel);
  lsDef=new SelectionAdapter(){
    public void widgetDefaultSelected(    SelectionEvent e){
      ok();
    }
  }
;
  wName.addSelectionListener(lsDef);
  wServer.addSelectionListener(lsDef);
  wSubject.addSelectionListener(lsDef);
  wDestination.addSelectionListener(lsDef);
  wReply.addSelectionListener(lsDef);
  wPerson.addSelectionListener(lsDef);
  wPhone.addSelectionListener(lsDef);
  wZipFilename.addSelectionListener(lsDef);
  shell.addShellListener(new ShellAdapter(){
    public void shellClosed(    ShellEvent e){
      cancel();
    }
  }
);
  getData();
  BaseStepDialog.setSize(shell);
  shell.open();
  while (!shell.isDisposed()) {
    if (!display.readAndDispatch())     display.sleep();
  }
  return jobEntry;
}
