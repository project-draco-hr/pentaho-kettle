{
  KettleEnvironment.init();
  String sqlQuery="SELECT Category, COUNT(DISTINCT Country) as \"Number of countries\" " + "FROM Service GROUP BY Category ORDER BY COUNT(DISTINCT Country) DESC";
  SqlTransExecutor executor=new SqlTransExecutor(sqlQuery,getServices());
  final List<RowMetaAndData> rows=new ArrayList<RowMetaAndData>();
  executor.executeQuery(new RowAdapter(){
    @Override public void rowWrittenEvent(    RowMetaInterface rowMeta,    Object[] row) throws KettleStepException {
      rows.add(new RowMetaAndData(rowMeta,row));
    }
  }
);
  executor.waitUntilFinished();
  assertEquals(2,rows.size());
  int rowNr=0;
  assertEquals("A",rows.get(rowNr).getString("Category",null));
  assertEquals(4,rows.get(rowNr).getInteger("Number of countries",-1));
  rowNr++;
  assertEquals("B",rows.get(rowNr).getString("Category",null));
  assertEquals(4,rows.get(rowNr).getInteger("Number of countries",-1));
}
