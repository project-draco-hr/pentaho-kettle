{
  kettleFileFactory.clear();
  FileUpload upload=new FileUpload(kettleFileFactory);
  upload.setHeaderEncoding(request.getCharacterEncoding());
  List fileItems=null;
  try {
    fileItems=upload.parseRequest(new WrappedHttpRequest(request));
  }
 catch (  FileUploadException e) {
    throw new Exception("There was a problem during upload of a kettle file",e);
  }
  if (fileItems == null) {
    throw new Exception("No files arrived at the server");
  }
  if (fileItems.size() > 1) {
    for (int i=0; i < fileItems.size(); i++) {
      FileItem fileItem=(FileItem)fileItems.get(i);
      fileItem.delete();
    }
    throw new Exception("Only one file was expected to arrive at the server, but " + fileItems.size() + " were found.");
  }
  return ((SimpleFileItem)fileItems.get(0)).getFile();
}
