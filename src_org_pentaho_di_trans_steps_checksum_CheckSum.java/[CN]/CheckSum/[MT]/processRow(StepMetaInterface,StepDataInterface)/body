{
  meta=(CheckSumMeta)smi;
  data=(CheckSumData)sdi;
  Object[] r=getRow();
  if (r == null) {
    setOutputDone();
    return false;
  }
  if (first) {
    first=false;
    data.outputRowMeta=getInputRowMeta().clone();
    meta.getFields(data.outputRowMeta,getStepname(),null,null,this);
    if (meta.getFieldName() == null || meta.getFieldName().length > 0) {
      data.fieldnrs=new int[meta.getFieldName().length];
      for (int i=0; i < meta.getFieldName().length; i++) {
        data.fieldnrs[i]=getInputRowMeta().indexOfValue(meta.getFieldName()[i]);
        if (data.fieldnrs[i] < 0) {
          logError(Messages.getString("CheckSum.Log.CanNotFindField",meta.getFieldName()[i]));
          throw new KettleException(Messages.getString("CheckSum.Log.CanNotFindField",meta.getFieldName()[i]));
        }
      }
    }
 else {
      data.fieldnrs=new int[r.length];
      for (int i=0; i < r.length; i++) {
        data.fieldnrs[i]=i;
      }
    }
    data.fieldnr=data.fieldnrs.length;
  }
  boolean sendToErrorRow=false;
  String errorMessage=null;
  Object[] outputRowData=null;
  try {
    if (meta.getCheckSumType().equals(CheckSumMeta.TYPE_ADLER32) || meta.getCheckSumType().equals(CheckSumMeta.TYPE_CRC32)) {
      Long checksum=calculCheckSum(r);
      outputRowData=RowDataUtil.addValueData(r,getInputRowMeta().size(),checksum);
    }
 else {
      String checksumCode=createCheckSum(r);
      outputRowData=RowDataUtil.addValueData(r,getInputRowMeta().size(),checksumCode);
    }
    if (checkFeedback(getLinesRead())) {
      if (log.isDetailed())       logDetailed(Messages.getString("CheckSum.Log.LineNumber","" + getLinesRead()));
    }
    putRow(data.outputRowMeta,outputRowData);
  }
 catch (  Exception e) {
    if (getStepMeta().isDoingErrorHandling()) {
      sendToErrorRow=true;
      errorMessage=e.toString();
    }
 else {
      logError(Messages.getString("CheckSum.ErrorInStepRunning") + e.getMessage());
      setErrors(1);
      stopAll();
      setOutputDone();
      return false;
    }
    if (sendToErrorRow) {
      putError(getInputRowMeta(),r,1,errorMessage,meta.getResultFieldName(),"CheckSum001");
    }
  }
  return true;
}
