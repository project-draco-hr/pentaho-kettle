{
  Row r, value_part, key_part;
  data.firstrow=null;
  if (meta.getLookupFromStep() == null) {
    logError(Messages.getString("StreamLookup.Log.NoLookupStepSpecified"));
    return false;
  }
  if (log.isDetailed())   logDetailed(Messages.getString("StreamLookup.Log.ReadingFromStream") + meta.getLookupFromStep().getName() + "]");
  r=getRowFrom(meta.getLookupFromStep().getName());
  while (r != null) {
    if (log.isRowLevel())     logRowlevel(Messages.getString("StreamLookup.Log.ReadLookupRow") + r.toString());
    key_part=new Row();
    value_part=new Row();
    for (int i=0; i < meta.getKeylookup().length; i++) {
      Value keyValue=r.searchValue(meta.getKeylookup()[i]);
      if (keyValue == null) {
        throw new KettleStepException(Messages.getString("StreamLookup.Exception.UnableToFindField",meta.getKeylookup()[i]));
      }
      key_part.addValue(keyValue);
    }
    if (data.keyTypes == null) {
      data.keyTypes=new Row(key_part);
    }
    for (int v=0; v < meta.getValue().length; v++) {
      Value returnValue=r.searchValue(meta.getValue()[v]);
      if (returnValue == null) {
        throw new KettleStepException(Messages.getString("StreamLookup.Exception.UnableToFindField",meta.getValue()[v]));
      }
      value_part.addValue(returnValue);
    }
    addToCache(key_part,value_part);
    if (data.firstrow == null)     data.firstrow=new Row(value_part);
    r=getRowFrom(meta.getLookupFromStep().getName());
  }
  return true;
}
