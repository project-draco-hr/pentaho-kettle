{
  if (monitor != null)   monitor.beginTask("Exporting the repository to XML...",3);
  root=((null == root) ? getDirectoryTree() : root);
  StringBuffer xml=new StringBuffer(XMLHandler.getXMLHeader());
  xml.append("<repository>" + Const.CR + Const.CR);
  xml.append("<transformations>" + Const.CR);
  xml.append(exportTransformations(monitor,root));
  xml.append("</transformations>" + Const.CR);
  xml.append("<jobs>" + Const.CR);
  xml.append(exportJobs(monitor,root));
  xml.append("</jobs>" + Const.CR);
  xml.append("</repository>" + Const.CR + Const.CR);
  if (monitor != null)   monitor.worked(1);
  if (monitor == null || (monitor != null && !monitor.isCanceled())) {
    if (monitor != null)     monitor.subTask("Saving XML to file [" + xmlFilename + "]");
    try {
      OutputStream os=KettleVFS.getOutputStream(xmlFilename,false);
      os.write(xml.toString().getBytes(Const.XML_ENCODING));
      os.close();
    }
 catch (    IOException e) {
      System.out.println("Couldn't create file [" + xmlFilename + "]");
    }
    if (monitor != null)     monitor.worked(1);
  }
  if (monitor != null)   monitor.done();
}
