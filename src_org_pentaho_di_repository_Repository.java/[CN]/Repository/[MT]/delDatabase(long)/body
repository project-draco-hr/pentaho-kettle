{
  String[] transList=getTransformationsUsingDatabase(id_database);
  if (transList.length == 0) {
    String sql="DELETE FROM " + databaseMeta.getQuotedSchemaTableCombination(null,TABLE_R_DATABASE) + " WHERE "+ quote(FIELD_DATABASE_ID_DATABASE)+ " = "+ id_database;
    database.execStatement(sql);
  }
 else {
    String message="Database used by the following transformations:" + Const.CR;
    for (int i=0; i < transList.length; i++) {
      message+="	" + transList[i] + Const.CR;
    }
    KettleDependencyException e=new KettleDependencyException(message);
    throw new KettleDependencyException("This database is still in use by one or more transformations (" + transList.length + " references)",e);
  }
}
