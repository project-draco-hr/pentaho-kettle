{
  RowMetaAndData lastUpgrade=null;
  try {
    lastUpgrade=database.getOneRow("SELECT " + quote(FIELD_VERSION_MAJOR_VERSION) + ", "+ quote(FIELD_VERSION_MINOR_VERSION)+ ", "+ quote(FIELD_VERSION_UPGRADE_DATE)+ " FROM "+ quote(TABLE_R_VERSION)+ " ORDER BY "+ quote(FIELD_VERSION_UPGRADE_DATE)+ " DESC");
  }
 catch (  Exception e) {
    log.logBasic(toString(),"There was an error getting information from the version table " + quote(TABLE_R_VERSION) + ".");
    log.logBasic(toString(),"This table was introduced in version 2.3.0. so we assume the version is 2.2.2");
    log.logBasic(toString(),"Stack trace: " + Const.getStackTracker(e));
    majorVersion=2;
    minorVersion=2;
    lastUpgrade=null;
  }
  if (lastUpgrade != null) {
    majorVersion=(int)lastUpgrade.getInteger(FIELD_VERSION_MAJOR_VERSION,-1);
    minorVersion=(int)lastUpgrade.getInteger(FIELD_VERSION_MINOR_VERSION,-1);
  }
  if (majorVersion < REQUIRED_MAJOR_VERSION || (majorVersion == REQUIRED_MAJOR_VERSION && minorVersion < REQUIRED_MINOR_VERSION)) {
    throw new KettleException(Const.CR + "The version of the repository is " + getVersion()+ Const.CR+ "This Kettle edition requires it to be at least version "+ getRequiredVersion()+ Const.CR+ "Please upgrade the repository using the repository dialog (edit)"+ Const.CR+ "Also see the Repository Upgrade Guide (in docs/English) for more information.");
  }
}
