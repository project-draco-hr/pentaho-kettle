{
  Row row=r;
  if (fieldName != null && fieldName.length() > 0) {
    int idx=row.searchValueIndex(fieldName);
    if (idx < 0) {
      throw new KettleStepException("Unable to locate [" + fieldName + "] in the input fields");
    }
    Value v=row.getValue(idx);
    row.removeValue(idx);
    for (int i=0; i < targetField.length; i++) {
      Value value=v.Clone();
      value.setName(targetField[i]);
      value.setOrigin(name);
      row.addValue(value);
    }
  }
 else {
    throw new KettleStepException("The field to flatten is not specified");
  }
  return row;
}
