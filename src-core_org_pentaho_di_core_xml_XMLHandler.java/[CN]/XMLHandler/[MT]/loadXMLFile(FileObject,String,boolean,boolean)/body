{
  DocumentBuilderFactory dbf;
  DocumentBuilder db;
  Document doc;
  try {
    dbf=DocumentBuilderFactory.newInstance();
    dbf.setNamespaceAware(namespaceAware);
    db=dbf.newDocumentBuilder();
    if (ignoreEntities)     db.setEntityResolver(new DTDIgnoringEntityResolver());
    InputStream inputStream=null;
    try {
      if (Const.isEmpty(systemID)) {
        inputStream=KettleVFS.getInputStream(fileObject);
        doc=db.parse(inputStream);
      }
 else {
        String systemIDwithEndingSlash=systemID.trim();
        if (!systemIDwithEndingSlash.endsWith("/") && !systemIDwithEndingSlash.endsWith("\\")) {
          systemIDwithEndingSlash=systemIDwithEndingSlash.concat("/");
        }
        inputStream=KettleVFS.getInputStream(fileObject);
        doc=db.parse(inputStream,systemIDwithEndingSlash);
      }
    }
 catch (    FileNotFoundException ef) {
      throw new KettleXMLException(ef);
    }
 finally {
      if (inputStream != null)       inputStream.close();
    }
    return doc;
  }
 catch (  Exception e) {
    throw new KettleXMLException("Error reading information from file",e);
  }
}
