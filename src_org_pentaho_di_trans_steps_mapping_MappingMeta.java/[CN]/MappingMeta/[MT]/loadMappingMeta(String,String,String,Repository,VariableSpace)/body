{
  TransMeta mappingTransMeta=null;
  String realFilename=space.environmentSubstitute(fileName);
  String realTransname=space.environmentSubstitute(transName);
  if (!Const.isEmpty(realFilename)) {
    try {
      mappingTransMeta=new TransMeta(realFilename,false);
      mappingTransMeta.getLogChannel().logDetailed("Loading Mapping from repository","Mapping transformation was loaded from XML file [" + realFilename + "]");
    }
 catch (    Exception e) {
      throw new KettleException(BaseMessages.getString(PKG,"MappingMeta.Exception.UnableToLoadMapping"),e);
    }
  }
 else {
    if (!Const.isEmpty(realTransname) && directoryPath != null && rep != null) {
      RepositoryDirectoryInterface repdir=rep.loadRepositoryDirectoryTree().findDirectory(space.environmentSubstitute(directoryPath));
      if (repdir != null) {
        try {
          mappingTransMeta=rep.loadTransformation(realTransname,repdir,null,true,null);
          mappingTransMeta.getLogChannel().logDetailed("Loading Mapping from repository","Mapping transformation [" + realTransname + "] was loaded from the repository");
        }
 catch (        Exception e) {
          throw new KettleException("Unable to load transformation [" + realTransname + "]",e);
        }
      }
 else {
        throw new KettleException(BaseMessages.getString(PKG,"MappingMeta.Exception.UnableToLoadTransformation",realTransname) + directoryPath);
      }
    }
  }
  return mappingTransMeta;
}
