{
  TransMeta[] transMetas=getLoadedTransformations();
  JobMeta[] jobMetas=getLoadedJobs();
  if ((transMetas == null || transMetas.length == 0) && (jobMetas == null || jobMetas.length == 0))   return;
  KettleVariables kettleVariables=KettleVariables.getInstance();
  Properties sp=new Properties();
  sp.putAll(kettleVariables.getProperties());
  sp.putAll(System.getProperties());
  for (int t=0; t < transMetas.length; t++) {
    TransMeta transMeta=transMetas[t];
    List list=transMeta.getUsedVariables();
    for (int i=0; i < list.size(); i++) {
      String varName=(String)list.get(i);
      String varValue=sp.getProperty(varName,"");
      if (variables.getRowMeta().indexOfValue(varName) < 0 && !varName.startsWith(Const.INTERNAL_VARIABLE_PREFIX)) {
        variables.addValue(new ValueMeta(varName,ValueMetaInterface.TYPE_STRING),varValue);
      }
    }
  }
  for (int t=0; t < jobMetas.length; t++) {
    JobMeta jobMeta=jobMetas[t];
    List list=jobMeta.getUsedVariables();
    for (int i=0; i < list.size(); i++) {
      String varName=(String)list.get(i);
      String varValue=sp.getProperty(varName,"");
      if (variables.getRowMeta().indexOfValue(varName) < 0 && !varName.startsWith(Const.INTERNAL_VARIABLE_PREFIX)) {
        variables.addValue(new ValueMeta(varName,ValueMetaInterface.TYPE_STRING),varValue);
      }
    }
  }
  EnterStringsDialog esd=new EnterStringsDialog(shell,SWT.NONE,variables);
  esd.setTitle(Messages.getString("Spoon.Dialog.SetVariables.Title"));
  esd.setMessage(Messages.getString("Spoon.Dialog.SetVariables.Message"));
  esd.setReadOnly(false);
  if (esd.open() != null) {
    for (int i=0; i < variables.getRowMeta().size(); i++) {
      ValueMetaInterface valueMeta=variables.getRowMeta().getValueMeta(i);
      Object valueData=variables.getData()[i];
      String string;
      try {
        string=valueMeta.getString(valueData);
      }
 catch (      KettleValueException e) {
        string=null;
      }
      if (!Const.isEmpty(string)) {
        kettleVariables.setVariable(valueMeta.getName(),string);
      }
    }
  }
}
