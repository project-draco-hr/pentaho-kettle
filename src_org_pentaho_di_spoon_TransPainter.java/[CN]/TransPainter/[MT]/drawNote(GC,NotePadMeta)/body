{
  int flags=SWT.DRAW_DELIMITER | SWT.DRAW_TAB | SWT.DRAW_TRANSPARENT;
  if (ni.isSelected())   gc.setLineWidth(2);
 else   gc.setLineWidth(1);
  org.eclipse.swt.graphics.Point ext;
  if (Const.isEmpty(ni.getNote())) {
    ext=new org.eclipse.swt.graphics.Point(10,10);
  }
 else {
    ext=gc.textExtent(ni.getNote(),flags);
  }
  Point p=new Point(ext.x,ext.y);
  Point loc=ni.getLocation();
  Point note=real2screen(loc.x,loc.y,offset);
  int margin=Const.NOTE_MARGIN;
  p.x+=2 * margin;
  p.y+=2 * margin;
  int width=ni.width;
  int height=ni.height;
  if (p.x > width)   width=p.x;
  if (p.y > height)   height=p.y;
  int noteshape[]=new int[]{note.x,note.y,note.x + width + 2 * margin,note.y,note.x + width + 2 * margin,note.y + height,note.x + width,note.y + height + 2 * margin,note.x + width,note.y + height,note.x + width + 2 * margin,note.y + height,note.x + width,note.y + height + 2 * margin,note.x,note.y + height + 2 * margin};
  int s=props.getShadowSize();
  int shadow[]=new int[]{note.x + s,note.y + s,note.x + width + 2 * margin + s,note.y + s,note.x + width + 2 * margin + s,note.y + height + s,note.x + width + s,note.y + height + 2 * margin + s,note.x + s,note.y + height + 2 * margin + s};
  gc.setForeground(lightGray);
  gc.setBackground(lightGray);
  gc.fillPolygon(shadow);
  gc.setForeground(darkGray);
  gc.setBackground(yellow);
  gc.fillPolygon(noteshape);
  gc.drawPolygon(noteshape);
  gc.setForeground(black);
  if (!Const.isEmpty(ni.getNote())) {
    gc.drawText(ni.getNote(),note.x + margin,note.y + margin,flags);
  }
  ni.width=width;
  ni.height=height;
  if (ni.isSelected())   gc.setLineWidth(1);
 else   gc.setLineWidth(2);
}
