{
  Shell parent=getParent();
  Display display=parent.getDisplay();
  shell=new Shell(parent,SWT.DIALOG_TRIM | SWT.RESIZE | SWT.MAX| SWT.MIN);
  props.setLook(shell);
  shell.setImage(GUIResource.getInstance().getImageSpoon());
  FormLayout formLayout=new FormLayout();
  formLayout.marginWidth=Const.FORM_MARGIN;
  formLayout.marginHeight=Const.FORM_MARGIN;
  shell.setLayout(formLayout);
  shell.setText("PDI Marketplace");
  shell.setImage(GUIResource.getInstance().getImageLogoSmall());
  margin=Const.MARGIN;
  middle=props.getMiddlePct();
  if (!readMarketsFile())   return;
  if (!readMarketEntries())   return;
  wlMarketplaces=new Label(shell,SWT.NONE);
  wlMarketplaces.setText("Detected plugins");
  props.setLook(wlMarketplaces);
  FormData fdlMarketplaces=new FormData();
  fdlMarketplaces.left=new FormAttachment(0,0);
  fdlMarketplaces.top=new FormAttachment(0,margin);
  wlMarketplaces.setLayoutData(fdlMarketplaces);
  bar=new ExpandBar(shell,SWT.V_SCROLL | SWT.H_SCROLL);
  FormData fdBar=new FormData();
  fdBar.left=new FormAttachment(0,0);
  fdBar.top=new FormAttachment(wlMarketplaces,margin);
  fdBar.right=new FormAttachment(100,0);
  fdBar.bottom=new FormAttachment(100,-50);
  bar.setLayoutData(fdBar);
  for (  final MarketEntry marketEntry : marketEntries) {
    Composite composite=new Composite(bar,SWT.NONE);
    FormLayout layout=new FormLayout();
    layout.marginHeight=margin;
    layout.marginWidth=margin;
    composite.setLayout(layout);
    props.setLook(composite);
    Control lastControl=null;
    addLeftLabel(composite,"ID:",lastControl);
    lastControl=addRightLabel(composite,Const.NVL(marketEntry.getId(),""),lastControl);
    addLeftLabel(composite,"Name:",lastControl);
    lastControl=addRightLabel(composite,Const.NVL(marketEntry.getName(),""),lastControl);
    if (!Const.isEmpty(marketEntry.getDescription())) {
      addLeftLabel(composite,"Description:",lastControl);
      lastControl=addRightLabel(composite,marketEntry.getDescription(),lastControl);
    }
    addLeftLabel(composite,"Package URL:",lastControl);
    lastControl=addRightURL(composite,marketEntry.getPackageUrl(),lastControl);
    if (!Const.isEmpty(marketEntry.getDocumentationUrl())) {
      addLeftLabel(composite,"Documentation:",lastControl);
      lastControl=addRightURL(composite,marketEntry.getDocumentationUrl(),lastControl);
    }
    if (!Const.isEmpty(marketEntry.getCasesUrl())) {
      addLeftLabel(composite,"Case tracking:",lastControl);
      lastControl=addRightURL(composite,marketEntry.getCasesUrl(),lastControl);
    }
    if (!Const.isEmpty(marketEntry.getSourceUrl())) {
      addLeftLabel(composite,"Source code:",lastControl);
      lastControl=addRightURL(composite,marketEntry.getSourceUrl(),lastControl);
    }
    if (!Const.isEmpty(marketEntry.getLicenseName())) {
      addLeftLabel(composite,"License:",lastControl);
      lastControl=addRightLabel(composite,Const.NVL(marketEntry.getLicenseName(),""),lastControl);
    }
    if (!Const.isEmpty(marketEntry.getLicenseText())) {
      addLeftLabel(composite,"License details:",lastControl);
      lastControl=addRightLabel(composite,Const.NVL(marketEntry.getLicenseText(),""),lastControl);
    }
    addLeftLabel(composite,"Support level:",lastControl);
    lastControl=addRightLabel(composite,marketEntry.getSupportLevel().getDescription(),lastControl);
    if (!Const.isEmpty(marketEntry.getSupportMessage())) {
      addLeftLabel(composite,"Support message:",lastControl);
      lastControl=addRightLabel(composite,marketEntry.getSupportMessage(),lastControl);
    }
    if (!Const.isEmpty(marketEntry.getSupportUrl())) {
      addLeftLabel(composite,"Support URL:",lastControl);
      lastControl=addRightURL(composite,marketEntry.getSupportUrl(),lastControl);
    }
    Button button=new Button(composite,SWT.PUSH);
    button.setText("  Install this plugin  ");
    FormData fdButton=new FormData();
    fdButton.top=new FormAttachment(lastControl,4 * margin);
    fdButton.left=new FormAttachment(middle,margin);
    button.setLayoutData(fdButton);
    button.addSelectionListener(new SelectionAdapter(){
      public void widgetSelected(      SelectionEvent e){
        installPlugin(marketEntry);
      }
    }
);
    Label wlName=new Label(composite,SWT.LEFT);
    props.setLook(wlName);
    wlName.setText("Name:");
    FormData fdlName=new FormData();
    fdlName.top=new FormAttachment(0,0);
    fdlName.left=new FormAttachment(0,0);
    fdlName.right=new FormAttachment(middle,0);
    wlName.setLayoutData(fdlName);
    ExpandItem expandItem=new ExpandItem(bar,SWT.NONE,0);
    expandItem.setText(marketEntry.getName());
    expandItem.setHeight(composite.computeSize(SWT.DEFAULT,SWT.DEFAULT).y);
    expandItem.setControl(composite);
    Image image;
switch (marketEntry.getType()) {
case Step:
      image=GUIResource.getInstance().getImageTransGraph();
    break;
case JobEntry:
  image=GUIResource.getInstance().getImageTransGraph();
break;
case SpoonPlugin:
image=GUIResource.getInstance().getImageTransGraph();
break;
case Database:
image=GUIResource.getInstance().getImageConnection();
break;
default :
image=GUIResource.getInstance().getImageSpoon();
break;
}
expandItem.setImage(image);
}
wClose=new Button(shell,SWT.PUSH);
wClose.setText(BaseMessages.getString(PKG,"System.Button.Close"));
wClose.addSelectionListener(new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
dispose();
}
}
);
BaseStepDialog.positionBottomButtons(shell,new Button[]{wClose},margin,null);
shell.addShellListener(new ShellAdapter(){
public void shellClosed(ShellEvent e){
dispose();
}
}
);
BaseStepDialog.setSize(shell);
shell.open();
while (!shell.isDisposed()) {
if (!display.readAndDispatch()) display.sleep();
}
}
