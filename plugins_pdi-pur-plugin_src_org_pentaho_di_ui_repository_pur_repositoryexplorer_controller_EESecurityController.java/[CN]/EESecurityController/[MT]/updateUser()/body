{
  if (service != null) {
    try {
      UIEERepositoryUser uiUser=(UIEERepositoryUser)eeSecurity.getSelectedUser();
      Set<IUIRole> previousRoleList=new HashSet<IUIRole>();
      previousRoleList.addAll(uiUser.getRoles());
      uiUser.setDescription(eeSecurityUser.getDescription());
      uiUser.setPassword(eeSecurityUser.getPassword());
      uiUser.setRoles(new HashSet<IUIRole>(eeSecurityUser.getAssignedRoles()));
      service.updateUser(uiUser.getUserInfo());
      eeSecurity.updateUser(uiUser,previousRoleList);
      userDialog.hide();
    }
 catch (    Throwable th) {
      if (mainController == null || !mainController.handleLostRepository(th)) {
        messageBox.setTitle(BaseMessages.getString(PKG,"Dialog.Error"));
        messageBox.setAcceptLabel(BaseMessages.getString(PKG,"Dialog.Ok"));
        messageBox.setMessage(BaseMessages.getString(PKG,"UpdateUser.UnableToUpdateUser",th.getLocalizedMessage()));
        messageBox.open();
      }
    }
  }
}
