{
  if (isJettyMode() && !request.getContextPath().startsWith(CONTEXT_PATH))   return;
  if (log.isDebug())   logDebug(BaseMessages.getString(PKG,"PrepareExecutionTransServlet.TransPrepareExecutionRequested"));
  String transName=request.getParameter("name");
  boolean useXML="Y".equalsIgnoreCase(request.getParameter("xml"));
  response.setStatus(HttpServletResponse.SC_OK);
  PrintWriter out=response.getWriter();
  if (useXML) {
    response.setContentType("text/xml");
    out.print(XMLHandler.getXMLHeader(Const.XML_ENCODING));
  }
 else {
    response.setContentType("text/html");
    out.println("<HTML>");
    out.println("<HEAD>");
    out.println("<TITLE>" + BaseMessages.getString(PKG,"PrepareExecutionTransServlet.TransPrepareExecution") + "</TITLE>");
    out.println("<META http-equiv=\"Refresh\" content=\"2;url=" + convertContextPath(GetTransStatusServlet.CONTEXT_PATH) + "?name="+ URLEncoder.encode(transName,"UTF-8")+ "\">");
    out.println("</HEAD>");
    out.println("<BODY>");
  }
  try {
    Trans trans=getTransformationMap().getTransformation(transName);
    TransConfiguration transConfiguration=getTransformationMap().getConfiguration(transName);
    if (trans != null && transConfiguration != null) {
      TransExecutionConfiguration executionConfiguration=transConfiguration.getTransExecutionConfiguration();
      trans.getTransMeta().setArguments(executionConfiguration.getArgumentStrings());
      trans.setReplayDate(executionConfiguration.getReplayDate());
      trans.setSafeModeEnabled(executionConfiguration.isSafeModeEnabled());
      trans.injectVariables(executionConfiguration.getVariables());
      try {
        trans.prepareExecution(null);
        if (useXML) {
          out.println(WebResult.OK.getXML());
        }
 else {
          out.println("<H1>" + BaseMessages.getString(PKG,"PrepareExecutionTransServlet.TransPrepared",transName) + "</H1>");
          out.println("<a href=\"" + convertContextPath(GetTransStatusServlet.CONTEXT_PATH) + "?name="+ URLEncoder.encode(transName,"UTF-8")+ "\">"+ BaseMessages.getString(PKG,"TransStatusServlet.BackToTransStatusPage")+ "</a><p>");
        }
      }
 catch (      Exception e) {
        String logText=CentralLogStore.getAppender().getBuffer(trans.getLogChannel().getLogChannelId(),true).toString();
        if (useXML) {
          out.println(new WebResult(WebResult.STRING_ERROR,BaseMessages.getString(PKG,"PrepareExecutionTransServlet.Error.TransInitFailed",Const.CR + logText + Const.CR+ e.getLocalizedMessage())));
        }
 else {
          out.println("<H1>" + BaseMessages.getString(PKG,"PrepareExecutionTransServlet.Log.TransNotInit",transName) + "</H1>");
          out.println("<pre>");
          out.println(logText);
          out.println(e.getLocalizedMessage());
          out.println("</pre>");
          out.println("<a href=\"" + convertContextPath(GetTransStatusServlet.CONTEXT_PATH) + "?name="+ URLEncoder.encode(transName,"UTF-8")+ "\">"+ BaseMessages.getString(PKG,"TransStatusServlet.BackToTransStatusPage")+ "</a><p>");
        }
      }
    }
 else {
      if (useXML) {
        out.println(new WebResult(WebResult.STRING_ERROR,BaseMessages.getString(PKG,"TransStatusServlet.Log.CoundNotFindSpecTrans",transName)));
      }
 else {
        out.println("<H1>" + BaseMessages.getString(PKG,"TransStatusServlet.Log.CoundNotFindTrans",transName) + "</H1>");
        out.println("<a href=\"" + convertContextPath(GetStatusServlet.CONTEXT_PATH) + "\">"+ BaseMessages.getString(PKG,"TransStatusServlet.BackToStatusPage")+ "</a><p>");
      }
    }
  }
 catch (  Exception ex) {
    if (useXML) {
      out.println(new WebResult(WebResult.STRING_ERROR,BaseMessages.getString(PKG,"PrepareExecutionTransServlet.Error.UnexpectedError",Const.CR + Const.getStackTracker(ex))));
    }
 else {
      out.println("<p>");
      out.println("<pre>");
      ex.printStackTrace(out);
      out.println("</pre>");
    }
  }
  if (!useXML) {
    out.println("<p>");
    out.println("</BODY>");
    out.println("</HTML>");
  }
}
