{
  TreeItem treeItem=(TreeItem)e.item;
  final String treeItemText=treeItem.getText();
  Tree rootItem=treeItem.getParent();
  log.logDebug(toString(),Messages.getString("Spoon.Log.ClickedOn") + treeItem.getText());
  TreeItem sel[]=rootItem.getSelection();
  Menu mCSH=new Menu(shell,SWT.POP_UP);
  TreeItem parent=treeItem.getParentItem();
  if (parent == null) {
    if (!treeItemText.equalsIgnoreCase(STRING_BASE) && !treeItemText.equalsIgnoreCase(STRING_PLUGIN) && !treeItemText.equalsIgnoreCase(STRING_PARTITIONS)&& !treeItemText.equalsIgnoreCase(STRING_CLUSTERS)) {
      MenuItem miNew=new MenuItem(mCSH,SWT.PUSH);
      miNew.setText(Messages.getString("Spoon.Menu.Popup.BASE.New"));
      miNew.addListener(SWT.Selection,lsNew);
    }
    if (treeItemText.equalsIgnoreCase(STRING_STEPS)) {
      MenuItem miNew=new MenuItem(mCSH,SWT.PUSH);
      miNew.setText(Messages.getString("Spoon.Menu.Popup.STEPS.SortSteps"));
      miNew.addSelectionListener(new SelectionAdapter(){
        public void widgetSelected(        SelectionEvent e){
          transMeta.sortSteps();
          refreshTree(true);
        }
      }
);
    }
    if (treeItemText.equalsIgnoreCase(STRING_HOPS)) {
      MenuItem miNew=new MenuItem(mCSH,SWT.PUSH);
      miNew.setText(Messages.getString("Spoon.Menu.Popup.HOPS.SortHops"));
      miNew.addSelectionListener(new SelectionAdapter(){
        public void widgetSelected(        SelectionEvent e){
          transMeta.sortHops();
          refreshTree(true);
        }
      }
);
    }
    if (treeItemText.equalsIgnoreCase(STRING_CONNECTIONS)) {
      MenuItem miNew=new MenuItem(mCSH,SWT.PUSH);
      miNew.setText(Messages.getString("Spoon.Menu.Popup.CONNECTIONS.NewConnectionWizard"));
      miNew.addSelectionListener(new SelectionAdapter(){
        public void widgetSelected(        SelectionEvent arg0){
          createDatabaseWizard();
        }
      }
);
      MenuItem miCache=new MenuItem(mCSH,SWT.PUSH);
      miCache.setText(Messages.getString("Spoon.Menu.Popup.CONNECTIONS.ClearDBCacheComplete"));
      miCache.addListener(SWT.Selection,lsCache);
    }
    if (treeItemText.equalsIgnoreCase(STRING_PARTITIONS)) {
      MenuItem miNew=new MenuItem(mCSH,SWT.PUSH);
      miNew.setText(Messages.getString("Spoon.Menu.Popup.PARTITIONS.New"));
      miNew.addSelectionListener(new SelectionAdapter(){
        public void widgetSelected(        SelectionEvent arg0){
          newDatabasePartitioningSchema();
        }
      }
);
    }
    if (treeItemText.equalsIgnoreCase(STRING_CLUSTERS)) {
      MenuItem miNew=new MenuItem(mCSH,SWT.PUSH);
      miNew.setText(Messages.getString("Spoon.Menu.Popup.CLUSTERS.New"));
      miNew.addSelectionListener(new SelectionAdapter(){
        public void widgetSelected(        SelectionEvent e){
          newClusteringSchema();
        }
      }
);
    }
  }
 else {
    final String strparent=parent.getText();
    if (strparent.equalsIgnoreCase(STRING_CONNECTIONS)) {
      MenuItem miNew=new MenuItem(mCSH,SWT.PUSH);
      miNew.setText(Messages.getString("Spoon.Menu.Popup.CONNECTIONS.New"));
      MenuItem miEdit=new MenuItem(mCSH,SWT.PUSH);
      miEdit.setText(Messages.getString("Spoon.Menu.Popup.CONNECTIONS.Edit"));
      MenuItem miDupe=new MenuItem(mCSH,SWT.PUSH);
      miDupe.setText(Messages.getString("Spoon.Menu.Popup.CONNECTIONS.Duplicate"));
      MenuItem miCopy=new MenuItem(mCSH,SWT.PUSH);
      miCopy.setText(Messages.getString("Spoon.Menu.Popup.CONNECTIONS.CopyToClipboard"));
      MenuItem miDel=new MenuItem(mCSH,SWT.PUSH);
      miDel.setText(Messages.getString("Spoon.Menu.Popup.CONNECTIONS.Delete"));
      new MenuItem(mCSH,SWT.SEPARATOR);
      MenuItem miSQL=new MenuItem(mCSH,SWT.PUSH);
      miSQL.setText(Messages.getString("Spoon.Menu.Popup.CONNECTIONS.SQLEditor"));
      MenuItem miCache=new MenuItem(mCSH,SWT.PUSH);
      miCache.setText(Messages.getString("Spoon.Menu.Popup.CONNECTIONS.ClearDBCache") + treeItem.getText());
      new MenuItem(mCSH,SWT.SEPARATOR);
      MenuItem miShare=new MenuItem(mCSH,SWT.PUSH);
      miShare.setText(Messages.getString("Spoon.Menu.Popup.CONNECTIONS.Share"));
      new MenuItem(mCSH,SWT.SEPARATOR);
      MenuItem miExpl=new MenuItem(mCSH,SWT.PUSH);
      miExpl.setText(Messages.getString("Spoon.Menu.Popup.CONNECTIONS.Explore"));
      DatabaseMeta dbMeta=transMeta.findDatabase(treeItemText);
      if (dbMeta == null || dbMeta.getDatabaseType() == DatabaseMeta.TYPE_DATABASE_SAPR3)       miExpl.setEnabled(false);
      miNew.addListener(SWT.Selection,lsNew);
      miEdit.addListener(SWT.Selection,lsEdit);
      miDupe.addListener(SWT.Selection,lsDupe);
      miCopy.addListener(SWT.Selection,lsCopy);
      miDel.addListener(SWT.Selection,lsDel);
      miSQL.addListener(SWT.Selection,lsSQL);
      miCache.addListener(SWT.Selection,lsCache);
      miShare.addListener(SWT.Selection,lsShare);
      miExpl.addListener(SWT.Selection,lsExpl);
    }
    if (strparent.equalsIgnoreCase(STRING_STEPS)) {
      if (sel.length == 2) {
        MenuItem miNewHop=new MenuItem(mCSH,SWT.PUSH);
        miNewHop.setText(Messages.getString("Spoon.Menu.Popup.STEPS.NewHop"));
        miNewHop.addListener(SWT.Selection,lsNew);
      }
      MenuItem miEdit=new MenuItem(mCSH,SWT.PUSH);
      miEdit.setText(Messages.getString("Spoon.Menu.Popup.STEPS.Edit"));
      MenuItem miDupe=new MenuItem(mCSH,SWT.PUSH);
      miDupe.setText(Messages.getString("Spoon.Menu.Popup.STEPS.Duplicate"));
      MenuItem miDel=new MenuItem(mCSH,SWT.PUSH);
      miDel.setText(Messages.getString("Spoon.Menu.Popup.STEPS.Delete"));
      MenuItem miShare=new MenuItem(mCSH,SWT.PUSH);
      miShare.setText(Messages.getString("Spoon.Menu.Popup.STEPS.Share"));
      miShare.addListener(SWT.Selection,lsShare);
      miEdit.addListener(SWT.Selection,lsEdit);
      miDupe.addListener(SWT.Selection,lsDupe);
      miDel.addListener(SWT.Selection,lsDel);
    }
    if (strparent.equalsIgnoreCase(STRING_HOPS)) {
      MenuItem miEdit=new MenuItem(mCSH,SWT.PUSH);
      miEdit.setText(Messages.getString("Spoon.Menu.Popup.HOPS.Edit"));
      MenuItem miDel=new MenuItem(mCSH,SWT.PUSH);
      miDel.setText(Messages.getString("Spoon.Menu.Popup.HOPS.Delete"));
      miEdit.addListener(SWT.Selection,lsEdit);
      miDel.addListener(SWT.Selection,lsDel);
    }
    if (strparent.equalsIgnoreCase(STRING_PARTITIONS)) {
      MenuItem miEdit=new MenuItem(mCSH,SWT.PUSH);
      miEdit.setText(Messages.getString("Spoon.Menu.Popup.PARTITIONS.Edit"));
      MenuItem miDel=new MenuItem(mCSH,SWT.PUSH);
      miDel.setText(Messages.getString("Spoon.Menu.Popup.PARTITIONS.Delete"));
      MenuItem miShare=new MenuItem(mCSH,SWT.PUSH);
      miShare.setText(Messages.getString("Spoon.Menu.Popup.PARTITIONS.Share"));
      miShare.addListener(SWT.Selection,lsShare);
      miEdit.addListener(SWT.Selection,lsEdit);
      miDel.addListener(SWT.Selection,lsDel);
    }
    if (strparent.equalsIgnoreCase(STRING_CLUSTERS)) {
      MenuItem miEdit=new MenuItem(mCSH,SWT.PUSH);
      miEdit.setText(Messages.getString("Spoon.Menu.Popup.CLUSTERS.Edit"));
      miEdit.addListener(SWT.Selection,lsEdit);
      MenuItem miDel=new MenuItem(mCSH,SWT.PUSH);
      miDel.setText(Messages.getString("Spoon.Menu.Popup.CLUSTERS.Delete"));
      miDel.addListener(SWT.Selection,lsDel);
      MenuItem miShare=new MenuItem(mCSH,SWT.PUSH);
      miShare.setText(Messages.getString("Spoon.Menu.Popup.CLUSTERS.Share"));
      miShare.addListener(SWT.Selection,lsShare);
      MenuItem miMonitor=new MenuItem(mCSH,SWT.PUSH);
      miMonitor.setText(Messages.getString("Spoon.Menu.Popup.CLUSTERS.Monitor"));
      miMonitor.addListener(SWT.Selection,new Listener(){
        public void handleEvent(        Event e){
          monitorClusterSchema(treeItemText);
        }
      }
);
    }
    TreeItem grandparent=parent.getParentItem();
    if (grandparent != null) {
      String strgrandparent=grandparent.getText();
      if (strgrandparent.equalsIgnoreCase(STRING_BASE) || strgrandparent.equalsIgnoreCase(STRING_PLUGIN)) {
        MenuItem miNew=new MenuItem(mCSH,SWT.PUSH);
        miNew.setText(Messages.getString("Spoon.Menu.Popup.BASE_PLUGIN.New"));
        miNew.addListener(SWT.Selection,lsNew);
      }
      if (strgrandparent.equalsIgnoreCase(STRING_CLUSTERS)) {
        MenuItem miEdit=new MenuItem(mCSH,SWT.PUSH);
        miEdit.setText(Messages.getString("Spoon.Menu.Popup.SLAVE_SERVER.Edit"));
        miEdit.addListener(SWT.Selection,new Listener(){
          public void handleEvent(          Event e){
            editSlaveServer(strparent,treeItemText);
          }
        }
);
        MenuItem miMonitor=new MenuItem(mCSH,SWT.PUSH);
        miMonitor.setText(Messages.getString("Spoon.Menu.Popup.SLAVE_SERVER.Monitor"));
        miMonitor.addListener(SWT.Selection,new Listener(){
          public void handleEvent(          Event e){
            monitorSlaveServer(strparent,treeItemText);
          }
        }
);
      }
    }
  }
  selectionTree.setMenu(mCSH);
}
