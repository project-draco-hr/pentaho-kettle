{
  boolean saved=false;
  String xml=XMLHandler.getXMLHeader() + jobMeta.getXML();
  try {
    DataOutputStream dos=new DataOutputStream(KettleVFS.getOutputStream(fname,false));
    dos.write(xml.getBytes(Const.XML_ENCODING));
    dos.close();
    saved=true;
    props.addLastFile(LastUsedFile.FILE_TYPE_JOB,fname,RepositoryDirectory.DIRECTORY_SEPARATOR,false,"");
    saveSettings();
    addMenuLast();
    log.logDebug(toString(),"File written to [" + fname + "]");
    jobMeta.setFilename(fname);
    jobMeta.clearChanged();
    setShellText();
  }
 catch (  Exception e) {
    log.logDebug(toString(),"Error opening file for writing! --> " + e.toString());
    MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
    mb.setMessage(Messages.getString("Spoon.Dialog.ErrorSavingFile.Message") + Const.CR + e.toString());
    mb.setText(Messages.getString("Spoon.Dialog.ErrorSavingFile.Title"));
    mb.open();
  }
  return saved;
}
