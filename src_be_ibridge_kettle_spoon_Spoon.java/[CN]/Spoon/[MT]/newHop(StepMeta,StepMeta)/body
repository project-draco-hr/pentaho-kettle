{
  TransHopMeta hi=new TransHopMeta(fr,to);
  TransHopDialog hd=new TransHopDialog(shell,SWT.NONE,hi,transMeta);
  if (hd.open() != null) {
    boolean error=false;
    if (transMeta.findTransHop(hi.getFromStep(),hi.getToStep()) != null) {
      MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
      mb.setMessage("This hop already exists!");
      mb.setText("Error!");
      mb.open();
      error=true;
    }
    if (transMeta.hasLoop(fr) || transMeta.hasLoop(to)) {
      refreshTree();
      refreshGraph();
      MessageBox mb=new MessageBox(shell,SWT.YES | SWT.ICON_WARNING);
      mb.setMessage("Adding this hop causes a loop in the transformation.  Loops are not allowed!");
      mb.setText("Warning!");
      mb.open();
      error=true;
    }
    if (!error) {
      transMeta.addTransHop(hi);
      addUndoNew(new TransHopMeta[]{(TransHopMeta)hi.clone()},new int[]{transMeta.indexOfTransHop(hi)});
      hi.getFromStep().drawStep();
      hi.getToStep().drawStep();
      refreshTree();
      refreshGraph();
    }
  }
}
