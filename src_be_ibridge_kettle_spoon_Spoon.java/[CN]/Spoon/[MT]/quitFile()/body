{
  boolean exit=true;
  boolean showWarning=true;
  log.logDetailed(toString(),Messages.getString("Log.QuitApplication"));
  saveSettings();
  if (transMeta.hasChanged()) {
    MessageBox mb=new MessageBox(shell,SWT.YES | SWT.NO | SWT.CANCEL| SWT.ICON_WARNING);
    mb.setMessage(Messages.getString("Message.MessageBox.SaveChangedFile"));
    mb.setText(Messages.getString("Message.MessageBox.Warning"));
    int answer=mb.open();
switch (answer) {
case SWT.YES:
      saveFile();
    exit=true;
  showWarning=false;
break;
case SWT.NO:
exit=true;
showWarning=false;
break;
case SWT.CANCEL:
exit=false;
showWarning=false;
break;
}
}
if ((exit && spoonlog.isRunning()) || (exit && showWarning && props.showExitWarning())) {
String message=Messages.getString("Message.Warning.PromptExit");
if (spoonlog.isRunning()) message=Messages.getString("Message.Warning.PromptExitWhenRunTransformation");
MessageDialogWithToggle md=new MessageDialogWithToggle(shell,Messages.getString("Message.Warning.Warning"),null,message,MessageDialog.WARNING,new String[]{Messages.getString("Message.Warning.Yes"),Messages.getString("Message.Warning.No")},1,Messages.getString("Message.Warning.NotShowWarning"),!props.showExitWarning());
int idx=md.open();
props.setExitWarningShown(!md.getToggleState());
props.saveProps();
if (idx == 1) exit=false;
 else exit=true;
}
if (exit) dispose();
return exit;
}
