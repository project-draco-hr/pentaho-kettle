{
  ArrayList args=new ArrayList();
  for (int i=0; i < a.length; i++)   args.add(a[i]);
  Display display=new Display();
  Splash splash=new Splash(display);
  String repname=Const.getCommandlineOption(args,Messages.getString("Spoon.CommandlineOption.Repname"));
  String username=Const.getCommandlineOption(args,Messages.getString("Spoon.CommandlineOption.Username"));
  String password=Const.getCommandlineOption(args,Messages.getString("Spoon.CommandlineOption.Password"));
  String transname=Const.getCommandlineOption(args,Messages.getString("Spoon.CommandlineOption.Transname"));
  String filename=Const.getCommandlineOption(args,Messages.getString("Spoon.CommandlineOption.Filename"));
  String dirname=Const.getCommandlineOption(args,Messages.getString("Spoon.CommandlineOption.Dirname"));
  String logfile=Const.getCommandlineOption(args,Messages.getString("Spoon.CommandlineOption.Logfile"));
  String loglevel=Const.getCommandlineOption(args,Messages.getString("Spoon.CommandlineOption.Loglevel"));
  String kettleRepname=Const.getEnvironmentVariable("KETTLE_REPOSITORY",null);
  String kettleUsername=Const.getEnvironmentVariable("KETTLE_USER",null);
  String kettlePassword=Const.getEnvironmentVariable("KETTLE_PASSWORD",null);
  if (kettleRepname != null && kettleRepname.length() > 0)   repname=kettleRepname;
  if (kettleUsername != null && kettleUsername.length() > 0)   username=kettleUsername;
  if (kettlePassword != null && kettlePassword.length() > 0)   password=kettlePassword;
  String version=Const.JAVA_VERSION;
  if ("1.4".compareToIgnoreCase(version) > 0) {
    System.out.println("The System is running on Java version " + version);
    System.out.println("Unfortunately, it needs version 1.4 or higher to run.");
    return;
  }
  Locale.setDefault(Const.DEFAULT_LOCALE);
  LogWriter log;
  if (logfile == null) {
    log=LogWriter.getInstance(Const.SPOON_LOG_FILE,false,LogWriter.LOG_LEVEL_BASIC);
  }
 else {
    log=LogWriter.getInstance(logfile,true,LogWriter.LOG_LEVEL_BASIC);
  }
  if (log.getRealFilename() != null)   log.logBasic(APP_NAME,Messages.getString("Spoon.Log.LoggingToFile") + log.getRealFilename());
  if (loglevel != null) {
    log.setLogLevel(loglevel);
    log.logBasic(APP_NAME,Messages.getString("Spoon.Log.LoggingAtLevel") + log.getLogLevelDesc());
  }
  StepLoader stloader=StepLoader.getInstance();
  if (!stloader.read()) {
    log.logError(APP_NAME,Messages.getString("Spoon.Log.ErrorLoadingAndHaltSystem"));
    return;
  }
  final Spoon win=new Spoon(log,display,null);
  win.setDestroy(true);
  win.setArguments((String[])args.toArray(new String[args.size()]));
  log.logBasic(APP_NAME,Messages.getString("Spoon.Log.MainWindowCreated"));
  RepositoryMeta repinfo=null;
  UserInfo userinfo=null;
  if (repname == null && filename == null && win.props.showRepositoriesDialogAtStartup()) {
    log.logBasic(APP_NAME,Messages.getString("Spoon.Log.AskingForRepository"));
    int perms[]=new int[]{PermissionMeta.TYPE_PERMISSION_TRANSFORMATION};
    splash.hide();
    RepositoriesDialog rd=new RepositoriesDialog(win.disp,SWT.NONE,perms,Messages.getString("Spoon.Application.Name"));
    if (rd.open()) {
      repinfo=rd.getRepository();
      userinfo=rd.getUser();
      if (!userinfo.useTransformations()) {
        MessageBox mb=new MessageBox(win.shell,SWT.OK | SWT.ICON_ERROR);
        mb.setMessage(Messages.getString("Spoon.Dialog.RepositoryUserCannotWork.Message"));
        mb.setText(Messages.getString("Spoon.Dialog.RepositoryUserCannotWork.Title"));
        mb.open();
        userinfo=null;
        repinfo=null;
      }
    }
 else {
      if (rd.isCancelled()) {
        splash.dispose();
        win.quitFile();
        return;
      }
    }
  }
  try {
    if (repname != null || filename != null) {
      if (repname != null) {
        RepositoriesMeta repsinfo=new RepositoriesMeta(log);
        if (repsinfo.readData()) {
          repinfo=repsinfo.findRepository(repname);
          if (repinfo != null) {
            win.rep=new Repository(log,repinfo,userinfo);
            if (win.rep.connect(Messages.getString("Spoon.Application.Name"))) {
              if (dirname == null)               dirname=RepositoryDirectory.DIRECTORY_SEPARATOR;
              win.rep.userinfo=new UserInfo(win.rep,username,password);
              if (win.rep.userinfo.getID() > 0) {
                RepositoryDirectory repdir=win.rep.getDirectoryTree().findDirectory(dirname);
                if (repdir != null) {
                  win.transMeta=new TransMeta(win.rep,transname,repdir);
                  win.setFilename(repname);
                  win.transMeta.clearChanged();
                }
 else {
                  log.logError(APP_NAME,Messages.getString("Spoon.Log.UnableFindDirectory",dirname));
                }
              }
 else {
                log.logError(APP_NAME,Messages.getString("Spoon.Log.UnableVerifyUser"));
                win.rep.disconnect();
                win.rep=null;
              }
            }
 else {
              log.logError(APP_NAME,Messages.getString("Spoon.Log.UnableConnectToRepository"));
            }
          }
 else {
            log.logError(APP_NAME,Messages.getString("Spoon.Log.NoRepositoryRrovided"));
          }
        }
 else {
          log.logError(APP_NAME,Messages.getString("Spoon.Log.NoRepositoriesDefined"));
        }
      }
 else       if (filename != null) {
        win.transMeta=new TransMeta(filename);
        win.setFilename(filename);
        win.transMeta.clearChanged();
      }
    }
 else {
      if (repinfo != null && userinfo != null) {
        win.rep=new Repository(log,repinfo,userinfo);
        if (!win.rep.connect(Messages.getString("Spoon.Application.Name"))) {
          win.rep=null;
        }
      }
      if (win.props.openLastFile()) {
        log.logDetailed(APP_NAME,Messages.getString("Spoon.Log.TryingOpenLastUsedFile"));
        String lastfiles[]=win.props.getLastFiles();
        String lastdirs[]=win.props.getLastDirs();
        boolean lasttypes[]=win.props.getLastTypes();
        String lastrepos[]=win.props.getLastRepositories();
        if (lastfiles.length > 0) {
          boolean use_repository=repinfo != null;
          if (lasttypes[0]) {
            if (lastrepos[0] != null && lastrepos[0].length() > 0) {
              if (use_repository && !lastrepos[0].equalsIgnoreCase(repinfo.getName())) {
                use_repository=false;
              }
            }
          }
          if (use_repository || !lasttypes[0]) {
            if (win.rep != null) {
              if (win.rep.getName().equalsIgnoreCase(lastrepos[0])) {
                RepositoryDirectory repdir=win.rep.getDirectoryTree().findDirectory(lastdirs[0]);
                if (repdir != null) {
                  log.logDetailed(APP_NAME,Messages.getString("Spoon.Log.AutoLoadingTransformation",lastfiles[0],lastdirs[0]));
                  TransLoadProgressDialog tlpd=new TransLoadProgressDialog(win.shell,win.rep,lastfiles[0],repdir);
                  TransMeta transInfo=tlpd.open();
                  if (transInfo != null) {
                    win.transMeta=transInfo;
                    win.setFilename(lastfiles[0]);
                  }
                }
              }
            }
 else {
              win.transMeta=new TransMeta(lastfiles[0]);
              win.setFilename(lastfiles[0]);
            }
          }
          win.transMeta.clearChanged();
        }
      }
    }
  }
 catch (  KettleException ke) {
    log.logError(APP_NAME,Messages.getString("Spoon.Log.ErrorOccurred") + Const.CR + ke.getMessage());
  }
  win.open();
  splash.dispose();
  try {
    while (!win.isDisposed()) {
      if (!win.readAndDispatch())       win.sleep();
    }
  }
 catch (  Throwable e) {
    log.logError(APP_NAME,Messages.getString("Spoon.Log.UnexpectedErrorOccurred") + Const.CR + e.getMessage());
    e.printStackTrace();
  }
  win.dispose();
  log.logBasic(APP_NAME,APP_NAME + " " + Messages.getString("Spoon.Log.AppHasEnded"));
  log.close();
  System.exit(0);
}
