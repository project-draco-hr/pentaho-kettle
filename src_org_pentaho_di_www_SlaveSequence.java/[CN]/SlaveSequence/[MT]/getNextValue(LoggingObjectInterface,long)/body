{
  Database db=null;
  try {
    db=new Database(log,databaseMeta);
    db.connect();
    String schemaTable=databaseMeta.getQuotedSchemaTableCombination(schemaName,tableName);
    String seqField=databaseMeta.quoteField(sequenceNameField);
    String valField=databaseMeta.quoteField(valueField);
    boolean update=false;
    String sql="SELECT " + valField + " FROM "+ schemaTable+ " WHERE "+ seqField+ " = '"+ name+ "'";
    RowMetaAndData row=db.getOneRow(sql);
    long value;
    if (row != null && row.getData() != null) {
      update=true;
      Long longValue=row.getInteger(0);
      if (longValue == null) {
        value=startValue;
      }
 else {
        value=longValue.longValue();
      }
    }
 else {
      value=startValue;
    }
    long maximum=value + incrementValue;
    if (update) {
      sql="UPDATE " + schemaTable + " SET "+ valField+ "="+ maximum+ " WHERE "+ seqField+ "='"+ name+ "'";
    }
 else {
      sql="INSERT INTO " + schemaTable + "("+ seqField+ ", "+ maximum+ ") VALUES('"+ name+ "', "+ value+ ")";
    }
    db.execStatement(sql);
    return value;
  }
 catch (  Exception e) {
    throw new KettleException("Unable to get next value for slave sequence '" + name + "' on database '"+ databaseMeta.getName()+ "'",e);
  }
 finally {
    db.disconnect();
  }
}
