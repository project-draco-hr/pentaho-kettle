{
  try {
    if (job != null && isRunning && job.isInitialized()) {
      job.stopAll();
      job.endProcessing("stop",new Result());
      job.waitUntilFinished(5000);
      LocalVariables.getInstance().removeKettleVariables(job.getName());
      job=null;
      isRunning=false;
      log.logMinimal(Spoon.APP_NAME,Messages.getString("JobLog.Log.JobWasStopped"));
    }
  }
 catch (  KettleJobException je) {
    MessageBox m=new MessageBox(shell,SWT.OK | SWT.ICON_WARNING);
    m.setText(Messages.getString("JobLog.Dialog.UnableToSaveStopLineInLoggingTable.Title"));
    m.setMessage(Messages.getString("JobLog.Dialog.UnableToSaveStopLineInLoggingTable.Message") + Const.CR + je.toString());
    m.open();
  }
 finally {
    enableFields();
  }
}
