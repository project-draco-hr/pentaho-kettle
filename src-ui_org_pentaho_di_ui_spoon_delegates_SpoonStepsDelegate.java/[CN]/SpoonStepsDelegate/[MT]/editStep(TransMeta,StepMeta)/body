{
  boolean refresh=false;
  try {
    String name=stepMeta.getName();
    StepMeta before=(StepMeta)stepMeta.clone();
    StepDialogInterface dialog=spoon.getStepEntryDialog(stepMeta.getStepMetaInterface(),transMeta,name);
    String stepname=null;
    if (dialog != null) {
      dialog.setRepository(spoon.getRepository());
      stepname=dialog.open();
    }
    if (stepname != null) {
      String newname=stepname;
      StepMeta smeta=transMeta.findStep(newname,stepMeta);
      int nr=2;
      while (smeta != null) {
        newname=stepname + " " + nr;
        smeta=transMeta.findStep(newname);
        nr++;
      }
      if (nr > 2) {
        stepname=newname;
        MessageBox mb=new MessageBox(spoon.getShell(),SWT.OK | SWT.ICON_INFORMATION);
        mb.setMessage(Messages.getString("Spoon.Dialog.StepnameExists.Message",stepname));
        mb.setText(Messages.getString("Spoon.Dialog.StepnameExists.Title"));
        mb.open();
      }
      if (!stepname.equals(name))       refresh=true;
      stepMeta.setName(stepname);
      StepMeta after=(StepMeta)stepMeta.clone();
      spoon.addUndoChange(transMeta,new StepMeta[]{before},new StepMeta[]{after},new int[]{transMeta.indexOfStep(stepMeta)});
    }
 else {
      if (transMeta.haveConnectionsChanged()) {
        refresh=true;
      }
    }
    spoon.refreshGraph();
  }
 catch (  Throwable e) {
    if (spoon.getShell().isDisposed())     return null;
    new ErrorDialog(spoon.getShell(),Messages.getString("Spoon.Dialog.UnableOpenDialog.Title"),Messages.getString("Spoon.Dialog.UnableOpenDialog.Message"),new Exception(e));
  }
  if (refresh)   spoon.refreshTree();
  return stepMeta.getName();
}
