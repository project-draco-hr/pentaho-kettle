{
  GenericObjectPool gpool=new GenericObjectPool();
  gpool.setMaxIdle(-1);
  gpool.setWhenExhaustedAction(GenericObjectPool.WHEN_EXHAUSTED_GROW);
  gpool.setMaxActive(maximumSize);
  String clazz=databaseMeta.getDriverClass();
  try {
    Class.forName(clazz).newInstance();
  }
 catch (  Exception e) {
    throw new KettleDatabaseException("Unable to load driver for connect [" + databaseMeta.getName() + "], class ["+ clazz+ "]",e);
  }
  String url;
  String userName;
  String password;
  try {
    url=databaseMeta.environmentSubstitute(databaseMeta.getURL(partitionId));
    userName=databaseMeta.environmentSubstitute(databaseMeta.getUsername());
    password=databaseMeta.environmentSubstitute(databaseMeta.getPassword());
  }
 catch (  RuntimeException e) {
    url=databaseMeta.getURL(partitionId);
    userName=databaseMeta.getUsername();
    password=databaseMeta.getPassword();
  }
  Properties originalProperties=databaseMeta.getConnectionPoolingProperties();
  originalProperties.setProperty("user",Const.NVL(userName,""));
  originalProperties.setProperty("password",Const.NVL(password,""));
  Properties properties=new Properties();
  Iterator iterator=originalProperties.keySet().iterator();
  while (iterator.hasNext()) {
    String key=(String)iterator.next();
    String value=originalProperties.getProperty(key);
    properties.put(key,databaseMeta.environmentSubstitute(value));
  }
  ConnectionFactory cf=new DriverManagerConnectionFactory(url,properties);
  new PoolableConnectionFactory(cf,gpool,null,null,false,false);
  for (int i=0; i < initialSize; i++) {
    try {
      gpool.addObject();
    }
 catch (    Exception e) {
      throw new KettleDatabaseException("Unable to pre-load connection to the connection pool",e);
    }
  }
  pd.registerPool(databaseMeta.getName(),gpool);
}
