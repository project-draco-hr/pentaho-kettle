{
  try {
    if (databaseMeta.getID() <= 0) {
      databaseMeta.setID(getDatabaseID(databaseMeta.getName()));
    }
    if (databaseMeta.getID() <= 0) {
      databaseMeta.setID(insertDatabase(databaseMeta.getName(),DatabaseMeta.getDatabaseTypeCode(databaseMeta.getDatabaseType()),DatabaseMeta.getAccessTypeDesc(databaseMeta.getAccessType()),databaseMeta.getHostname(),databaseMeta.getDatabaseName(),databaseMeta.getDatabasePortNumberString(),databaseMeta.getUsername(),databaseMeta.getPassword(),databaseMeta.getServername(),databaseMeta.getDataTablespace(),databaseMeta.getIndexTablespace()));
    }
 else {
      updateDatabase(databaseMeta.getID(),databaseMeta.getName(),DatabaseMeta.getDatabaseTypeCode(databaseMeta.getDatabaseType()),DatabaseMeta.getAccessTypeDesc(databaseMeta.getAccessType()),databaseMeta.getHostname(),databaseMeta.getDatabaseName(),databaseMeta.getDatabasePortNumberString(),databaseMeta.getUsername(),databaseMeta.getPassword(),databaseMeta.getServername(),databaseMeta.getDataTablespace(),databaseMeta.getIndexTablespace());
    }
    delDatabaseAttributes(databaseMeta.getID());
    Properties attributes=databaseMeta.getAttributes();
    Enumeration<Object> keys=databaseMeta.getAttributes().keys();
    while (keys.hasMoreElements()) {
      String code=(String)keys.nextElement();
      String attribute=(String)attributes.get(code);
      insertDatabaseAttribute(databaseMeta.getID(),code,attribute);
    }
  }
 catch (  KettleDatabaseException dbe) {
    throw new KettleException("Error saving database connection or one of its attributes to the repository.",dbe);
  }
}
