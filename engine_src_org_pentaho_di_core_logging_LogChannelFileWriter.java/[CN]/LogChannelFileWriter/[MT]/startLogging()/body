{
  exception=null;
  active.set(true);
  Thread thread=new Thread(new Runnable(){
    public void run(){
      try {
        while (active.get() && exception == null) {
          int last=KettleLogStore.getLastBufferLineNr();
          StringBuffer buffer=KettleLogStore.getAppender().getBuffer(logChannelId,false,lastBufferLineNr,last);
          logFileOutputStream.write(buffer.toString().getBytes());
          lastBufferLineNr=last + 1;
          Thread.sleep(pollingInterval);
        }
        StringBuffer buffer=KettleLogStore.getAppender().getBuffer(logChannelId,false,lastBufferLineNr);
        logFileOutputStream.write(buffer.toString().getBytes());
      }
 catch (      Exception e) {
        exception=new KettleException("There was an error logging to file '" + logFile + "'",e);
      }
 finally {
        try {
          if (logFileOutputStream != null) {
            logFileOutputStream.close();
            logFileOutputStream=null;
          }
        }
 catch (        Exception e) {
          exception=new KettleException("There was an error closing log file file '" + logFile + "'",e);
        }
      }
    }
  }
);
  thread.start();
}
