{
  boolean refresh=false;
  try {
    String name=stepMeta.getName();
    StepMeta before=(StepMeta)stepMeta.clone();
    StepMetaInterface stepint=stepMeta.getStepMetaInterface();
    StepDialogInterface dialog=stepint.getDialog(shell,stepMeta.getStepMetaInterface(),transMeta,name);
    dialog.setRepository(rep);
    String stepname=dialog.open();
    if (stepname != null) {
      String newname=stepname;
      StepMeta smeta=transMeta.findStep(newname,stepMeta);
      int nr=2;
      while (smeta != null) {
        newname=stepname + " " + nr;
        smeta=transMeta.findStep(newname);
        nr++;
      }
      if (nr > 2) {
        stepname=newname;
        MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_INFORMATION);
        mb.setMessage(Messages.getString("Spoon.Dialog.StepnameExists.Message",stepname));
        mb.setText(Messages.getString("Spoon.Dialog.StepnameExists.Title"));
        mb.open();
      }
      if (!stepname.equals(name))       refresh=true;
      stepMeta.setName(stepname);
      StepMeta after=(StepMeta)stepMeta.clone();
      addUndoChange(transMeta,new StepMeta[]{before},new StepMeta[]{after},new int[]{transMeta.indexOfStep(stepMeta)});
    }
 else {
      if (transMeta.haveConnectionsChanged()) {
        refresh=true;
      }
    }
    refreshGraph();
  }
 catch (  Throwable e) {
    if (shell.isDisposed())     return null;
    new ErrorDialog(shell,Messages.getString("Spoon.Dialog.UnableOpenDialog.Title"),Messages.getString("Spoon.Dialog.UnableOpenDialog.Message"),new Exception(e));
  }
  if (refresh)   refreshTree();
  return stepMeta.getName();
}
