{
  TransMeta[] transMetas=getLoadedTransformations();
  JobMeta[] jobMetas=getLoadedJobs();
  if ((transMetas == null || transMetas.length == 0) && (jobMetas == null || jobMetas.length == 0))   return;
  EnterSearchDialog esd=new EnterSearchDialog(shell);
  if (!esd.open()) {
    return;
  }
  ArrayList rows=new ArrayList();
  for (int t=0; t < transMetas.length; t++) {
    TransMeta transMeta=transMetas[t];
    String filterString=esd.getFilterString();
    String filter=filterString;
    if (filter != null)     filter=filter.toUpperCase();
    List stringList=transMeta.getStringList(esd.isSearchingSteps(),esd.isSearchingDatabases(),esd.isSearchingNotes());
    for (int i=0; i < stringList.size(); i++) {
      StringSearchResult result=(StringSearchResult)stringList.get(i);
      boolean add=Const.isEmpty(filter);
      if (filter != null && result.getString().toUpperCase().indexOf(filter) >= 0)       add=true;
      if (filter != null && result.getFieldName().toUpperCase().indexOf(filter) >= 0)       add=true;
      if (filter != null && result.getParentObject().toString().toUpperCase().indexOf(filter) >= 0)       add=true;
      if (filter != null && result.getGrandParentObject().toString().toUpperCase().indexOf(filter) >= 0)       add=true;
      if (add)       rows.add(result.toRow());
    }
  }
  RowMetaInterface rowMeta=null;
  for (int t=0; t < jobMetas.length; t++) {
    JobMeta jobMeta=jobMetas[t];
    String filterString=esd.getFilterString();
    String filter=filterString;
    if (filter != null)     filter=filter.toUpperCase();
    List stringList=jobMeta.getStringList(esd.isSearchingSteps(),esd.isSearchingDatabases(),esd.isSearchingNotes());
    for (int i=0; i < stringList.size(); i++) {
      StringSearchResult result=(StringSearchResult)stringList.get(i);
      boolean add=Const.isEmpty(filter);
      if (filter != null && result.getString().toUpperCase().indexOf(filter) >= 0)       add=true;
      if (filter != null && result.getFieldName().toUpperCase().indexOf(filter) >= 0)       add=true;
      if (filter != null && result.getParentObject().toString().toUpperCase().indexOf(filter) >= 0)       add=true;
      if (filter != null && result.getGrandParentObject().toString().toUpperCase().indexOf(filter) >= 0)       add=true;
      RowMetaAndData row=result.toRow();
      rowMeta=row.getRowMeta();
      if (add)       rows.add(row.getData());
    }
  }
  if (rows.size() != 0) {
    PreviewRowsDialog prd=new PreviewRowsDialog(shell,SWT.NONE,Messages.getString("Spoon.StringSearchResult.Subtitle"),rowMeta,rows);
    String title=Messages.getString("Spoon.StringSearchResult.Title");
    String message=Messages.getString("Spoon.StringSearchResult.Message");
    prd.setTitleMessage(title,message);
    prd.open();
  }
 else {
    MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_INFORMATION);
    mb.setMessage(Messages.getString("Spoon.Dialog.NothingFound.Message"));
    mb.setText(Messages.getString("Spoon.Dialog.NothingFound.Title"));
    mb.open();
  }
}
