{
  Menu mTree=new Menu(shell,SWT.POP_UP);
  final TreeItem tisel[]=wTree.getSelection();
  if (tisel.length == 1 || sameCategory(tisel)) {
    final TreeItem ti=tisel[0];
    final int level=Const.getTreeLevel(ti);
    final String path[]=Const.getTreeStrings(ti);
    final String item=ti.getText();
    int cat=getItemCategory(ti);
switch (cat) {
case ITEM_CATEGORY_ROOT:
{
        MenuItem miExp=new MenuItem(mTree,SWT.PUSH);
        miExp.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Objects.ExportAll"));
        SelectionAdapter lsExp=new SelectionAdapter(){
          public void widgetSelected(          SelectionEvent e){
            exportAll();
          }
        }
;
        miExp.addSelectionListener(lsExp);
        MenuItem miImp=new MenuItem(mTree,SWT.PUSH);
        miImp.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Objects.ImportAll"));
        SelectionAdapter lsImp=new SelectionAdapter(){
          public void widgetSelected(          SelectionEvent e){
            importAll();
          }
        }
;
        miImp.addSelectionListener(lsImp);
        miImp.setEnabled(!userinfo.isReadonly());
        MenuItem miTrans=new MenuItem(mTree,SWT.PUSH);
        miTrans.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Objects.ExportTrans"));
        SelectionAdapter lsTrans=new SelectionAdapter(){
          public void widgetSelected(          SelectionEvent e){
            exportTransformations();
          }
        }
;
        miTrans.addSelectionListener(lsTrans);
        MenuItem miJobs=new MenuItem(mTree,SWT.PUSH);
        miJobs.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Objects.ExportJob"));
        SelectionAdapter lsJobs=new SelectionAdapter(){
          public void widgetSelected(          SelectionEvent e){
            exportJobs();
          }
        }
;
        miJobs.addSelectionListener(lsJobs);
      }
    break;
case ITEM_CATEGORY_DATABASES_ROOT:
{
    MenuItem miNew=new MenuItem(mTree,SWT.PUSH);
    miNew.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.ConnectionsRoot.New"));
    SelectionAdapter lsNew=new SelectionAdapter(){
      public void widgetSelected(      SelectionEvent e){
        newDatabase();
      }
    }
;
    miNew.addSelectionListener(lsNew);
    miNew.setEnabled(!userinfo.isReadonly());
  }
break;
case ITEM_CATEGORY_DATABASE:
{
MenuItem miNew=new MenuItem(mTree,SWT.PUSH);
miNew.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Connections.New"));
SelectionAdapter lsNew=new SelectionAdapter(){
  public void widgetSelected(  SelectionEvent e){
    newDatabase();
  }
}
;
miNew.addSelectionListener(lsNew);
miNew.setEnabled(!userinfo.isReadonly());
MenuItem miEdit=new MenuItem(mTree,SWT.PUSH);
miEdit.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Connections.Edit"));
SelectionAdapter lsEdit=new SelectionAdapter(){
  public void widgetSelected(  SelectionEvent e){
    editDatabase(item);
  }
}
;
miEdit.addSelectionListener(lsEdit);
miEdit.setEnabled(!userinfo.isReadonly());
MenuItem miDel=new MenuItem(mTree,SWT.PUSH);
miDel.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Connections.Delete"));
SelectionAdapter lsDel=new SelectionAdapter(){
  public void widgetSelected(  SelectionEvent e){
    delDatabase(item);
  }
}
;
miDel.addSelectionListener(lsDel);
miDel.setEnabled(!userinfo.isReadonly());
}
break;
case ITEM_CATEGORY_SLAVES_ROOT:
{
MenuItem miNew=new MenuItem(mTree,SWT.PUSH);
miNew.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Slave.New"));
SelectionAdapter lsNew=new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
newSlaveServer();
}
}
;
miNew.addSelectionListener(lsNew);
miNew.setEnabled(!userinfo.isReadonly());
}
break;
case ITEM_CATEGORY_SLAVE:
{
MenuItem miNew=new MenuItem(mTree,SWT.PUSH);
miNew.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Slave.New"));
SelectionAdapter lsNew=new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
newSlaveServer();
}
}
;
miNew.addSelectionListener(lsNew);
miNew.setEnabled(!userinfo.isReadonly());
MenuItem miEdit=new MenuItem(mTree,SWT.PUSH);
miEdit.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Connections.Edit"));
SelectionAdapter lsEdit=new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
editSlaveServer(item);
}
}
;
miEdit.addSelectionListener(lsEdit);
miEdit.setEnabled(!userinfo.isReadonly());
MenuItem miDel=new MenuItem(mTree,SWT.PUSH);
miDel.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Connections.Delete"));
SelectionAdapter lsDel=new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
delSlaveServer(item);
}
}
;
miDel.addSelectionListener(lsDel);
miDel.setEnabled(!userinfo.isReadonly());
}
break;
case ITEM_CATEGORY_TRANSFORMATIONS_ROOT:
break;
case ITEM_CATEGORY_TRANSFORMATION:
if (level >= 2) {
String realpath[]=new String[level - 2];
for (int i=0; i < realpath.length; i++) realpath[i]=path[i + 2];
final RepositoryDirectory repdir=rep.getDirectoryTree().findDirectory(realpath);
MenuItem miOpen=new MenuItem(mTree,SWT.PUSH);
miOpen.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Transformations.Open"));
miOpen.addSelectionListener(new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
openTransformation(item,repdir);
}
}
);
MenuItem miDel=new MenuItem(mTree,SWT.PUSH);
miDel.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Transformations.Delete"));
miDel.addSelectionListener(new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
delSelectedTransformations();
}
}
);
miDel.setEnabled(!userinfo.isReadonly());
MenuItem miRen=new MenuItem(mTree,SWT.PUSH);
miRen.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Transformations.Rename"));
miRen.addSelectionListener(new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
renameTransformation(item,repdir);
}
}
);
miRen.setEnabled(!userinfo.isReadonly());
}
break;
case ITEM_CATEGORY_JOB_DIRECTORY:
case ITEM_CATEGORY_TRANSFORMATION_DIRECTORY:
if (level >= 2) {
String realpath[]=new String[level - 1];
for (int i=0; i < realpath.length; i++) realpath[i]=path[i + 2];
final RepositoryDirectory repdir=rep.getDirectoryTree().findDirectory(realpath);
MenuItem miCreate=new MenuItem(mTree,SWT.PUSH);
miCreate.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.TransDirectory.Create"));
miCreate.addSelectionListener(new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
createDirectory(ti,repdir);
}
}
);
if (level > 3) {
MenuItem miRename=new MenuItem(mTree,SWT.PUSH);
miRename.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.TransDirectory.Rename"));
miRename.addSelectionListener(new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
renameDirectory(ti,repdir);
}
}
);
MenuItem miDelete=new MenuItem(mTree,SWT.PUSH);
miDelete.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.TransDirectory.Delete"));
miDelete.addSelectionListener(new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
delDirectory(ti,repdir);
}
}
);
}
}
break;
case ITEM_CATEGORY_JOBS_ROOT:
break;
case ITEM_CATEGORY_JOB:
{
String realpath[]=new String[level - 2];
for (int i=0; i < realpath.length; i++) realpath[i]=path[i + 2];
final RepositoryDirectory repdir=rep.getDirectoryTree().findDirectory(realpath);
MenuItem miDel=new MenuItem(mTree,SWT.PUSH);
miDel.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Jobs.Delete"));
miDel.addSelectionListener(new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
if (delJob(item,repdir)) ti.dispose();
}
}
);
miDel.setEnabled(!userinfo.isReadonly());
MenuItem miRen=new MenuItem(mTree,SWT.PUSH);
miRen.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Jobs.Rename"));
miRen.addSelectionListener(new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
renameJob(ti,item,repdir);
}
}
);
miRen.setEnabled(!userinfo.isReadonly());
}
break;
case ITEM_CATEGORY_USERS_ROOT:
{
mTree=new Menu(shell,SWT.POP_UP);
MenuItem miNew=new MenuItem(mTree,SWT.PUSH);
miNew.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.UsersRoot.New"));
SelectionAdapter lsNew=new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
newUser();
}
}
;
miNew.addSelectionListener(lsNew);
miNew.setEnabled(!userinfo.isReadonly());
}
break;
case ITEM_CATEGORY_USER:
{
MenuItem miNew=new MenuItem(mTree,SWT.PUSH);
miNew.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Users.New"));
SelectionAdapter lsNew=new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
newUser();
}
}
;
miNew.addSelectionListener(lsNew);
miNew.setEnabled(!userinfo.isReadonly());
MenuItem miEdit=new MenuItem(mTree,SWT.PUSH);
miEdit.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Users.Edit"));
SelectionAdapter lsEdit=new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
editUser(item);
}
}
;
miEdit.addSelectionListener(lsEdit);
miEdit.setEnabled(!userinfo.isReadonly());
MenuItem miRen=new MenuItem(mTree,SWT.PUSH);
miRen.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Users.Rename"));
SelectionAdapter lsRen=new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
renameUser();
}
}
;
miRen.addSelectionListener(lsRen);
miRen.setEnabled(!userinfo.isReadonly());
MenuItem miDel=new MenuItem(mTree,SWT.PUSH);
miDel.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Users.Delete"));
SelectionAdapter lsDel=new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
delUser(item);
}
}
;
miDel.addSelectionListener(lsDel);
miDel.setEnabled(!userinfo.isReadonly());
}
break;
case ITEM_CATEGORY_PROFILES_ROOT:
{
MenuItem miNew=new MenuItem(mTree,SWT.PUSH);
miNew.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.ProfilesRoot.New"));
SelectionAdapter lsNew=new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
newProfile();
}
}
;
miNew.addSelectionListener(lsNew);
miNew.setEnabled(!userinfo.isReadonly());
}
break;
case ITEM_CATEGORY_PROFILE:
{
MenuItem miNew=new MenuItem(mTree,SWT.PUSH);
miNew.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.Profiles.New"));
SelectionAdapter lsNew=new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
newProfile();
}
}
;
miNew.addSelectionListener(lsNew);
miNew.setEnabled(!userinfo.isReadonly());
MenuItem miEdit=new MenuItem(mTree,SWT.PUSH);
miEdit.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.ProfilesRoot.Edit"));
SelectionAdapter lsEdit=new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
editProfile(item);
}
}
;
miEdit.addSelectionListener(lsEdit);
miEdit.setEnabled(!userinfo.isReadonly());
MenuItem miRen=new MenuItem(mTree,SWT.PUSH);
miRen.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.ProfilesRoot.Rename"));
SelectionAdapter lsRen=new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
renameProfile();
}
}
;
miRen.addSelectionListener(lsRen);
miRen.setEnabled(!userinfo.isReadonly());
MenuItem miDel=new MenuItem(mTree,SWT.PUSH);
miDel.setText(Messages.getString("RepositoryExplorerDialog.PopupMenu.ProfilesRoot.Delete"));
SelectionAdapter lsDel=new SelectionAdapter(){
public void widgetSelected(SelectionEvent e){
delProfile(item);
}
}
;
miDel.addSelectionListener(lsDel);
miDel.setEnabled(!userinfo.isReadonly());
}
break;
default :
mTree=null;
}
}
wTree.setMenu(mTree);
}
