{
  boolean sized=false;
  shell.setMaximized(maximized);
  Rectangle r=rectangle;
  if (r != null && r.x >= 0 && r.y >= 0 && r.width >= 0 && r.height >= 0) {
    if (r.x > 0 && r.y > 0)     shell.setSize(r.width,r.height);
    if (r.width > 0 && r.height > 0)     shell.setLocation(r.x,r.y);
    sized=true;
  }
  if (!sized) {
    shell.layout();
  }
  Point shLoc=shell.getLocation();
  Rectangle shRect=shell.getBounds();
  Rectangle diRect=shell.getDisplay().getBounds();
  boolean resizex=false;
  boolean resizey=false;
  if (shRect.width > diRect.width) {
    shRect.width=diRect.width;
    resizex=true;
  }
  if (shRect.height > diRect.height) {
    shRect.height=diRect.height;
    resizey=true;
  }
  if (resizex || resizey) {
    shell.setSize(shRect.width,shRect.height);
    if (resizex)     shLoc.x=0;
    if (resizey)     shLoc.y=0;
    shell.setLocation(shLoc.x,shLoc.y);
  }
  boolean moveLeft=false;
  boolean moveUp=false;
  if (shLoc.x + shRect.width > diRect.width) {
    shLoc.x=diRect.width - shRect.width - 50;
    if (shLoc.x < 0)     shLoc.x=0;
    moveLeft=true;
  }
  if (shLoc.y + shRect.height > diRect.height) {
    shLoc.y=diRect.height - shRect.height - 50;
    if (shLoc.y < 0)     shLoc.y=0;
    moveUp=true;
  }
  if (moveLeft || moveUp) {
    shell.setLocation(shLoc.x,shLoc.y);
  }
}
