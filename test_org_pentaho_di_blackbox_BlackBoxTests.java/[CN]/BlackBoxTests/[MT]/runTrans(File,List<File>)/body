{
  System.out.println("Running: " + getPath(transFile));
  LogWriter log;
  log=LogWriter.getInstance(LogWriter.LOG_LEVEL_ERROR);
  Log4jStringAppender stringAppender=LogWriter.createStringAppender();
  log.addAppender(stringAppender);
  boolean ok=false;
  int failsIn=failures;
  try {
    currentFile=transFile;
    if (!transFile.exists()) {
      log.logError("BlackBoxTest","Transformation does not exist: " + getPath(transFile));
      addFailure("Transformation does not exist: " + getPath(transFile));
    }
    if (expectedFiles.isEmpty()) {
      fail("No expected output files found: " + getPath(transFile));
      addFailure("No expected output files found: " + getPath(transFile));
    }
    try {
      ok=runTrans(transFile.getAbsolutePath(),log);
      for (int i=0; i < expectedFiles.size(); i++) {
        File expected=expectedFiles.get(i);
        String actualFile=expected.getAbsolutePath();
        actualFile=actualFile.replaceFirst(".expected.",".actual.");
        actualFile=actualFile.replaceFirst(".expected_" + i + ".",".actual_" + i + ".");
        File actual=new File(actualFile);
        if (ok) {
          fileCompare(expected,actual,log);
        }
      }
    }
 catch (    KettleException ke) {
    }
catch (    AssertionFailedError failure) {
    }
catch (    Throwable t) {
    }
  }
 catch (  AssertionFailedError failure) {
    System.err.println(failure.getMessage());
  }
  log.removeAppender(stringAppender);
  if (!ok && expectedFiles.size() == 1) {
    File expected=expectedFiles.get(0);
    String logStr=stringAppender.getBuffer().toString();
    String tmpFileName=transFile.getAbsolutePath().substring(0,transFile.getAbsolutePath().length() - 4) + "-log.txt";
    File logFile=new File(tmpFileName);
    writeLog(logFile,logStr);
    try {
      if (fileCompare(expected,logFile,log)) {
        failures=failsIn;
      }
    }
 catch (    IOException e) {
      addFailure("Could not compare log files: " + getPath(logFile) + ""+ e.getMessage());
      fail("Could not compare log files: " + getPath(logFile) + ""+ e.getMessage());
    }
  }
}
