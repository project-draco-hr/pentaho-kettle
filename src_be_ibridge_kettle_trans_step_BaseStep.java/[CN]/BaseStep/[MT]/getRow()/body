{
  int sleeptime;
  int switches;
  RowSet in=currentInputStream();
  switches=0;
  sleeptime=transMeta.getSleepTimeEmpty();
  while (in.isEmpty() && !stopped) {
    if (in.isDone()) {
      inputRowSets.remove(in_handling);
      if (inputRowSets.size() == 0) {
        return null;
      }
    }
    nextInputStream();
    in=currentInputStream();
    switches++;
    if (switches >= inputRowSets.size()) {
      switches=0;
      try {
        if (sleeptime > 0)         sleep(0,sleeptime);
 else         super.notifyAll();
      }
 catch (      Exception e) {
        logError(Messages.getString("BaseStep.Log.SleepInterupted") + e.toString());
        setErrors(1);
        stopAll();
        return null;
      }
      if (sleeptime < 100)       sleeptime*=1.2;
 else       sleeptime=100;
      nrGetSleeps+=sleeptime;
    }
  }
  if (stopped) {
    if (log.isDebug())     logDebug(Messages.getString("BaseStep.Log.StopLookingForMoreRows"));
    stopAll();
    return null;
  }
  in.setPriorityTo(calcGetPriority(in));
  Row row=in.getRow();
  linesRead++;
  for (int i=0; i < rowListeners.size(); i++) {
    RowListener rowListener=(RowListener)rowListeners.get(i);
    rowListener.rowReadEvent(row);
  }
  nextInputStream();
  if (extraCheckingEnabled) {
    if (referenceRow == null) {
      referenceRow=new Row(row);
    }
 else {
      if (referenceRow.size() != row.size()) {
        throw new RuntimeException("We detected rows with varying number of fields, this is not allowed in a transformation.  " + "Check your settings. (first row contained " + referenceRow.size() + " elements, this one contains "+ row.size()+ " : "+ row);
      }
 else {
        for (int i=0; i < referenceRow.size(); i++) {
          String referenceName=referenceRow.getValue(i).getName();
          String compareName=row.getValue(i).getName();
          if (!referenceName.equalsIgnoreCase(compareName)) {
            throw new RuntimeException("Field #" + i + " is not the same as the first row received: you're mixing rows with different layout! ("+ referenceName+ "!="+ compareName+ ")");
          }
        }
      }
    }
  }
  return row;
}
