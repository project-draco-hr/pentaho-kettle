{
  if (referenceRow == null) {
    referenceRow=new Row(row);
  }
 else {
    if (referenceRow.size() != row.size()) {
      throw new RuntimeException("We detected rows with varying number of fields, this is not allowed in a transformation.  " + "Check your settings. (first row contained " + referenceRow.size() + " elements, this one contains "+ row.size()+ " : "+ row);
    }
 else {
      for (int i=0; i < referenceRow.size(); i++) {
        Value referenceValue=referenceRow.getValue(i);
        Value compareValue=row.getValue(i);
        if (!referenceValue.getName().equalsIgnoreCase(compareValue.getName())) {
          throw new RuntimeException("The name of field #" + i + " is not the same as in the first row received: you're mixing rows with different layout! ("+ referenceValue.toStringMeta()+ "!="+ compareValue.toStringMeta()+ ")");
        }
        if (referenceValue.getType() != compareValue.getType()) {
          throw new RuntimeException("The data type of field #" + i + " is not the same as the first row received: you're mixing rows with different layout! ("+ referenceValue.toStringMeta()+ "!="+ compareValue.toStringMeta()+ ")");
        }
      }
    }
  }
}
