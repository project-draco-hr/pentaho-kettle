{
  Document doc=null;
  try {
    InputStream in=XulDatabaseDialog.class.getClassLoader().getResourceAsStream("org/pentaho/ui/database/databasedialog.xul");
    SAXReader rdr=new SAXReader();
    doc=rdr.read(in);
  }
 catch (  Exception e) {
    new ErrorDialog(parentShell,Messages.getString("XulDatabaseDialog.Error.Titel"),Messages.getString("XulDatabaseDialog.Error.SAXReader"),e);
    return null;
  }
  XulDomContainer container=null;
  try {
    SwtXulLoader loader=new SwtXulLoader();
    loader.register("VARIABLETEXTBOX","org.pentaho.di.ui.core.database.dialog.tags.ExtTextbox");
    container=loader.loadXul(doc);
    container.addEventHandler("dataHandler",DataOverrideHandler.class.getName());
    dataHandler=container.getEventHandler("dataHandler");
    if (databaseMeta != null) {
      dataHandler.setData(databaseMeta);
    }
    ((DataOverrideHandler)container.getEventHandler("dataHandler")).setDatabases(databases);
    ((DataOverrideHandler)container.getEventHandler("dataHandler")).getControls();
  }
 catch (  XulException e1) {
    e1.printStackTrace();
  }
  try {
    XulComponent boxElement=container.getDocumentRoot().getElementById("test-button-box");
    XulComponent parentElement=boxElement.getParent();
    XulDomContainer fragmentContainer=null;
    String pkg=getClass().getPackage().getName().replace('.','/');
    fragmentContainer=container.loadFragment(pkg.concat("/feature_override.xul"));
    XulComponent newBox=fragmentContainer.getDocumentRoot().getFirstChild();
    parentElement.replaceChild(boxElement,newBox);
  }
 catch (  XulException e) {
    new ErrorDialog(parentShell,Messages.getString("XulDatabaseDialog.Error.Titel"),Messages.getString("XulDatabaseDialog.Error.HandleXul"),e);
    return null;
  }
  try {
    XulWindow dialog=(XulWindow)container.getDocumentRoot().getRootElement();
    shell=(Shell)dialog.getManagedObject();
    shell.setParent(parentShell);
    shell.setImage(GUIResource.getInstance().getImageConnection());
    dialog.open();
    databaseMeta=(DatabaseMeta)dataHandler.getData();
    databaseName=databaseMeta.getDatabaseName();
  }
 catch (  Exception e) {
    new ErrorDialog(parentShell,Messages.getString("XulDatabaseDialog.Error.Titel"),Messages.getString("XulDatabaseDialog.Error.Dialog"),e);
    return null;
  }
  return databaseName;
}
