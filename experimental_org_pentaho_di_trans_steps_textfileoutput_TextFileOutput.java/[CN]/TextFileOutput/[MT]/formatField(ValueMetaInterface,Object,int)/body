{
  String retval="";
  TextFileField field=null;
  if (idx >= 0)   field=meta.getOutputFields()[idx];
  if (v.isString()) {
    if (v.isNull(valueData) || v.getString(valueData) == null) {
      if (idx >= 0 && field != null && !Const.isEmpty(field.getNullString())) {
        if (meta.isEnclosureForced() && !Const.isEmpty(meta.getEnclosure())) {
          retval=meta.getEnclosure() + field.getNullString() + meta.getEnclosure();
        }
 else {
          retval=field.getNullString();
        }
      }
 else {
        retval=Const.NULL_STRING;
      }
    }
 else {
      String value=v.getString(valueData);
      String separator=meta.getSeparator();
      boolean enclosureIsOptional=!meta.isEnclosureForced();
      if (Const.isEmpty(meta.getEnclosure()) || Const.isEmpty(separator) || (value.indexOf(separator) < 0 && enclosureIsOptional)) {
        retval=value;
      }
 else {
        retval=meta.getEnclosure() + value + meta.getEnclosure();
      }
    }
  }
 else   if (v.isNumeric()) {
    if (idx >= 0 && field != null && field.getFormat() != null) {
      if (v.isNull(valueData)) {
        if (field.getNullString() != null)         retval=field.getNullString();
 else         retval="";
      }
 else {
        if (!Const.isEmpty(field.getFormat())) {
          data.df.applyPattern(field.getFormat());
        }
 else {
          data.df.applyPattern(data.defaultDecimalFormat.toPattern());
        }
        if (!Const.isEmpty(field.getDecimalSymbol())) {
          data.dfs.setDecimalSeparator(field.getDecimalSymbol().charAt(0));
        }
 else {
          data.dfs.setDecimalSeparator(data.defaultDecimalFormatSymbols.getDecimalSeparator());
        }
        if (!Const.isEmpty(field.getGroupingSymbol())) {
          data.dfs.setGroupingSeparator(field.getGroupingSymbol().charAt(0));
        }
 else {
          data.dfs.setGroupingSeparator(data.defaultDecimalFormatSymbols.getGroupingSeparator());
        }
        if (!Const.isEmpty(field.getCurrencySymbol())) {
          data.dfs.setCurrencySymbol(field.getCurrencySymbol());
        }
 else {
          data.dfs.setCurrencySymbol(data.defaultDecimalFormatSymbols.getCurrencySymbol());
        }
        data.df.setDecimalFormatSymbols(data.dfs);
        if (v.isBigNumber()) {
          retval=data.df.format(v.getBigNumber(valueData));
        }
 else         if (v.isNumber()) {
          retval=data.df.format(v.getNumber(valueData));
        }
 else {
          retval=data.df.format(v.getInteger(valueData));
        }
      }
    }
 else {
      if (v.isNull(valueData)) {
        if (idx >= 0 && field != null && !Const.isEmpty(field.getNullString())) {
          retval=field.getNullString();
        }
 else {
          retval=Const.NULL_NUMBER;
        }
      }
 else {
        retval=v.getString(valueData);
      }
    }
  }
 else   if (v.isDate()) {
    if (idx >= 0 && field != null && !Const.isEmpty(field.getFormat()) && v.getDate(valueData) != null) {
      if (!Const.isEmpty(field.getFormat())) {
        data.daf.applyPattern(field.getFormat());
      }
 else {
        data.daf.applyPattern(data.defaultDateFormat.toPattern());
      }
      data.daf.setDateFormatSymbols(data.dafs);
      retval=data.daf.format(v.getDate(valueData));
    }
 else {
      if (v.isNull(valueData) || v.getDate(valueData) == null) {
        if (idx >= 0 && field != null && !Const.isEmpty(field.getNullString())) {
          retval=field.getNullString();
        }
 else {
          retval=Const.NULL_DATE;
        }
      }
 else {
        retval=v.getString(valueData);
      }
    }
  }
 else   if (v.isBinary()) {
    if (v.isNull(valueData)) {
      if (!Const.isEmpty(field.getNullString())) {
        retval=field.getNullString();
      }
 else {
        retval=Const.NULL_BINARY;
      }
    }
 else {
      try {
        retval=new String(v.getBinary(valueData),"UTF-8");
      }
 catch (      UnsupportedEncodingException e) {
        retval=Const.NULL_BINARY;
      }
    }
  }
 else {
    if (v.isNull(valueData)) {
      if (idx >= 0 && field != null && !Const.isEmpty(field.getNullString())) {
        retval=field.getNullString();
      }
 else {
        retval=Const.NULL_BOOLEAN;
      }
    }
 else {
      retval=v.getString(valueData);
    }
  }
  if (meta.isPadded()) {
    int length, precision;
    if (idx < 0 || field == null) {
      length=v.getLength() < 0 ? 0 : v.getLength();
      precision=v.getPrecision() < 0 ? 0 : v.getPrecision();
    }
 else {
      length=field.getLength() < 0 ? 0 : field.getLength();
      precision=field.getPrecision() < 0 ? 0 : field.getPrecision();
    }
    if (v.isNumber()) {
      length++;
      if (precision > 0)       length++;
    }
    if (v.isDate()) {
      length=23;
      precision=0;
    }
    if (v.isBoolean()) {
      length=5;
      precision=0;
    }
    retval=Const.rightPad(new StringBuffer(retval),length + precision);
  }
  return retval;
}
