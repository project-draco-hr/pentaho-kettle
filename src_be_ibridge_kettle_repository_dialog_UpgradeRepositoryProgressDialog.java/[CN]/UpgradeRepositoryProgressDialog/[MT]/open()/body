{
  boolean retval=true;
  IRunnableWithProgress op=new IRunnableWithProgress(){
    public void run(    IProgressMonitor monitor) throws InvocationTargetException, InterruptedException {
      LocalVariables.getInstance().createKettleVariables(Thread.currentThread(),shell.getDisplay().getSyncThread(),true);
      try {
        rep.createRepositorySchema(monitor,upgrade);
      }
 catch (      KettleException e) {
        e.printStackTrace();
        throw new InvocationTargetException(e,"Error creating or upgrading repository:" + Const.CR + e.getMessage()+ Const.CR);
      }
    }
  }
;
  try {
    ProgressMonitorDialog pmd=new ProgressMonitorDialog(shell);
    pmd.run(false,false,op);
  }
 catch (  InvocationTargetException e) {
    System.out.println("Error creating repository: " + e.toString());
    e.printStackTrace();
    new ErrorDialog(shell,props,"Error " + (upgrade ? "upgrading" : "creating") + " repository","An error occured " + (upgrade ? "upgrading" : "creating") + " the repository!",e);
    retval=false;
  }
catch (  InterruptedException e) {
    System.out.println("Error creating repository: " + e.toString());
    e.printStackTrace();
    new ErrorDialog(shell,props,"Error " + (upgrade ? "upgrading" : "creating") + " repository","An error occured " + (upgrade ? "upgrading" : "creating") + " the repository!",e);
    retval=false;
  }
  return retval;
}
