{
  Row row=r;
  if (keyField != null && keyField.length() > 0) {
    int idx=row.searchValueIndex(keyField);
    if (idx < 0) {
      throw new KettleStepException("Unable to locate [" + keyField + "] in the input fields");
    }
    row.removeValue(idx);
  }
 else {
    throw new KettleStepException("The key field is not specified");
  }
  for (int i=0; i < denormaliserTargetField.length; i++) {
    String fieldname=denormaliserTargetField[i].getFieldName();
    if (fieldname != null && fieldname.length() > 0) {
      int idx=row.searchValueIndex(fieldname);
      if (idx >= 0) {
        row.removeValue(idx);
      }
    }
 else {
      throw new KettleStepException("The fieldname of target field #" + (i + 1) + " is not specified.");
    }
  }
  for (int i=0; i < denormaliserTargetField.length; i++) {
    DenormaliserTargetField field=denormaliserTargetField[i];
    Value target=new Value(field.getTargetName(),field.getTargetType());
    target.setLength(field.getTargetLength(),field.getTargetPrecision());
    target.setOrigin(name);
    row.addValue(target);
  }
  return row;
}
