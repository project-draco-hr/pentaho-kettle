{
  Row row;
  if (r == null)   row=new Row();
 else   row=r;
  FileInputList fileList=getTextFileList();
  if (fileList.nrOfFiles() == 0) {
    throw new KettleStepException(Messages.getString("XBaseInputMeta.Exception.NoFilesFoundToProcess"));
  }
  XBase xbi=new XBase(fileList.getFile(0).getPath());
  try {
    xbi.open();
    Row add=xbi.getFields();
    for (int i=0; i < add.size(); i++) {
      Value v=add.getValue(i);
      v.setOrigin(name);
    }
    row.addRow(add);
  }
 catch (  KettleException ke) {
    throw new KettleStepException(Messages.getString("XBaseInputMeta.Exception.UnableToReadMetaDataFromXBaseFile"),ke);
  }
 finally {
    xbi.close();
  }
  if (rowNrAdded && rowNrField != null && rowNrField.length() > 0) {
    Value rnr=new Value(rowNrField,Value.VALUE_TYPE_INTEGER);
    rnr.setOrigin(name);
    row.addValue(rnr);
  }
  if (includeFilename) {
    Value v=new Value(filenameField,Value.VALUE_TYPE_STRING);
    v.setLength(100,-1);
    v.setOrigin(name);
    row.addValue(v);
  }
  return row;
}
