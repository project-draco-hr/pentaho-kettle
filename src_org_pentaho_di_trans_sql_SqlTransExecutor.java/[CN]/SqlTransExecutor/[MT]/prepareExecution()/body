{
  sql=new SQL(sqlQuery);
  serviceName=sql.getServiceName();
  if (Const.isEmpty(serviceName) || "dual".equalsIgnoreCase(serviceName)) {
    service=new TransDataService("dual",null,null,null,null);
    service.setDual(true);
    serviceFields=new RowMeta();
  }
 else {
    service=findService(serviceName);
    if (service == null) {
      throw new KettleException("Unable to find service with name '" + service + "' and SQL: "+ sqlQuery);
    }
    serviceTransMeta=loadTransMeta(repository);
    serviceTransMeta.setName(calculateTransname(sql,true));
    serviceTransMeta.activateParameters();
    serviceStepName=service.getServiceStepName();
    serviceFields=serviceTransMeta.getStepFields(serviceStepName);
  }
}
