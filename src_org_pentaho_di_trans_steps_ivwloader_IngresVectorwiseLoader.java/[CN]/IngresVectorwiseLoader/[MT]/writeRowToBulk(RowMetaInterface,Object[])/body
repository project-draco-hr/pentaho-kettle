{
  try {
    byte[] delimiter;
    if (meta.isUseSSV()) {
      delimiter=data.getBytes(";");
    }
 else {
      delimiter=data.separator;
    }
    for (int i=0; i < data.keynrs.length; i++) {
      if (i > 0) {
        data.fifoStream.write(delimiter);
      }
      int index=data.keynrs[i];
      ValueMetaInterface valueMeta=rowMeta.getValueMeta(index);
      Object valueData=r[index];
      if (valueData == null) {
      }
 else {
        if (valueMeta.isStorageBinaryString()) {
          byte[] value=valueMeta.getBinaryString(valueData);
          data.fifoStream.write(value);
        }
 else {
          if (meta.isUseStandardConversion()) {
            if (valueMeta.isDate()) {
              valueMeta.setConversionMask("yyyy-MM-dd HH:mm:ss.SSS");
            }
 else             if (valueMeta.isNumber()) {
              valueMeta.setDecimalSymbol(".");
              valueMeta.setGroupingSymbol("");
            }
          }
          String string=valueMeta.getString(valueData);
          if (string != null) {
            if (meta.isUseSSV()) {
              if (valueMeta.isString()) {
                string=string.replaceAll("\"","\\\\\"");
                string=string.replaceAll("\\n","\\\n");
                string=string.replaceAll("\\r","\\\r");
              }
 else {
              }
              string='"' + string + '"';
            }
            byte[] value=data.getBytes(string);
            data.fifoStream.write(value);
          }
        }
      }
    }
    data.fifoStream.write(data.newline);
  }
 catch (  Exception e) {
    try {
      data.sqlRunner.checkExcn();
    }
 catch (    Exception loadEx) {
      throw new KettleException("Error serializing rows of data to the fifo file",loadEx);
    }
    throw new KettleException("Error serializing rows of data to the fifo file",e);
  }
}
