{
  try {
    PluginRegistry registry=PluginRegistry.getInstance();
    Object object=registry.loadClass(plugin);
    InputStream inputStream=object.getClass().getResourceAsStream(plugin.getImageFile());
    if (inputStream == null) {
      inputStream=object.getClass().getResourceAsStream("/" + plugin.getImageFile());
    }
    if (inputStream == null) {
      inputStream=registry.getClass().getResourceAsStream(plugin.getImageFile());
    }
    if (inputStream == null) {
      inputStream=registry.getClass().getResourceAsStream("/" + plugin.getImageFile());
    }
    try {
      inputStream=new FileInputStream(plugin.getImageFile());
    }
 catch (    FileNotFoundException e) {
    }
    if (inputStream == null) {
      throw new KettleException("Unable to find file: " + plugin.getImageFile() + " for plugin: "+ plugin);
    }
    BufferedImage image=ImageIO.read(inputStream);
    inputStream.close();
    return image;
  }
 catch (  Throwable e) {
    throw new KettleException("Unable to load image from file : '" + plugin.getImageFile() + "' for plugin: "+ plugin,e);
  }
}
