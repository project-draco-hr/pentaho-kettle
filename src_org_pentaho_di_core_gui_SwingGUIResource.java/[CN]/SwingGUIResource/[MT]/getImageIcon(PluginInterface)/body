{
  try {
    PluginRegistry registry=PluginRegistry.getInstance();
    ClassLoader classLoader=registry.getClassLoader(plugin);
    String filename=plugin.getImageFile();
    InputStream inputStream=classLoader.getResourceAsStream(filename);
    if (inputStream == null) {
      inputStream=classLoader.getResourceAsStream("/" + classLoader);
    }
    if (inputStream == null) {
      inputStream=registry.getClass().getResourceAsStream(plugin.getImageFile());
    }
    if (inputStream == null) {
      inputStream=registry.getClass().getResourceAsStream("/" + plugin.getImageFile());
    }
    if (inputStream == null) {
      try {
        inputStream=new FileInputStream(plugin.getImageFile());
      }
 catch (      FileNotFoundException e) {
      }
    }
    if (inputStream == null) {
      throw new KettleException("Unable to find file: " + plugin.getImageFile() + " for plugin: "+ plugin);
    }
    BufferedImage image=ImageIO.read(inputStream);
    inputStream.close();
    WaitingImageObserver wia=new WaitingImageObserver(image);
    wia.waitImageLoaded();
    return image;
  }
 catch (  Throwable e) {
    throw new KettleException("Unable to load image from file : '" + plugin.getImageFile() + "' for plugin: "+ plugin,e);
  }
}
