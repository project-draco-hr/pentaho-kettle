{
  if (getTransformationStep) {
    if (Const.isEmpty(stepname)) {
      return transMeta.getPrevStepFields(this.stepname);
    }
 else {
      StepMeta stepMeta=transMeta.findStep(stepname);
      if (stepMeta == null) {
        throw new KettleException(Messages.getString("MappingDialog.Exception.SpecifiedStepWasNotFound",stepname));
      }
      return transMeta.getStepFields(stepMeta);
    }
  }
 else {
    if (Const.isEmpty(stepname)) {
      String[] stepnames=getMappingSteps(mappingTransMeta,mappingInput);
      if (stepnames.length > 1) {
        throw new KettleException(Messages.getString("MappingDialog.Exception.OnlyOneMappingInputStepAllowed","" + stepnames.length));
      }
      if (stepnames.length == 0) {
        throw new KettleException(Messages.getString("MappingDialog.Exception.OneMappingInputStepRequired","" + stepnames.length));
      }
      return mappingTransMeta.getStepFields(stepnames[0]);
    }
 else {
      StepMeta stepMeta=mappingTransMeta.findStep(stepname);
      if (stepMeta == null) {
        throw new KettleException(Messages.getString("MappingDialog.Exception.SpecifiedStepWasNotFound",stepname));
      }
      return mappingTransMeta.getStepFields(stepMeta);
    }
  }
}
