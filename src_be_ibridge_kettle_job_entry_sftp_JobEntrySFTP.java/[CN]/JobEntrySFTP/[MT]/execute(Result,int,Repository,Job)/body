{
  LogWriter log=LogWriter.getInstance();
  log4j.info("Started SFTP job to " + serverName);
  Result result=new Result(nr);
  result.setResult(false);
  long filesRetrieved=0;
  log.logDetailed(toString(),"Start of SFTP job entry");
  SFTPClient sftpclient=null;
  try {
    sftpclient=new SFTPClient(InetAddress.getByName(serverName),serverPort,userName);
    log.logDetailed(toString(),"Opened SFTP connection to server [" + serverName + "] on port ["+ serverPort+ "] with username ["+ userName+ "]");
    sftpclient.login(password);
    log.logDetailed(toString(),"logged in using password " + password);
    if (sftpDirectory != null && sftpDirectory.length() > 0) {
      sftpclient.chdir(sftpDirectory);
      log.logDetailed(toString(),"Changed to directory [" + sftpDirectory + "]");
    }
    String[] filelist=sftpclient.dir();
    log.logDetailed(toString(),"Found " + filelist.length + " files in the remote scp directory");
    Pattern pattern=null;
    if (wildcard != null && wildcard.length() > 0) {
      pattern=Pattern.compile(wildcard);
    }
    for (int i=0; i < filelist.length && !parentJob.isStopped(); i++) {
      boolean getIt=true;
      if (pattern != null) {
        Matcher matcher=pattern.matcher(filelist[i]);
        getIt=matcher.matches();
      }
      if (getIt) {
        log.logDebug(toString(),"Getting file [" + filelist[i] + "] to directory ["+ targetDirectory+ "]");
        sftpclient.get(targetDirectory + Const.FILE_SEPARATOR + filelist[i],filelist[i]);
        filesRetrieved++;
        log.logDetailed(toString(),"Got file [" + filelist[i] + "]");
        if (remove) {
          sftpclient.delete(filelist[i]);
          log.logDetailed(toString(),"deleted file [" + filelist[i] + "]");
        }
      }
    }
    result.setResult(true);
    result.setNrFilesRetrieved(filesRetrieved);
  }
 catch (  Exception e) {
    result.setNrErrors(1);
    e.printStackTrace();
    log.logError(toString(),"Error getting files from SCP : " + e.getMessage());
  }
 finally {
    try {
      if (sftpclient != null)       sftpclient.disconnect();
    }
 catch (    Exception e) {
    }
  }
  return result;
}
