{
  if (isNull()) {
    setType(VALUE_TYPE_STRING);
  }
 else {
    if (getType() == VALUE_TYPE_NUMBER || getType() == VALUE_TYPE_INTEGER) {
      NumberFormat nf=NumberFormat.getInstance();
      DecimalFormat df=(DecimalFormat)nf;
      DecimalFormatSymbols dfs=new DecimalFormatSymbols();
      if (arg3 != null)       dfs.setCurrencySymbol(arg3);
      if (arg2 != null)       dfs.setGroupingSeparator(arg2.charAt(0));
      if (arg1 != null)       dfs.setDecimalSeparator(arg1.charAt(0));
      df.setDecimalFormatSymbols(dfs);
      if (arg0 != null)       df.applyPattern(arg0);
      try {
        setValue(nf.format(getNumber()));
      }
 catch (      Exception e) {
        setType(VALUE_TYPE_STRING);
        setNull();
        throw new KettleValueException("Couldn't convert Number to String " + e.toString());
      }
    }
 else {
      throw new KettleValueException("Function NUM2STR only works on Numbers and Integers");
    }
  }
  return this;
}
