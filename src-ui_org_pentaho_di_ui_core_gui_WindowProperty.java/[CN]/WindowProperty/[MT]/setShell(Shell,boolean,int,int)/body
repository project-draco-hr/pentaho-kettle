{
  boolean sized=false;
  if (!onlyPosition) {
    shell.setMaximized(maximized);
  }
  Rectangle r=rectangle;
  if (r != null && r.x >= 0 && r.y >= 0 && r.width >= 0 && r.height >= 0) {
    if (r.width > 0 && r.height > 0) {
      if (!onlyPosition) {
        shell.setSize(r.width,r.height);
      }
    }
    if (r.x > 0 && r.y > 0) {
      shell.setLocation(r.x,r.y);
    }
    sized=true;
  }
  if (!onlyPosition) {
    if (!sized) {
      shell.layout();
    }
  }
  if (minWidth > 0 || minHeight > 0) {
    Rectangle bounds=shell.getBounds();
    if (bounds.width < minWidth)     bounds.width=minWidth;
    if (bounds.height < minHeight)     bounds.height=minHeight;
    shell.setSize(bounds.width,bounds.height);
  }
  Rectangle shRect=shell.getBounds();
  Point shSize=Geometry.getSize(shRect);
  Rectangle diRect=shell.getDisplay().getPrimaryMonitor().getClientArea();
  Point diSize=Geometry.getSize(diRect);
  Rectangle resizedRect=Geometry.copy(shRect);
  Point oversize=Geometry.subtract(shSize,diSize);
  if (oversize.x > 0) {
    resizedRect.width=shSize.x - oversize.x;
  }
  if (oversize.y > 0) {
    resizedRect.height=shSize.y - oversize.y;
  }
  if (shRect.width != resizedRect.width || shRect.height != resizedRect.height) {
    if (!onlyPosition) {
      shell.setSize(resizedRect.width,resizedRect.height);
    }
  }
  Geometry.moveInside(resizedRect,diRect);
  if (shRect.x != resizedRect.x || shRect.y != resizedRect.y) {
    int middleX=diRect.x + (diRect.width - resizedRect.width) / 2;
    int middleY=diRect.y + (diRect.height - resizedRect.height) / 2;
    shell.setLocation(middleX,middleY);
  }
}
