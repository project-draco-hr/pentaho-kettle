{
  boolean retval=false;
  try {
    if (ftpclient == null || !ftpclient.connected()) {
      ftpclient=new FTPClient();
      String realServername=jobMeta.environmentSubstitute(wServerName.getText());
      ftpclient.setRemoteAddr(InetAddress.getByName(realServername));
      if (!Const.isEmpty(wProxyHost.getText())) {
        String realProxy_host=jobMeta.environmentSubstitute(wProxyHost.getText());
        ftpclient.setRemoteAddr(InetAddress.getByName(realProxy_host));
        int port=Const.toInt(jobMeta.environmentSubstitute(wProxyHost.getText()),21);
        if (port != 0) {
          ftpclient.setRemotePort(port);
        }
      }
 else {
        ftpclient.setRemoteAddr(InetAddress.getByName(realServername));
      }
      ftpclient.connect();
      String realUsername=jobMeta.environmentSubstitute(wUserName.getText()) + (!Const.isEmpty(wProxyHost.getText()) ? "@" + realServername : "") + (!Const.isEmpty(wProxyUsername.getText()) ? " " + jobMeta.environmentSubstitute(wProxyUsername.getText()) : "");
      String realPassword=jobMeta.environmentSubstitute(wPassword.getText()) + (!Const.isEmpty(wProxyPassword.getText()) ? " " + jobMeta.environmentSubstitute(wProxyPassword.getText()) : "");
      ftpclient.login(realUsername,realPassword);
    }
    String realFtpDirectory="";
    if (!Const.isEmpty(wFtpDirectory.getText()))     realFtpDirectory=jobMeta.environmentSubstitute(wFtpDirectory.getText());
    if (checkfolder) {
      ftpclient.chdir("/");
      if (!Const.isEmpty(realFtpDirectory))       ftpclient.chdir(realFtpDirectory);
    }
    if (checkmoveToFolder) {
      ftpclient.chdir("/");
      if (!Const.isEmpty(wMoveToDirectory.getText())) {
        String realMoveDirectory=jobMeta.environmentSubstitute(wMoveToDirectory.getText());
        if (!Const.isEmpty(realFtpDirectory)) {
          realMoveDirectory=realFtpDirectory + "/" + realMoveDirectory;
          ftpclient.chdir(realMoveDirectory);
        }
      }
    }
    retval=true;
  }
 catch (  Exception e) {
    MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
    mb.setMessage(Messages.getString("JobFTP.ErrorConnect.NOK",e.getMessage()) + Const.CR);
    mb.setText(Messages.getString("JobFTP.ErrorConnect.Title.Bad"));
    mb.open();
  }
  return retval;
}
