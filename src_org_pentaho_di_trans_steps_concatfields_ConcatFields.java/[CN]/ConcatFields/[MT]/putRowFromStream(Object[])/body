{
  byte[] targetBinary=((ConcatFieldsOutputStream)data.writer).read();
  if (r == null && targetBinary == null)   return;
  Object[] outputRowData=null;
  if (!meta.isRemoveSelectedFields()) {
    outputRowData=RowDataUtil.resizeArray(r,data.outputRowMeta.size());
  }
 else {
    outputRowData=new Object[data.outputRowMeta.size() + RowDataUtil.OVER_ALLOCATE_SIZE];
    if (r != null) {
      for (int i=0; i < data.remainingFieldsInputOutputMapping.length; i++) {
        outputRowData[i]=r[data.remainingFieldsInputOutputMapping[i]];
      }
    }
  }
  if (outputRowData == null) {
    outputRowData=new Object[data.outputRowMeta.size()];
  }
  if (targetBinary != null) {
    if (!data.hasEncoding) {
      outputRowData[data.posTargetField]=new String(targetBinary);
    }
 else {
      try {
        outputRowData[data.posTargetField]=new String(targetBinary,meta.getEncoding());
      }
 catch (      UnsupportedEncodingException e) {
        throw new KettleStepException("Unsupported encoding: " + meta.getEncoding());
      }
    }
  }
 else {
    outputRowData[data.posTargetField]=null;
  }
  putRow(data.outputRowMeta,outputRowData);
}
