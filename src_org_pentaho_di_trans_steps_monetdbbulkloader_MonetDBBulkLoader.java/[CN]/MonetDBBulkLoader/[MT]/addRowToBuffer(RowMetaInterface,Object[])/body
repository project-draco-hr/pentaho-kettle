{
  ByteArrayOutputStream line=new ByteArrayOutputStream(25000);
  try {
    for (int i=0; i < data.keynrs.length; i++) {
      if (i > 0) {
        line.write(data.separator);
      }
      int index=data.keynrs[i];
      ValueMetaInterface valueMeta=rowMeta.getValueMeta(index);
      Object valueData=r[index];
      if (valueData != null) {
switch (valueMeta.getType()) {
case ValueMetaInterface.TYPE_STRING:
          line.write(data.quote);
        if (valueMeta.isStorageBinaryString() && meta.getFieldFormatOk()[i]) {
          line.write((byte[])valueData);
        }
 else {
          line.write(valueMeta.getString(valueData).getBytes());
        }
      line.write(data.quote);
    break;
case ValueMetaInterface.TYPE_INTEGER:
  if (valueMeta.isStorageBinaryString() && meta.getFieldFormatOk()[i]) {
    line.write((byte[])valueData);
  }
 else {
    line.write(Long.toString(valueMeta.getInteger(valueData)).getBytes());
  }
break;
case ValueMetaInterface.TYPE_DATE:
if (valueMeta.isStorageBinaryString() && meta.getFieldFormatOk()[i]) {
line.write((byte[])valueData);
}
 else {
Date date=valueMeta.getDate(valueData);
line.write(data.monetDateMeta.getString(date).getBytes());
}
break;
case ValueMetaInterface.TYPE_BOOLEAN:
if (valueMeta.isStorageBinaryString() && meta.getFieldFormatOk()[i]) {
line.write((byte[])valueData);
}
 else {
line.write(Boolean.toString(valueMeta.getBoolean(valueData)).getBytes());
}
break;
case ValueMetaInterface.TYPE_NUMBER:
if (valueMeta.isStorageBinaryString() && meta.getFieldFormatOk()[i]) {
line.write((byte[])valueData);
}
 else {
line.write(Double.toString(valueMeta.getNumber(valueData)).getBytes());
}
break;
case ValueMetaInterface.TYPE_BIGNUMBER:
if (valueMeta.isStorageBinaryString() && meta.getFieldFormatOk()[i]) {
line.write((byte[])valueData);
}
 else {
line.write(valueMeta.getString(valueData).getBytes());
}
break;
}
}
}
line.write(data.newline);
data.rowBuffer[data.bufferIndex]=line.toByteArray();
data.bufferIndex++;
}
 catch (Exception e) {
throw new KettleException("Error serializing rows of data to the psql command",e);
}
}
