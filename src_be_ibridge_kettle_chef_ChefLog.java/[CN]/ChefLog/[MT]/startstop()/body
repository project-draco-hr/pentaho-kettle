{
  if (job == null) {
    if (chef.jobMeta.hasChanged()) {
      if (chef.props.getAutoSave()) {
        log.logDetailed(toString(),"Save file automatically before running...");
        System.out.println("Save file automatically before running...");
        chef.saveFile();
      }
 else {
        MessageDialogWithToggle md=new MessageDialogWithToggle(shell,"File has changed!",null,"You need to save your job before you can run it." + Const.CR + "Do you want to save the job now?"+ Const.CR,MessageDialog.QUESTION,new String[]{"Yes","No"},0,"Automatically save the job.",chef.props.getAutoSave());
        int answer=md.open();
        if (answer == 0) {
          chef.saveFile();
        }
        chef.props.setAutoSave(md.getToggleState());
      }
    }
    if (((chef.jobMeta.getName() != null && chef.rep != null) || (chef.jobMeta.getFilename() != null && chef.rep == null)) && !chef.jobMeta.hasChanged()) {
      if (job == null || (job != null && job.isActive())) {
        try {
          wStart.setText(STOP_TEXT);
          job=new Job(log,chef.jobMeta.getName(),chef.jobMeta.getFilename(),null);
          job.open(chef.rep,chef.jobMeta.getFilename(),chef.jobMeta.getName(),chef.jobMeta.getDirectory().getPath());
          job.setJobEntryResults(jobEntryResults);
          job.start();
          readLog();
        }
 catch (        KettleException e) {
          new ErrorDialog(shell,chef.props,"Can't open job","Job failed to open",e);
          job=null;
        }
      }
 else {
        MessageBox m=new MessageBox(shell,SWT.OK | SWT.ICON_WARNING);
        m.setText("Warning!");
        m.setMessage("The job is running, don't start it twice!");
        m.open();
      }
    }
 else {
      if (chef.jobMeta.hasChanged()) {
        MessageBox m=new MessageBox(shell,SWT.OK | SWT.ICON_WARNING);
        m.setText("File has changed!");
        m.setMessage("Please save your job first!");
        m.open();
      }
 else       if (chef.rep != null && chef.jobMeta.getName() == null) {
        MessageBox m=new MessageBox(shell,SWT.OK | SWT.ICON_WARNING);
        m.setText("This job has no name!");
        m.setMessage("Please give your job a name to identify it by!");
        m.open();
      }
 else {
        MessageBox m=new MessageBox(shell,SWT.OK | SWT.ICON_WARNING);
        m.setText("No filename!");
        m.setMessage("Before running, please save your job first!");
        m.open();
      }
    }
  }
 else {
    try {
      if (job != null) {
        job.stopAll();
        job.endProcessing("stop");
        job=null;
      }
    }
 catch (    KettleJobException je) {
      MessageBox m=new MessageBox(shell,SWT.OK | SWT.ICON_WARNING);
      m.setText("Error!");
      m.setMessage("I was unable to log the stop signal to the log table:" + Const.CR + je.toString());
      m.open();
    }
 finally {
      job=null;
      wStart.setText(START_TEXT);
    }
  }
}
