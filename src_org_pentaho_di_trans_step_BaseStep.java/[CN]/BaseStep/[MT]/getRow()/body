{
  if (stopped.get()) {
    if (log.isDebug())     logDebug(Messages.getString("BaseStep.Log.StopLookingForMoreRows"));
    stopAll();
    return null;
  }
  if (this.checkTransRunning == false) {
    while (!trans.isRunning() && !stopped.get()) {
      try {
        Thread.sleep(1);
      }
 catch (      InterruptedException e) {
      }
    }
    this.checkTransRunning=true;
  }
  if (!remoteInputSteps.isEmpty()) {
    if (!remoteInputStepsInitialized) {
      for (      RemoteStep remoteStep : remoteInputSteps) {
        try {
          RowSet rowSet=remoteStep.openReaderSocket(this);
          inputRowSets.add(rowSet);
        }
 catch (        Exception e) {
          throw new KettleStepException("Error opening reader socket to remote step '" + remoteStep + "'",e);
        }
      }
      remoteInputStepsInitialized=true;
    }
  }
  if (inputRowSets.size() == 0) {
    return null;
  }
  if (blockPointer >= NR_OF_ROWS_IN_BLOCK) {
    nextInputStream();
  }
  RowSet in=currentInputStream();
  Object[] row=null;
  while (row == null && !isStopped()) {
    row=in.getRowWait(1,TimeUnit.MILLISECONDS);
    if (row != null) {
      linesRead++;
      blockPointer++;
    }
 else {
      if (in.isDone()) {
        row=in.getRowWait(1,TimeUnit.MILLISECONDS);
        if (row == null) {
          inputRowSets.remove(in);
          if (inputRowSets.size() == 0)           return null;
        }
 else {
          linesRead++;
        }
      }
      nextInputStream();
      in=currentInputStream();
    }
  }
  while (row == null && !stopped.get()) {
    if (inputRowSets.size() == 0)     return null;
    nextInputStream();
    in=currentInputStream();
    row=getRowFrom(in);
  }
  if (inputRowMeta == null)   inputRowMeta=in.getRowMeta();
  if (safeModeEnabled) {
    safeModeChecking(inputRowMeta);
  }
  if (row != null) {
    for (int i=0; i < rowListeners.size(); i++) {
      RowListener rowListener=(RowListener)rowListeners.get(i);
      rowListener.rowReadEvent(inputRowMeta,row);
    }
  }
  verifyRejectionRates();
  return row;
}
