{
  try {
    if (databaseMeta.getObjectId() == null) {
      databaseMeta.setObjectId(getDatabaseID(databaseMeta.getName()));
    }
    if (databaseMeta.getObjectId() == null) {
      databaseMeta.setObjectId(insertDatabase(databaseMeta.getName(),databaseMeta.getPluginId(),DatabaseMeta.getAccessTypeDesc(databaseMeta.getAccessType()),databaseMeta.getHostname(),databaseMeta.getDatabaseName(),databaseMeta.getDatabasePortNumberString(),databaseMeta.getUsername(),databaseMeta.getPassword(),databaseMeta.getServername(),databaseMeta.getDataTablespace(),databaseMeta.getIndexTablespace()));
    }
 else {
      updateDatabase(databaseMeta.getObjectId(),databaseMeta.getName(),databaseMeta.getPluginId(),DatabaseMeta.getAccessTypeDesc(databaseMeta.getAccessType()),databaseMeta.getHostname(),databaseMeta.getDatabaseName(),databaseMeta.getDatabasePortNumberString(),databaseMeta.getUsername(),databaseMeta.getPassword(),databaseMeta.getServername(),databaseMeta.getDataTablespace(),databaseMeta.getIndexTablespace());
    }
    delDatabaseAttributes(databaseMeta.getObjectId());
    Properties attributes=databaseMeta.getAttributes();
    Enumeration<Object> keys=databaseMeta.getAttributes().keys();
    while (keys.hasMoreElements()) {
      String code=(String)keys.nextElement();
      String attribute=(String)attributes.get(code);
      insertDatabaseAttribute(databaseMeta.getObjectId(),code,attribute);
    }
  }
 catch (  KettleDatabaseException dbe) {
    throw new KettleException("Error saving database connection or one of its attributes to the repository.",dbe);
  }
}
