{
  RowMetaInterface rowMeta=transMeta.getStepFields(lastStep);
  List<SQLField> fields=sql.getOrderFields().getFields();
  SortRowsMeta meta=new SortRowsMeta();
  meta.allocate(fields.size());
  for (int i=0; i < fields.size(); i++) {
    SQLField sqlField=fields.get(i);
    ValueMetaInterface valueMeta=rowMeta.searchValueMeta(sqlField.getField());
    if (valueMeta == null) {
      valueMeta=rowMeta.searchValueMeta(sqlField.getAlias());
    }
    if (valueMeta == null) {
      throw new KettleException("Unable to find field to sort on: " + sqlField.getField() + " nor the alias: "+ sqlField.getAlias());
    }
    meta.getFieldName()[i]=valueMeta.getName();
    meta.getAscending()[i]=sqlField.isAscending();
    meta.getCaseSensitive()[i]=true;
  }
  meta.setSortSize("1000000");
  StepMeta stepMeta=new StepMeta("Sort rows",meta);
  stepMeta.setLocation(xLocation,50);
  xLocation+=100;
  stepMeta.setDraw(true);
  return stepMeta;
}
