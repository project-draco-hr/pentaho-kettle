{
  try {
    TransMeta transMeta=null;
    if (!Const.isEmpty(getFilename())) {
      String filename=environmentSubstitute(getFilename());
      logBasic("Loading transformation from XML file [" + filename + "]");
      try {
        transMeta=DomainObjectRegistry.getInstance().constructTransMeta(new Class[]{String.class,Repository.class,boolean.class,VariableSpace.class},new Object[]{filename,null,true,this});
      }
 catch (      DomainObjectCreationException doce) {
        transMeta=new TransMeta(filename,null,true,this);
      }
      transMeta.copyVariablesFrom(this);
    }
 else     if (!Const.isEmpty(getTransname()) && getDirectory() != null) {
      String filename=environmentSubstitute(getTransname());
      logBasic(BaseMessages.getString(PKG,"JobTrans.Log.LoadingTransRepDirec",filename,"" + getDirectory()));
      if (rep != null) {
        transMeta=rep.loadTransformation(filename,rep.loadRepositoryDirectoryTree().findDirectory(environmentSubstitute(getDirectory())),null,true,null);
        transMeta.copyVariablesFrom(this);
      }
 else {
        throw new KettleException(BaseMessages.getString(PKG,"JobTrans.Exception.NoRepDefined"));
      }
    }
 else {
      throw new KettleJobException(BaseMessages.getString(PKG,"JobTrans.Exception.TransNotSpecified"));
    }
    transMeta.setArguments(arguments);
    return transMeta;
  }
 catch (  Exception e) {
    throw new KettleException(BaseMessages.getString(PKG,"JobTrans.Exception.MetaDataLoad"),e);
  }
}
