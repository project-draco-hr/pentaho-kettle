{
  DataQuery query=null;
  try {
    query=new DataQuery(new URL(GaInputStepMeta.GA_DATA_URL));
  }
 catch (  MalformedURLException ex) {
    ex.printStackTrace();
    return null;
  }
  query.setIds(wCustomProfileEnabled.getSelection() ? transMeta.environmentSubstitute(wGaCustomProfile.getText()) : profileTableIds.get(wGaProfile.getText()));
  query.setStartDate(transMeta.environmentSubstitute(wQuStartDate.getText()));
  query.setEndDate(transMeta.environmentSubstitute(wQuEndDate.getText()));
  query.setDimensions(transMeta.environmentSubstitute(wQuDimensions.getText()));
  query.setMetrics(transMeta.environmentSubstitute(wQuMetrics.getText()));
  if (!Const.isEmpty(wGaApiKey.getText().trim())) {
    query.setStringCustomParameter("key",Encr.decryptPasswordOptionallyEncrypted(transMeta.environmentSubstitute(wGaApiKey.getText().trim())));
  }
  if (wUseSegmentEnabled.getSelection()) {
    if (wCustomSegmentEnabled.getSelection()) {
      query.setSegment(transMeta.environmentSubstitute(wQuCustomSegment.getText()));
    }
 else {
      query.setSegment(segmentIds.get(wQuSegment.getText()));
    }
  }
  if (!Const.isEmpty(wQuFilters.getText())) {
    query.setFilters(transMeta.environmentSubstitute(wQuFilters.getText()));
  }
  if (!Const.isEmpty(wQuSort.getText())) {
    query.setSort(transMeta.environmentSubstitute(wQuSort.getText()));
  }
  return query;
}
