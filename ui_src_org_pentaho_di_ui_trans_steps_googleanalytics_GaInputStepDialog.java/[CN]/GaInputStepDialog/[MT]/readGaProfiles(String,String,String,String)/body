{
  AnalyticsService analyticsService=new AnalyticsService(appName);
  try {
    analyticsService.setUserCredentials(emailText,passwordText);
    URL q=new URL(GaInputStepMeta.GA_MANAGEMENT_URL + "/accounts/~all/webproperties/~all/profiles?key=" + apiKey);
    ManagementFeed profilesFeed=analyticsService.getFeed(q,ManagementFeed.class);
    ArrayList<String> profileNames=new ArrayList<String>(10);
    profileTableIds.clear();
    for (    ManagementEntry entry : profilesFeed.getEntries()) {
      String tableId=entry.getProperty("dxp:tableId");
      String profileName=tableId + " - profile: " + entry.getProperty("ga:profileName");
      profileNames.add(profileName);
      profileTableIds.put(profileName,tableId);
    }
    wGaProfile.setItems(profileNames.toArray(new String[0]));
    if (profileNames.size() > 0) {
      wGaProfile.select(0);
    }
  }
 catch (  AuthenticationException e) {
    e.printStackTrace();
    MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
    mb.setText(BaseMessages.getString(PKG,"GoogleAnalyticsDialog.AuthenticationFailure.DialogTitle"));
    mb.setMessage(BaseMessages.getString(PKG,"GoogleAnalyticsDialog.AuthenticationFailure.DialogMessage"));
    mb.open();
  }
catch (  MalformedURLException e) {
    e.printStackTrace();
  }
catch (  IOException e) {
    e.printStackTrace();
    MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
    mb.setText("IO Exception");
    mb.setMessage("IO exception occured when contacting Google Analytics. " + "Is your network connection working and allowing HTTPS connections?\n\n" + e.getMessage());
    mb.open();
  }
catch (  ServiceException e) {
    e.printStackTrace();
    MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
    mb.setText("Service Exception");
    mb.setMessage("Service exception occured when contacting Google Analytics.\n\n" + e.getMessage());
    mb.open();
  }
}
