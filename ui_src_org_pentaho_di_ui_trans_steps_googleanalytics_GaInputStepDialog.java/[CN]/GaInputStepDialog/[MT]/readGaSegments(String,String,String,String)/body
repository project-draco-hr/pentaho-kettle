{
  String email=transMeta.environmentSubstitute(emailText);
  String pass=transMeta.environmentSubstitute(passwordText);
  String key=transMeta.environmentSubstitute(apiKey);
  AnalyticsService analyticsService=new AnalyticsService(transMeta.environmentSubstitute(appName));
  try {
    analyticsService.setUserCredentials(email,pass);
    URL q=new URL(GaInputStepMeta.GA_MANAGEMENT_URL + "/segments?key=" + key);
    ManagementFeed segmentFeed=analyticsService.getFeed(q,ManagementFeed.class);
    ArrayList<String> segmentNames=new ArrayList<String>(20);
    segmentIds.clear();
    for (    ManagementEntry segmentEntry : segmentFeed.getEntries()) {
      segmentNames.add(segmentEntry.getSegment().getName());
      segmentIds.put(segmentEntry.getSegment().getName(),segmentEntry.getSegment().getId());
    }
    wQuSegment.setItems(segmentNames.toArray(new String[0]));
    if (segmentNames.size() > 0) {
      wQuSegment.select(0);
    }
  }
 catch (  AuthenticationException e) {
    e.printStackTrace();
    MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
    mb.setText("Authentication Failure");
    mb.setMessage("Authentication failure occured when contacting Google Analytics.\n" + "Please verify the credentials in the email and password fields as well as your network connectivity.");
    mb.open();
  }
catch (  MalformedURLException e) {
    e.printStackTrace();
  }
catch (  IOException e) {
    e.printStackTrace();
    MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
    mb.setText("IO Exception");
    mb.setMessage("IO exception occured when contacting Google Analytics. " + "Is your network connection working and allowing HTTPS connections?\n\n" + e.getMessage());
    mb.open();
  }
catch (  ServiceException e) {
    e.printStackTrace();
    MessageBox mb=new MessageBox(shell,SWT.OK | SWT.ICON_ERROR);
    mb.setText("Service Exception");
    mb.setMessage("Service exception occured when contacting Google Analytics.\n\n" + e.getMessage());
    mb.open();
  }
}
