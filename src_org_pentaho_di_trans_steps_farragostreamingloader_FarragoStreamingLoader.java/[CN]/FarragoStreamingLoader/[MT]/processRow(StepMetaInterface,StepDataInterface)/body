{
  meta=(FarragoStreamingLoaderMeta)smi;
  data=(FarragoStreamingLoaderData)sdi;
  try {
    Object[] r=getRow();
    if (r == null) {
      if (data.objOut != null) {
        data.objOut.close();
        if (data.client != null) {
          data.client.close();
        }
      }
      return false;
    }
    if (first) {
      first=false;
      data.keynrs=new int[meta.getFieldStreamForKeys().length + meta.getFieldStreamForFields().length];
      data.format=new int[data.keynrs.length];
      for (int i=0; i < meta.getFieldStreamForKeys().length; i++) {
        data.keynrs[i]=getInputRowMeta().indexOfValue(meta.getFieldStreamForKeys()[i]);
        data.format[i]=getInputRowMeta().getValueMeta(data.keynrs[i]).getLength();
      }
      int tmp_cnt=meta.getFieldStreamForKeys().length;
      for (int i=0; i < meta.getFieldStreamForFields().length; i++) {
        data.keynrs[tmp_cnt + i]=getInputRowMeta().indexOfValue(meta.getFieldStreamForFields()[i]);
        data.format[tmp_cnt + i]=getInputRowMeta().getValueMeta(data.keynrs[i]).getLength();
      }
      logDebug(data.format.toString());
      List header=new ArrayList();
      header.add("1");
      List format=new ArrayList();
      for (int i=0; i < data.format.length; i++) {
        format.add((Integer)data.format[i]);
      }
      header.add(format);
      data.objOut.writeObject(header);
    }
    List entity=new ArrayList();
    for (int i=0; i < data.keynrs.length; i++) {
      int index=data.keynrs[i];
      ValueMetaInterface valueMeta=getInputRowMeta().getValueMeta(index);
      Object valueData=r[index];
      if (valueData != null) {
switch (valueMeta.getType()) {
case ValueMetaInterface.TYPE_STRING:
          logRowlevel(valueMeta.getString(valueData) + ":" + valueMeta.getLength()+ ":"+ valueMeta.getTypeDesc());
        entity.add(valueMeta.getString(valueData));
      break;
case ValueMetaInterface.TYPE_INTEGER:
    logRowlevel(valueMeta.getInteger(valueData) + ":" + valueMeta.getLength()+ ":"+ valueMeta.getTypeDesc());
  entity.add(valueMeta.getInteger(valueData));
break;
case ValueMetaInterface.TYPE_DATE:
Date date=valueMeta.getDate(valueData);
logRowlevel(date.getYear() + date.getMonth() + date.getDay()+ ":"+ valueMeta.getLength());
entity.add(date);
break;
case ValueMetaInterface.TYPE_BOOLEAN:
logRowlevel(Boolean.toString(valueMeta.getBoolean(valueData)) + ":" + valueMeta.getLength());
entity.add(valueMeta.getBoolean(valueData));
break;
}
}
}
data.objOut.writeObject(entity);
return true;
}
 catch (Exception e) {
logError(BaseMessages.getString(PKG,"FarragoStreamingLoader.Log.ErrorInStep"),e);
setErrors(1);
stopAll();
setOutputDone();
return false;
}
}
