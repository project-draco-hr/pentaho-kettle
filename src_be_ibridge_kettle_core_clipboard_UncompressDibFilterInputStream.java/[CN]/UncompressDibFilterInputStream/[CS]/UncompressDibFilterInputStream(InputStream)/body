{
  this.in=bmpFileStream;
  this.buffer=new byte[BITMAPINFOHEADER.sizeof];
  this.in.read(this.buffer,0,this.buffer.length);
  BITMAPINFOHEADER origInfoHeader=new BITMAPINFOHEADER();
  ConversionUtil.fromBytes(origInfoHeader,this.buffer,0);
  this.isCompressed=origInfoHeader.biCompression == OS_BI_BITFIELDS;
  if (this.isCompressed) {
    this.bitCount=origInfoHeader.biBitCount;
    origInfoHeader.biCompression=OS_BI_RGB;
    origInfoHeader.biSizeImage=0;
    ConversionUtil.toBytes(origInfoHeader,this.buffer,0);
    final byte[] redMaskBytes=new byte[4];
    final byte[] greenMaskBytes=new byte[4];
    final byte[] blueMaskBytes=new byte[4];
    this.in.read(redMaskBytes);
    this.in.read(greenMaskBytes);
    this.in.read(blueMaskBytes);
    this.redMask=ConversionUtil.bytesToInt(redMaskBytes,0);
    this.greenMask=ConversionUtil.bytesToInt(greenMaskBytes,0);
    this.blueMask=ConversionUtil.bytesToInt(blueMaskBytes,0);
  }
}
