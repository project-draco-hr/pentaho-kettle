{
  if (plugins.contains(sp)) {
    return null;
  }
  SpoonPluginCategories categories=sp.getClass().getAnnotation(SpoonPluginCategories.class);
  if (categories != null) {
    for (    String cat : categories.value()) {
      List<SpoonPluginInterface> categoryList=pluginCategoryMap.get(cat);
      if (categoryList == null) {
        categoryList=new ArrayList<SpoonPluginInterface>();
        pluginCategoryMap.put(cat,categoryList);
      }
      categoryList.add(sp);
    }
  }
  if (sp.getPerspective() != null) {
    SpoonPerspectiveManager.getInstance().addPerspective(sp.getPerspective());
  }
  plugins.add(sp);
  return sp;
}
