{
  if (parentThread != null && parentThread.equals(localThread)) {
    throw new RuntimeException("local thread can't be the same as the parent thread!");
  }
  LogWriter.getInstance().logDebug("LocalVariables","---> Create new KettleVariables for thread [" + localThread + "] for parent thread ["+ parentThread+ "], same namespace? ["+ sameNamespace+ "]");
  KettleVariables vars=new KettleVariables(localThread,parentThread);
  if (parentThread != null) {
    KettleVariables initialValue=getKettleVariables(parentThread);
    if (initialValue != null) {
      if (sameNamespace) {
        vars=new KettleVariables(localThread,parentThread);
        vars.setProperties(initialValue.getProperties());
      }
 else {
        vars.putAll(initialValue.getProperties());
      }
    }
 else {
      throw new RuntimeException("No parent Kettle Variables found for thread [" + parentThread + "], local thread is ["+ localThread+ "]");
    }
  }
  KettleVariables checkVars=(KettleVariables)map.get(localThread);
  if (checkVars != null) {
  }
  map.put(localThread,vars);
  return vars;
}
