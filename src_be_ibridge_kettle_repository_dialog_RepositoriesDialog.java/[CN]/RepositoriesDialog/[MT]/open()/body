{
  props.setLook(shell);
  FormLayout formLayout=new FormLayout();
  formLayout.marginWidth=Const.FORM_MARGIN;
  formLayout.marginHeight=Const.FORM_MARGIN;
  shell.setLayout(formLayout);
  shell.setText(Messages.getString("RepositoriesDialog.Label.SelectRepository"));
  shell.setImage(GUIResource.getInstance().getImageSpoon());
  int middle=20;
  int margin=Const.MARGIN;
  int right=30;
  final Image logo=GUIResource.getInstance().getImagePentaho();
  final Rectangle bounds=logo.getBounds();
  wCanvas=new Canvas(shell,SWT.NO_BACKGROUND);
  fdCanvas=new FormData();
  fdCanvas.left=new FormAttachment(0,0);
  fdCanvas.right=new FormAttachment(100,0);
  fdCanvas.top=new FormAttachment(0,0);
  fdCanvas.bottom=new FormAttachment(60,0);
  wCanvas.setLayoutData(fdCanvas);
  wCanvas.setSize(bounds.width,bounds.height);
  wCanvas.addPaintListener(new PaintListener(){
    public void paintControl(    PaintEvent pe){
      Rectangle canvasBounds=wCanvas.getBounds();
      if (canvasBounds.width > 0 && canvasBounds.height > 0) {
        Image image=new Image(display,canvasBounds.width,canvasBounds.height);
        GC gc=new GC(image);
        gc.setBackground(GUIResource.getInstance().getColorBackground());
        gc.fillRectangle(0,0,canvasBounds.width,canvasBounds.height);
        if (canvasBounds.width > bounds.width && canvasBounds.height > bounds.height) {
          gc.drawImage(logo,(canvasBounds.width - bounds.width) / 2,(canvasBounds.height - bounds.height) / 2);
        }
 else {
          gc.drawImage(logo,0,0,bounds.width,bounds.height,0,0,canvasBounds.width,canvasBounds.height);
        }
        pe.gc.drawImage(image,0,0);
        gc.dispose();
        image.dispose();
      }
    }
  }
);
  wlKettle=new Label(shell,SWT.CENTER);
  wlKettle.setText(Messages.getString("RepositoriesDialog.Label.Welcome") + toolName + "  v"+ Const.VERSION);
  props.setLook(wlKettle);
  final Font f=new Font(shell.getDisplay(),"Arial",18,SWT.NORMAL);
  wlKettle.addDisposeListener(new DisposeListener(){
    public void widgetDisposed(    DisposeEvent e){
      f.dispose();
    }
  }
);
  wlKettle.setFont(f);
  fdlKettle=new FormData();
  fdlKettle.left=new FormAttachment(0,0);
  fdlKettle.right=new FormAttachment(100,-right);
  fdlKettle.top=new FormAttachment(wCanvas,margin);
  wlKettle.setLayoutData(fdlKettle);
  wOK=new Button(shell,SWT.PUSH);
  wOK.setText(Messages.getString("System.Button.OK"));
  wNorep=new Button(shell,SWT.PUSH);
  wNorep.setText(Messages.getString("RepositoriesDialog.Button.NoRepository"));
  wCancel=new Button(shell,SWT.PUSH);
  wCancel.setText(Messages.getString("System.Button.Cancel"));
  BaseStepDialog.positionBottomButtons(shell,new Button[]{wOK,wNorep,wCancel},Const.MARGIN,null);
  wPassword=new LabelText(shell,Messages.getString("RepositoriesDialog.Label.Password"),Messages.getString("RepositoriesDialog.Label.Password"),middle,margin);
  props.setLook(wPassword);
  wPassword.getTextWidget().setEchoChar('*');
  fdPassword=new FormData();
  fdPassword.left=new FormAttachment(0,0);
  fdPassword.right=new FormAttachment(100,-right);
  fdPassword.bottom=new FormAttachment(wOK,-margin * 3);
  wPassword.setLayoutData(fdPassword);
  wUsername=new LabelText(shell,Messages.getString("RepositoriesDialog.Label.Login"),Messages.getString("RepositoriesDialog.Label.Login"),middle,margin);
  props.setLook(wUsername);
  fdUsername=new FormData();
  fdUsername.left=new FormAttachment(0,0);
  fdUsername.right=new FormAttachment(100,-right);
  fdUsername.bottom=new FormAttachment(wPassword,-margin);
  wUsername.setLayoutData(fdUsername);
  wRepository=new CCombo(shell,SWT.SINGLE | SWT.READ_ONLY | SWT.BORDER);
  wnRepository=new Button(shell,SWT.PUSH);
  wnRepository.setText(Messages.getString("System.Button.New"));
  weRepository=new Button(shell,SWT.PUSH);
  weRepository.setText(Messages.getString("System.Button.Edit"));
  wdRepository=new Button(shell,SWT.PUSH);
  wdRepository.setText(Messages.getString("System.Button.Delete"));
  fddRepository=new FormData();
  fddRepository.right=new FormAttachment(100,-right);
  fddRepository.bottom=new FormAttachment(wUsername,-margin);
  wdRepository.setLayoutData(fddRepository);
  fdeRepository=new FormData();
  fdeRepository.right=new FormAttachment(wdRepository,-margin);
  fdeRepository.bottom=new FormAttachment(wUsername,-margin);
  weRepository.setLayoutData(fdeRepository);
  fdnRepository=new FormData();
  fdnRepository.right=new FormAttachment(weRepository,-margin);
  fdnRepository.bottom=new FormAttachment(wUsername,-margin);
  wnRepository.setLayoutData(fdnRepository);
  props.setLook(wRepository);
  fdRepository=new FormData();
  fdRepository.left=new FormAttachment(middle,-margin);
  fdRepository.right=new FormAttachment(wnRepository,-margin);
  fdRepository.bottom=new FormAttachment(wUsername,-margin);
  wRepository.setLayoutData(fdRepository);
  wlRepository=new Label(shell,SWT.RIGHT);
  wlRepository.setText(Messages.getString("RepositoriesDialog.Label.Repository"));
  props.setLook(wlRepository);
  fdlRepository=new FormData();
  fdlRepository.left=new FormAttachment(0,0);
  fdlRepository.right=new FormAttachment(middle,-margin * 2);
  fdlRepository.top=new FormAttachment(wRepository,0,SWT.CENTER);
  wlRepository.setLayoutData(fdlRepository);
  wnRepository.addSelectionListener(new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent arg0){
      RepositoryMeta ri=new RepositoryMeta();
      RepositoryDialog dd=new RepositoryDialog(shell,SWT.APPLICATION_MODAL,log,props,ri,input,steploader);
      if (dd.open() != null) {
        input.addRepository(ri);
        fillRepositories();
        int idx=input.indexOfRepository(ri);
        wRepository.select(idx);
      }
    }
  }
);
  weRepository.addSelectionListener(new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent arg0){
      RepositoryMeta ri=input.searchRepository(wRepository.getText());
      if (ri != null) {
        RepositoryDialog dd=new RepositoryDialog(shell,SWT.APPLICATION_MODAL,log,props,ri,input,steploader);
        if (dd.open() != null) {
          fillRepositories();
          int idx=input.indexOfRepository(ri);
          wRepository.select(idx);
        }
      }
    }
  }
);
  wdRepository.addSelectionListener(new SelectionAdapter(){
    public void widgetSelected(    SelectionEvent arg0){
      RepositoryMeta ri=input.searchRepository(wRepository.getText());
      if (ri != null) {
        int idx=input.indexOfRepository(ri);
        input.removeRepository(idx);
        fillRepositories();
      }
    }
  }
);
  wRepository.addTraverseListener(new TraverseListener(){
    public void keyTraversed(    TraverseEvent e){
      wUsername.setFocus();
      e.doit=false;
    }
  }
);
  lsOK=new Listener(){
    public void handleEvent(    Event e){
      ok();
    }
  }
;
  lsNorep=new Listener(){
    public void handleEvent(    Event e){
      norep();
    }
  }
;
  lsCancel=new Listener(){
    public void handleEvent(    Event e){
      cancel();
    }
  }
;
  wOK.addListener(SWT.Selection,lsOK);
  wNorep.addListener(SWT.Selection,lsNorep);
  wCancel.addListener(SWT.Selection,lsCancel);
  shell.addShellListener(new ShellAdapter(){
    public void shellClosed(    ShellEvent e){
      cancel();
    }
  }
);
  lsDef=new SelectionAdapter(){
    public void widgetDefaultSelected(    SelectionEvent e){
      ok();
    }
  }
;
  lsRepo=new KeyAdapter(){
    public void keyPressed(    KeyEvent e){
      if (e.character == SWT.CR)       wUsername.setFocus();
    }
  }
;
  lsJmp=new KeyAdapter(){
    public void keyPressed(    KeyEvent e){
      if (e.character == SWT.CR) {
        if (wPassword.getText().length() != 0)         ok();
 else {
          wPassword.getTextWidget().setFocus();
          wPassword.getTextWidget().selectAll();
        }
      }
    }
  }
;
  wRepository.addKeyListener(lsRepo);
  wUsername.getTextWidget().addKeyListener(lsJmp);
  wPassword.getTextWidget().addSelectionListener(lsDef);
  getData();
  shell.layout();
  BaseStepDialog.setMinimalShellHeight(shell,new Control[]{wCanvas,wlKettle,wRepository,wUsername,wPassword,wOK},margin,2 * margin);
  WindowProperty winprop=props.getScreen(shell.getText());
  if (winprop != null) {
    winprop.setShell(shell,true);
  }
  shell.open();
  while (!shell.isDisposed()) {
    if (!display.readAndDispatch())     display.sleep();
  }
  return repinfo != null;
}
